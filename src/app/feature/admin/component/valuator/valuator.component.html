<div class="row">
    <div class="col-md-4 col-sm-6 col-xs-12">
        <app-icon-card detail="{{valuators}}" title="Valuator" type="info">
            <em class="fas fa-money-bill"></em>
        </app-icon-card>
    </div>

    <div class="col-md-4 col-sm-6 col-xs-12">
        <app-icon-card detail="{{activeCount}}" title="Active" type="success">
            <em class="fas fa-money-bill"></em>
        </app-icon-card>
    </div>

    <div class="col-md-4 col-sm-6 col-xs-12">
        <app-icon-card detail="{{inactiveCount}}" title="Inactive" type="warning">
            <em class="fas fa-money-bill"></em>
        </app-icon-card>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <nb-card>
            <nb-card-header>
                <div class=row>
                    <div class="col-md-6">
                        <form (ngSubmit)="onSearch()">
                            <div class="row">
                                <div class="col-md-8">
                                    <input (input)="onSearchChange($event.target['value'])" [(ngModel)]="search.name"
                                           fullWidth name="name"
                                           nbInput
                                           placeholder="search...." type="text">
                                </div>
                                <div class="col-md-4">
                                    <button nbButton outline status="primary" type="submit">
                                        <em class="fa fa-search"></em>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-6">
                        <div class="float-right">
                            <button (click)="add()" *ngIf="addViewValuator" data-toggle="modal" nbButton outline
                                    status="success">
                                <em class="fa fa-plus"></em>
                            </button>
                        </div>
                    </div>
                </div>
            </nb-card-header>
            <nb-card-body>
                <section *ngIf="viewValuator">
                    <table aria-describedby="Valuator list" class="table table-bordered table-hover"
                           id="add-valuator-table">
                        <thead>
                        <tr>
                            <th scope="col">S.N</th>
                            <th scope="col">Valuator Name</th>
                            <th scope="col">Address</th>
                            <th scope="col">Contact Number</th>
                            <th scope="col">Email</th>
                            <th scope="col">Branches</th>
                            <th scope="col">Valuating field</th>
                            <th scope="col">Bank Associate Date</th>
                            <th scope="col">Minimum Amount</th>
                            <th scope="col">Maximum Amount</th>
                            <th scope="col">Status</th>
                            <th *ngIf='editValuator === true' scope="col">Action</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr (nbPopoverShowStateChange)="showPopover($event, stateCodePopOver, valuator)"
                            *ngFor="let valuator of dataList;let i=index" [nbPopover]="popoverContent" [ngStyle]="{'color': (valuator.state === 'BLACKLISTED' || valuator.state === 'SUSPENDED') ?
                              'red': 'black'}"
                            nbPopoverAdjustment="vertical"
                            nbPopoverTrigger="click">
                            <td>{{(pageable.number - 1) * pageable.size + i + 1}}</td>
                            <td>{{valuator.name}}</td>
                            <td>{{valuator?.province?.name}}, {{valuator?.district?.name}}
                                , {{valuator?.municipalityVdc?.name}}, {{valuator?.streetName}},
                                {{valuator?.wardNumber}}</td>
                            <td>{{valuator?.contactNo}}</td>
                            <td>{{valuator?.email}}</td>
                            <td>
                                <div *ngFor="let branch of valuator?.branch">
                                    {{branch.name}}
                                </div>
                            </td>
                            <td>{{valuator?.valuatingField}}</td>
                            <td>{{valuator?.bankAssociateDate | date}}</td>
                            <td>Rs.{{valuator?.minAmount | currencyFormatter}}</td>
                            <td>Rs.{{valuator?.maxAmount | currencyFormatter}}</td>
                            <td *ngIf='editValuator === true; else status '>
                                <select (change)="onChange(valuator, $event)" [(ngModel)]="valuator.status" [nbPopover]="valuator?.status === 'INACTIVE' ?
                                        'Inactive Reason: ' + valuator?.inactiveComment :
                                        'No Comments available'"
                                        class="select-borderless"
                                        name="status" nbPopoverAdjustment="vertical"
                                        nbPopoverTrigger="hover">
                                    <option value="ACTIVE">ACTIVE</option>
                                    <option value="INACTIVE">INACTIVE</option>
                                </select>
                            </td>
                            <ng-template #status>

                                <td>
                                    <p [className]="valuator.status=='ACTIVE' ? 'greenP' : 'redP'">{{valuator.status}}</p>
                                </td>
                            </ng-template>
                            <td *ngIf='editValuator === true'>
                                <ng-container>
                                    <button (click)="edit(valuator)" *ngIf="editValuator" class="m-1" nbButton size="small"
                                            status="info"
                                            title="Edit">
                                        <em class="fa fa-edit"></em>
                                    </button>
                                    <button (click)="deleteValuator(valuator, $event)" class="m-1" nbButton size="small"
                                            status="danger"
                                            title="Delete">
                                        <em class="fa fa-ban"></em>
                                    </button>
                                </ng-container>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <app-spinner *ngIf="spinner" class="d-flex justify-content-center"></app-spinner>
                    <!-- ===================table-pagination==================== -->
                    <app-paging (changePage)="changePage($event)" *ngIf="!spinner" [pageable]="pageable"></app-paging>
                    <!-- ===================table-pagination==================== -->
                </section>
            </nb-card-body>
        </nb-card>
    </div>
</div>

<ng-template #stateCodePopOver>
    <nb-card class="mb-0">
        <nb-card-header class="p-1 m-1">
            {{inactiveCodePopoverContent}} Reason:
        </nb-card-header>
        <nb-card-body class="p-1 m-1">
            {{inactiveCommentPopoverContent}}
        </nb-card-body>
    </nb-card>
</ng-template>
