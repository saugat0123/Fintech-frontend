<nb-card>
    <nb-card-header>
        <strong>Plant And Machinery</strong>
    </nb-card-header>
    <nb-card-body>
        <form [formGroup]="securityForm">
            <div class="col-md-12">
                <table class="table table-condensed table-bordered table-responsive-md text-center table-sm sb-small">
                    <thead>
                        <tr class="text-white sb-bg-dark">
                            <th>S.N</th>
                            <th>Fair Market Value</th>
                            <th>Distress Value</th>
                            <th>Consider Value</th>
                            <th>Amount to Use</th>
                            <th>Free Limit</th>
                            <th>Coverage(%)</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody formArrayName="plantDetails">
                        <ng-container *ngFor="let plantMachinery of plantMachinery.controls; let i=index;">
                            <tr>
                                <ng-container [formGroupName]="i.toString()">
                                    <td>{{i + 1}}</td>
                                    <td>{{plantMachinery.get('fairMarketValue')?.value}}</td>
                                    <td>{{plantMachinery.get('distressValue')?.value}}</td>
                                    <td>{{plantMachinery.get('considerValue')?.value}}</td>
                                    <td>
                                        <input type="number" formControlName="usedAmount" class="form-control"
                                               (input)="calcFreeLimit(i,plantMachinery.get('considerValue')?.value, plantMachinery.get('usedAmount').value,
                                                                       'plantDetails')"
                                               [readOnly]="proposedLimit === undefined || proposedLimit <= 0">
                                        <span *ngIf="isUsedAmount[i]" class="text-danger">Amount is required!!</span>
                                    </td>
                                    <td>{{plantMachinery.get('freeLimit')?.value}}</td>
                                    <td>{{plantMachinery.get('coverage')?.value}}</td>
                                    <td>
                                        <a class="px-2 cursor" *ngIf="securityPresent[i]"
                                           (click)="toggleArray[i].toggled = !this.toggleArray[i].toggled"
                                           nbTooltip="click to view detail security">
                                            <em class="fa fa-eye"></em>
                                        </a>
                                        <button nbButton size="small"
                                                (click)="tagSecurity(plantMachinery, 'plantDetails', i)"
                                                [disabled]="limitExceed[i]">
                                            <i class="fa fa-plus"></i></button>
                                    </td>
                                </ng-container>
                            </tr>
                            <tr>
                                <td colspan="9">
                                    <ng-container *ngIf="toggleArray[i].toggled">
                                        <app-security-tagged-component
                                                [tagged]="toggleArray[i]?.security"></app-security-tagged-component>
                                    </ng-container>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
        </form>
        <table *ngIf="securityList.length > 0" class="table table-condensed table-bordered table-responsive-md text-center table-sm sb-small">
            <thead>
            <tr class="text-white sb-bg-dark">
                <th>S.N</th>
                <th>Fair Market Value</th>
                <th>Distress Value</th>
                <th>Consider Value</th>
                <th>Used Amount</th>
                <th>Free Limit</th>
                <th>Coverage(%)</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let security of securityList; let i=index;">
                <td>{{i + 1}}</td>
                <td>{{security?.fairMarketValue}}</td>
                <td>{{security?.distressValue}}</td>
                <td>{{security?.considerValue}}</td>
                <td>{{security?.usedAmount}}</td>
                <td>{{security?.freeLimit}}</td>
                <td>{{security?.coverage}}</td>
                <td>
                <td>
                    <button (click)="removeSecurity(i)"
                            class="btn btn-sm btn-flat btn-danger">
                        <em class="fa fa-trash bg-transparent"></em>
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </nb-card-body>
</nb-card>
