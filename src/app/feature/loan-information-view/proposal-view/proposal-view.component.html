<div class="row mt-1">
  <div class="col-md-12 sb-small">
    <p><strong>Proposal Details</strong> <em class="text-danger sb-small"> &nbsp;Bold row indicates
      current loan proposal</em></p>
    <ul>
      <li class="sb-medium"><i class="fas fa-check-circle"></i> = Approved
        <i class="fas fa-times-circle"></i> = Not Approved,
        <i class="text-round">N</i>ew Loan
        <i class="text-round">R</i>enewed Loan
        <i class="text-round">E</i>nhanced Loan
        <i class="text-round">C</i>losure Loan
        <i class="text-round">P</i>artial Settlement Loan
        <i class="text-round">F</i>ull Settlement Loan
        <i class="text-round">R/E</i>new With Enhancement
      </li>
      <li class="sb-medium"><span><sup>*</sup>  IR : Interest Rate ,<sup>*</sup> BR : Base Rate ,<sup>*</sup> PR : Premium Rate ,<sup>*</sup> COM : Commission ,<sup>*</sup> CM : Cash margin</span>
      </li>
    </ul>
  </div>
</div>
<div class="col-md-12">
  <div class="row">

  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <table
            class="table table-bordered table-responsive-md table-sm sb-small text-center">
      <thead>
      <tr class="sb-bg-dark text-white">
        <th>Loan Facility</th>
        <th>Existing Limit</th>
        <th *ngIf="loanType !== 'NEW_LOAN'">Outstanding</th>
        <th>Enhance</th>
        <th>Settlement</th>
        <th>Proposed Limit</th>
        <th>Existing INT/COM/CM</th>
        <!--        for non funded commision and cash margin combination to be view-->
        <th>Proposed INT/COM/CM</th>

        <th>Service Charge</th>
        <th>Limit Expiry/Tenure</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let loan of customerAllLoanList"
          [class.font-weight-bold]="proposalData?.id === loan?.proposal?.id">
        <td class="text-left">
          <ng-container
                  *ngTemplateOutlet="tickCross; context: { $implicit: loan?.documentStatus}"></ng-container>
          &nbsp;|&nbsp;
          <ng-container
                  *ngTemplateOutlet="loanTypeLetter; context: { $implicit: loan?.loanType }"></ng-container>
          &nbsp;|&nbsp;
          {{ loan?.loan?.name }} ({{ loan?.createdAt | date }})
        </td>
        <td class="text-right pr-1"><span
                *ngIf="(loan?.proposal?.data | jsonParse)?.existingLimit">Rs. {{(loan?.proposal?.data | jsonParse)?.existingLimit | currencyFormatter}}</span>
          <span *ngIf="!(loan?.proposal?.data | jsonParse)?.existingLimit">-</span></td>
        <td class="text-right pr-1" *ngIf="loanType !== 'NEW_LOAN'">
                    <span *ngIf="(loan?.proposal?.data | jsonParse)?.outStandingLimit && (loanType === 'RENEWED_LOAN' || loanType === 'RENEW_WITH_ENHANCEMENT')">
                    Rs. {{(loan?.proposal?.data | jsonParse)?.outStandingLimit | currencyFormatter}}</span>
          <span *ngIf="!(loan?.proposal?.data | jsonParse)?.outStandingLimit && loanType !== 'RENEWED_LOAN' || loanType !== 'RENEW_WITH_ENHANCEMENT'">-</span>
        </td>
        <td class="text-right pr-1">
                    <span *ngIf="(loan?.proposal?.data | jsonParse)?.outStandingLimit && loanType === 'ENHANCED_LOAN'">
                        Rs. {{(loan?.proposal?.data | jsonParse)?.outStandingLimit | currencyFormatter}}
                    </span>
          <span *ngIf="(loan?.proposal?.data | jsonParse)?.enhanceLimitAmount && loanType === 'RENEW_WITH_ENHANCEMENT'">
                        Rs. {{(loan?.proposal?.data | jsonParse)?.enhanceLimitAmount | currencyFormatter}}
                    </span>
          <span *ngIf="!(loan?.proposal?.data | jsonParse)?.outStandingLimit || !(loan?.proposal?.data | jsonParse)?.enhanceLimitAmount &&
          (loanType !== 'ENHANCED_LOAN' && loanType !== 'RENEW_WITH_ENHANCEMENT')">-</span>
        </td>
        <td class="text-right pr-1"><span *ngIf="(loan?.proposal?.data | jsonParse)?.outStandingLimit && loanType === 'FULL_SETTLEMENT_LOAN' || loanType === 'PARTIAL_SETTLEMENT_LOAN'">
                    Rs. {{(loan?.proposal?.data | jsonParse)?.outStandingLimit | currencyFormatter}}
                </span>
          <span *ngIf="!(loan?.proposal?.data | jsonParse)?.outStandingLimit || loanType !== 'FULL_SETTLEMENT_LOAN' || loanType === 'PARTIAL_SETTLEMENT_LOAN'">-</span></td>

        <td class="text-right pr-1">Rs. {{loan?.proposal?.proposedLimit | currencyFormatter}}</td>
        <!--                Existing INT/COM/CM-->
        <td>-</td>
        <td>
          <span *ngIf="loan?.loan?.isFundable">

           BR : {{ (loan?.proposal?.data | jsonParse)?.baseRate}} %,
              PR : {{ (loan?.proposal?.data | jsonParse)?.premiumRateOnBaseRate}} %,
         IR : {{(loan?.proposal?.data | jsonParse)?.interestRate}} %

           </span>
          <span *ngIf="!loan?.loan?.isFundable">
                        <span
                                *ngIf="(loan?.proposal?.data | jsonParse)?.cashMarginMethod == 'FLAT'">CM: Rs.  {{ ((loan?.proposal?.data | jsonParse)?.cashMargin || 0)|currencyFormatter}} ,</span>
                        <span *ngIf="(loan?.proposal?.data | jsonParse)?.cashMarginMethod == 'PERCENT'">CM: {{ ((loan?.proposal?.data | jsonParse)?.cashMargin || 0)}}
                          %,</span>
                        COM:{{(loan?.proposal?.data | jsonParse)?.commissionPercentage || '0'}} %</span>
        </td>
        <td>
          <div *ngIf="(loan?.proposal?.data | jsonParse)?.serviceChargeMethod === 'FLAT'; else percentage" class="text-right pr-1">Rs. {{(loan?.proposal?.data | jsonParse)?.serviceCharge | currencyFormatter}}</div>
          <ng-template #percentage>
            <div class="text-right pr-1">
              {{(loan?.proposal?.data | jsonParse)?.serviceCharge}} %
            </div>
          </ng-template>
        </td>
        <td width="150px" class="text-left pl-1">
          <span *ngIf="!loan.proposal.limitExpiryMethod">-</span>
          <span *ngIf="loan.proposal.limitExpiryMethod === 'ABSOLUTE'">{{loan.proposal?.dateOfExpiry | date}}</span>
          <span *ngIf="loan.proposal.limitExpiryMethod === 'CUSTOM'">{{loan.proposal?.duration}} {{loan.proposal?.frequency}} {{loan.proposal?.condition}}</span>
        </td>
      </tr>
      <tr class="sb-bg-secondary text-white">
        <td class="text-left pl-1"><strong>Funded</strong></td>
        <td class="text-right pr-1">Rs. {{ (getTotalFundable('existingLimit', true, customerAllLoanList)) | currencyFormatter }}</td>
        <td class="text-right pr-1" *ngIf="loanType !== 'NEW_LOAN'">
                    <span *ngIf="loanType === 'RENEWED_LOAN' || loanType === 'RENEW_WITH_ENHANCEMENT'">
                        Rs. {{ getTotalFundable('outStandingLimit', true, customerAllLoanList) | currencyFormatter }}
                    </span>
          <span *ngIf="loanType !== 'RENEWED_LOAN' && loanType !== 'RENEW_WITH_ENHANCEMENT'">-</span>
        </td>
        <td class="text-right pr-1">
                    <span *ngIf="loanType === 'ENHANCED_LOAN'">
                        Rs. {{ getTotalFundable('outStandingLimit', true, customerAllLoanList) | currencyFormatter }}
                    </span>
          <span *ngIf="loanType !== 'ENHANCED_LOAN'">-</span>
        </td>
        <td class="text-right pr-1">
                    <span *ngIf="loanType === 'PARTIAL_SETTLEMENT_LOAN'|| loanType === 'FULL_SETTLEMENT_LOAN'">
                        Rs. {{ getTotalFundable('outStandingLimit', true, customerAllLoanList) | currencyFormatter }}
                    </span>
          <span *ngIf="loanType !== 'PARTIAL_SETTLEMENT_LOAN'|| loanType !== 'FULL_SETTLEMENT_LOAN'">-</span>
        </td>
        <td class="text-right pr-1">Rs. {{ getTotalFundable('proposedLimit', true, customerAllLoanList) | currencyFormatter }}</td>
        <td>-</td>
        <td>-</td>
        <td>-</td>
        <td>-</td>
      </tr>
      <tr class="sb-bg-secondary text-white">
        <td class="text-left pl-1"><strong>Non-Funded</strong></td>
        <td class="text-right pr-1">Rs. {{ (getTotalFundable('existingLimit', false, customerAllLoanList) | currencyFormatter)}}</td>
        <td class="text-right pr-1" *ngIf="loanType !== 'NEW_LOAN'">
                    <span *ngIf="loanType==='RENEWED_LOAN' || loanType === 'RENEW_WITH_ENHANCEMENT'">
                        Rs. {{ getTotalFundable('outStandingLimit', false, customerAllLoanList) | currencyFormatter }}
                    </span>
          <span *ngIf="loanType !=='RENEWED_LOAN' && loanType !== 'RENEW_WITH_ENHANCEMENT'">-</span>
        </td>
        <td class="text-right pr-1">
                    <span *ngIf="loanType==='ENHANCED_LOAN'">
                        Rs. {{ getTotalFundable('outStandingLimit', false, customerAllLoanList) | currencyFormatter }}
                    </span>
          <span *ngIf="loanType !== 'ENHANCED_LOAN'">-</span>
        </td>
        <td class="text-right pr-1">
                    <span *ngIf="loanType === 'PARTIAL_SETTLEMENT_LOAN' || loanType === 'FULL_SETTLEMENT_LOAN'">
                        Rs. {{ getTotalFundable('outStandingLimit', false, customerAllLoanList) | currencyFormatter }}
                    </span>
          <span *ngIf="loanType !== 'PARTIAL_SETTLEMENT_LOAN' || loanType !== 'FULL_SETTLEMENT_LOAN'">-</span>
        </td>
        <td class="text-right pr-1">Rs. {{ getTotalFundable('proposedLimit', false, customerAllLoanList) | currencyFormatter }}</td>
        <td>-</td>
        <td>-</td>
        <td>-</td>
        <td>-</td>
      </tr>
      <tr class="sb-bg-secondary text-white">
        <td class="text-left pl-1"><strong>Total</strong></td>

        <td class="text-center pr-1">Rs. {{ getTotal('existingLimit') | currencyFormatter }}</td>
        <td class="text-right pr-1" *ngIf="loanType !== 'NEW_LOAN'">
          <span *ngIf="loanType === 'RENEWED_LOAN' || loanType === 'RENEW_WITH_ENHANCEMENT'">Rs. {{ getTotal('outStandingLimit') | currencyFormatter }}</span>
          <span *ngIf="loanType !== 'RENEWED_LOAN' && loanType !== 'RENEW_WITH_ENHANCEMENT'">-</span>
        </td>
        <td class="text-right pr-1">
          <span *ngIf="loanType === 'ENHANCED_LOAN'">Rs. {{ getTotal('outStandingLimit') | currencyFormatter }}</span>
          <span *ngIf="loanType !== 'ENHANCED_LOAN'">-</span>
        </td>
        <td class="text-right pr-1">
          <span *ngIf="loanType === 'PARTIAL_SETTLEMENT_LOAN' || loanType === 'FULL_SETTLEMENT_LOAN'">Rs. {{ getTotal('outStandingLimit') | currencyFormatter }}</span>
          <span *ngIf="loanType !== 'PARTIAL_SETTLEMENT_LOAN' || loanType !== 'FULL_SETTLEMENT_LOAN'">-</span>
        </td>
        <td class="text-right pr-1">Rs. {{ getTotal('proposedLimit') | currencyFormatter }}</td>
        <td>-</td>
        <td>-</td>
        <td>-</td>
        <td>-</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #tickCross let-status>
  <i *ngIf="status === DocStatus[DocStatus.APPROVED]" class="fas fa-check-circle"></i>
  <i *ngIf="status !== DocStatus[DocStatus.APPROVED]" class="fas fa-times-circle"></i>
</ng-template>
<ng-template #loanTypeLetter let-loanType>
  <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.NEW_LOAN)" class="text-round">N</i>
  <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.RENEWED_LOAN)"
     class="text-round">R</i>
  <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.ENHANCED_LOAN)"
     class="text-round">E</i>
  <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.CLOSURE_LOAN)"
     class="text-round">C</i>
  <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.PARTIAL_SETTLEMENT_LOAN)"
     class="text-round">P</i>
  <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.FULL_SETTLEMENT_LOAN)"
     class="text-round">F</i>
  <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.RENEW_WITH_ENHANCEMENT)"
     class="text-round">R/E</i>
</ng-template>
<div class="row">
  <div class="col-md-12 sb-medium">
    <strong>Propose Amount:</strong>
    Rs. {{loanDataHolder?.proposal?.proposedAmountInWords}}
    Only /-
  </div>
  <div class="col-md-12">
    <table
            class="table table-sm table-condensed table-bordered table-responsive-md text-center table-sm sb-small ">

      <tr class="text-white sb-bg-dark">
        <th *ngIf="isFixedDeposit">Coupon Rate</th>
        <th *ngIf="isFixedDeposit">Premium On Coupon Rate</th>
        <th *ngIf="loanNatureSelected && fundableNonFundableSelcted && isFundable && isRevolving">Tenure of each deal</th>
        <th *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral">Prepayment Charge</th>
        <th>Collateral requirement (in%)</th>
      </tr>
      <tr>
        <th *ngIf="isFixedDeposit" class="text-right pr-1">{{proposalAllData?.couponRate}}</th>
        <th *ngIf="isFixedDeposit" class="text-right pr-1">{{proposalAllData?.premiumOnCouponRate}}</th>
        <td *ngIf="loanNatureSelected && fundableNonFundableSelcted && isFundable && isRevolving" class="text-right pr-1">{{proposalAllData?.tenorOfEachDeal}}</td>
        <td *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral" class="text-right pr-1">{{proposalAllData?.prepaymentCharge}}%</td>
        <td class="text-right pr-1">{{proposalAllData?.collateralRequirement}}%</td>
      </tr>
    </table>
    <table
            class="table table-sm table-condensed table-bordered table-responsive-md text-center table-sm sb-small ">
      <tr class="text-white sb-bg-dark">
        <th *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral">Tenure Duration in Month</th>
        <th *ngIf="(loanNatureSelected && fundableNonFundableSelcted &&  isFundable &&  isTerminating) || isVehicle || isShare || isGeneral">Repayment Mode</th>
        <th *ngIf="showInstallmentAmount  && ((loanNatureSelected && fundableNonFundableSelcted &&  isFundable &&  isTerminating) || isVehicle || isShare || isGeneral)">Installment Amount</th>
        <th *ngIf="!showInstallmentAmount &&  ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))">Interest Amount</th>
        <th *ngIf="showRepaymentMode && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))">Interest Payment</th>
        <th *ngIf="showRepaymentMode && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))">Principal Payment</th>
        <th *ngIf="showRepaymentMode && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))">Principal Amount</th>
        <th *ngIf="showPrincipalAmount && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))">Principal Amount</th>
        <th *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isGeneral">Moratorium Period (Month)</th>
        <th *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral">Commitment Fee</th>
        <th *ngIf="(checkedData?.swapChargeChecked && (client === clientName?.ICFC))">Swap Charge</th>
        <th *ngIf="checkedData?.subsidizedLoanChecked && (client !== clientName?.MEGA)">Subsidized Loan/Discount Rate</th>
        <th *ngIf="checkedData?.subsidizedLoanChecked && (client !== clientName?.MEGA)">Subsidized Loan Type</th>
        <th *ngIf="checkedData?.subsidizedLoanChecked && (client !== clientName?.MEGA) && proposalAllData?.others !== null">Others</th>
      </tr>
      <tr>
        <td *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral" class="text-right pr-1">{{proposalAllData?.tenureDurationInMonths}}</td>
        <td *ngIf="(loanNatureSelected && fundableNonFundableSelcted &&  isFundable &&  isTerminating) || isVehicle || isShare || isGeneral" class="text-left pl-1">{{proposalAllData?.repaymentMode}}</td>
        <td *ngIf="showInstallmentAmount  && ((loanNatureSelected && fundableNonFundableSelcted && isTerminating  && isFundable) || ( isVehicle || isShare || isGeneral))" class="text-right pr-1">Rs. {{proposalAllData?.installmentAmount | currencyFormatter}}</td>
        <td *ngIf="!showInstallmentAmount &&  ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))" class="text-right pr-1">Rs. {{proposalAllData?.interestAmount | currencyFormatter}}</td>
        <td *ngIf="showRepaymentMode && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))" class="text-left pl-1">{{proposalAllData?.repaymentModeInterest}}</td>
        <td *ngIf="showRepaymentMode && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))" class="text-left pl-1">{{proposalAllData?.repaymentModePrincipal}}</td>
        <td *ngIf="showRepaymentMode && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))" class="text-right pr-1">Rs.{{proposalAllData?.principalAmount}}</td>
        <td *ngIf="showPrincipalAmount && ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral))" class="text-right pr-1">Rs.{{proposalAllData?.principalAmount}}</td>
        <td *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral" class="text-right pr-1">{{proposalAllData?.moratoriumPeriod}}</td>
        <td *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral" class="text-right pr-1">{{proposalAllData?.commitmentFee}} %</td>
        <td *ngIf="checkedData?.swapChargeChecked && (client === clientName?.ICFC)">
          <div *ngIf="proposalAllData.swapChargeMethod === 'FLAT'; else percentage" class="text-right pr-1">Rs. {{proposalAllData.swapCharge | currencyFormatter}}</div>
          <ng-template #percentage>
            <div class="text-right pr-1">{{proposalAllData.swapCharge}} %</div>
          </ng-template></td>
        <td class="text-right pr-1" *ngIf="checkedData?.subsidizedLoanChecked && (client !== clientName?.MEGA)">{{proposalAllData?.subsidizedLoan}}%</td>
        <td class="text-center" *ngIf="checkedData?.subsidizedLoanChecked && (client !== clientName?.MEGA)">{{proposalAllData?.subsidyLoanType}}</td>
        <td class="text-center" *ngIf="checkedData?.subsidizedLoanChecked && (client !== clientName?.MEGA) && proposalAllData?.others !== null">{{proposalAllData?.others}}</td>
      </tr>
    </table>

    <table
            class="table table-sm table-condensed table-bordered table-responsive-md text-center table-sm sb-small ">

      <tr class="text-white sb-bg-dark">
        <th>Disbursement
          Criteria
        </th>
      </tr>
      <tr>
        <td class="text-left pl-1">{{proposalAllData?.disbursementCriteria}}</td>
      </tr>
      <tr class="text-white sb-bg-dark">
        <th>Repayment</th>
      </tr>
      <tr>
        <td class="text-left pl-1">{{proposalAllData?.repayment}}</td>
      </tr>
      <tr class="text-white sb-bg-dark">
        <th *ngIf="client !== clientName?.MEGA">Background</th>
        <th *ngIf="client === clientName?.MEGA">Justification of limit</th>
      </tr>
      <tr>
        <td class="text-left pl-1"><span [innerHTML]="proposalAllData?.borrowerInformation  | safeHtml"></span> </td>
      </tr>
      <tr class="text-white sb-bg-dark">
        <th>Summery & Recommendation</th>
      </tr>
      <tr>
        <td class="text-left pl-1"><span [innerHTML]="proposalAllData?.summeryRecommendation  | safeHtml"></span> </td>
      </tr>
      <tr class="text-white sb-bg-dark">
        <th>Remarks</th>
      </tr>
      <tr>
        <td class="text-left pl-1">{{proposalAllData?.remark}}</td>
      </tr>
      <tr class="text-white sb-bg-dark" *ngIf="client !== clientName?.MEGA">
        <th>Purpose of Loan</th>
      </tr>
      <tr>
        <td class="text-left pl-1" *ngIf="client !== clientName?.MEGA">{{proposalAllData?.purposeOfLoan}}</td>
      </tr>
      <ng-container *ngIf="checkedData?.waiverChecked">
        <tr class="text-white sb-bg-dark">
          <th>Waiver/Deviation</th>
        </tr>
        <tr>
          <td class="text-left pl-1"><span [innerHTML]="proposalAllData?.waiverConclusionRecommendation | safeHtml"></span></td>
        </tr>
      </ng-container>
      <ng-container *ngIf="checkedData?.solChecked">
        <tr class="text-white sb-bg-dark">
          <th>Single Obligor Limit</th>
        </tr>
        <tr>
          <td class="text-left pl-1"><span [innerHTML]="proposalAllData?.solConclusionRecommendation | safeHtml"></span></td>
        </tr>
      </ng-container>
      <ng-container *ngIf="checkedData?.riskChecked">
        <tr class="text-white sb-bg-dark">
          <th>Risk &
            Mitigation</th>
        </tr>
        <tr>
          <td class="text-left pl-1"><span [innerHTML]="proposalAllData?.riskConclusionRecommendation | safeHtml"></span></td>
        </tr>
      </ng-container>

    </table>
  </div>
</div>
