<nb-card [nbSpinner]="spinner" accent="primary">
    <nb-card-header>
        <div class="row shadow-sm">
            <div class="col-md-2">
                <strong>Associate Group:</strong> <span> {{customerInfo?.customerGroup != undefined ?  customerInfo?.customerGroup?.groupCode : ' N/A'}}</span>
            </div>
            <div class="offset-4 col-md-6 float-right">
                <button [nbPopover]="groupWindow" class="float-right mb-3" nbButton size="small" [nbPopoverPlacement]="'left'">
                    Groups
                    <nb-icon icon="arrow-down-outline"></nb-icon>
                </button>
                <div class="row">
                    <ng-template #groupWindow>
                        <app-group-tagging [customerData]="customerInfo"></app-group-tagging>
                    </ng-template>
                </div>
            </div>
        </div>
    </nb-card-header>
    <nb-card-body>
        <div class="bg-light mb-3">
            <div class="row">
                <div class="col">
                    <a *ngIf="!isEdited" class="p-2 cursor"><em class="fa fa-edit"></em></a>
                </div>
            </div>
            <div class="p-5 row">
                <div class="d-flex col-md-3">
                    <div class="profile-img">
                        <label class="container">
                            <div class="bg-info no-img">
                                <div>
                                    <span class="text">NA</span>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                <div *ngIf="!isEdited" class="col-md-9 mt-3 py-4">

                    <div class="row">
                        <span> <strong>Company name :</strong> {{companyInfo?.companyName}}</span></div>
                    <div class="row">
                        <span> <strong>Registration number :</strong> {{companyInfo?.registrationNumber}}</span></div>
                    <div class="row">
                        <span> <strong>Establishment Date :</strong> {{companyInfo?.establishmentDate | date}}</span></div>

                    <div class="row">
                    <span> <strong>Address :</strong> {{companyInfo?.companyLocations?.address}}
                        , {{companyInfo?.companyLocations?.streetName}}
                        , {{companyInfo?.companyLocations?.houseNumber}}</span></div>
                    <div class="row">
                        <span> <strong>PAN number :</strong> {{companyInfo?.panNumber}}</span></div>
                    <div class="row">
                        <span> <b>Business type :</b> {{companyInfo?.businessType }}</span></div>

                </div>
                <!--<div *ngIf="isEdited" class="col-md-9 mt-3 py-4">
                    <form [formGroup]="basicForm">
                        <div class="row form-inline">
                        <span> <b>Name :</b> <input formControlName="customerName"
                                                    placeholder="name"
                                                    type="text"></span></div>
                        <div class="row form-inline">
                        <span> <b>Date Of Birth :</b>      <input [nbDatepicker]="dob"
                                                                  class="form-control"
                                                                  formControlName="dob"
                                                                  id="dob"
                                                                  name="dob"
                                                                  placeholder="Customer Date of birth">
                         <nb-datepicker #dob></nb-datepicker></span></div>

                        <div class="row">
                    <span> <b>Address :</b> <select
                            (change)="getDistricts(this.basicForm.get('province').value)"
                            formControlName="province"
                            id="province"
                            name="province">
                                <option [value]="null" hidden>Select Province</option>
                                <option *ngFor="let provinceVal of provinceList"
                                        [ngValue]="provinceVal"
                                        [selected]="provinceVal.id === province?.id">
                                    {{provinceVal.name}}
                            </select>
                        <select (change)="getMunicipalities(this.basicForm.get('district').value)"
                                formControlName="district"
                                id="district"
                                name="district">
                                <option [ngValue]="null" hidden>Select District</option>
                                <option *ngFor="let districtVal of districtList"
                                        [ngValue]="districtVal"
                                        [selected]="districtVal.id === district?.id">{{districtVal.name}}

                                </option>
                            </select>
                           <select formControlName="municipalities"
                                   id="municipality"
                                   name="municipality">
                                <option [ngValue]="null" hidden>Select Municipality</option>
                                <option *ngFor="let municipalityVal of municipalitiesList"
                                        [ngValue]="municipalityVal"
                                        [selected]="municipalityVal.id === municipality?.id">
                                    {{municipalityVal.name}}
                                </option>
                            </select>
                        <input formControlName="street" placeholder="street Address"
                               type="text">
                             <input formControlName="wardNumber" placeholder="ward no."
                                    type="text" width="20px">

                      </span></div>
                        <div class="row">
                        <span> <b>Email :</b>   <input formControlName="email" placeholder="name"
                                                       type="text"></span></div>
                        <div class="row">
                        <span> <b>Contact :</b>   <input formControlName="contactNumber"
                                                         placeholder="name"
                                                         type="text"></span></div>
                    </form>

                </div>-->
            </div>
            <div class="row justify-content-end">
                <button *ngIf="isEdited" nbButton size="small"
                        status="warning" type="button">Cancel
                </button>
                <div class="px-2">
                    <button *ngIf="isEdited" nbButton size="small"
                            status="danger" type="button">Save
                    </button>
                </div>
                <div class="px-2">
                    <button  (click)="openSelectLoanTemplate(loanListTemplate)" *ngIf="!isEdited"
                            nbButton size="small" type="button">Apply Loan
                    </button>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="d-block mb-3">
          <span class="d-flex justify-content-end text-success text-uppercase">
            <b>Aggregated Amount : {{totalProposalAmount |number}}</b>
          </span>
                </div>
                <nb-card accent="primary">
                    <nb-card-header>
                        Loan History
                        <div class="float-right" nbTooltip="">Total Loan Amount
                            : {{totalLoanProposedAmount | number}}
                        </div>
                    </nb-card-header>
                    <nb-card-body>
                        <app-customer-group-loan></app-customer-group-loan>
                    </nb-card-body>
                </nb-card>
                <nb-card accent="primary">
                    <nb-card-header>
                        Additional Information
                    </nb-card-header>
                    <nb-card-body>
                        <nb-accordion>
                            <nb-accordion-item>
                                <nb-accordion-item-header>
                                    <div class="row col-md-12">
                                        <div class="col-md-6">
                                            <span>Management Team</span>
                                        </div>
                                    </div>
                                </nb-accordion-item-header>
                                <nb-accordion-item-body>
                                    <table aria-describedby="management team table" class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Name</th>
                                            <th scope="col">Designation</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr *ngFor="let singleManagementTeam of companyInfo?.managementTeamList;
                                        let i = index">
                                            <td scope="row">{{i}}</td>
                                            <td>{{singleManagementTeam?.name}}</td>
                                            <td>{{singleManagementTeam?.designation}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </nb-accordion-item-body>
                            </nb-accordion-item>
                            <nb-accordion-item>
                                <nb-accordion-item-header>
                                    <div class="row col-md-12">
                                        <div class="col-md-6">
                                            <span>Information of Proprietor/Shareholder/Partner</span>
                                        </div>
                                    </div>
                                </nb-accordion-item-header>
                                <nb-accordion-item-body>
                                    <table aria-describedby="proprietor info table" class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Name</th>
                                            <th scope="col">Contact No.</th>
                                            <th scope="col">Share</th>
                                            <th scope="col">Province</th>
                                            <th scope="col">District</th>
                                            <th scope="col">Municipality/VDC</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr *ngFor="let singleProprietorInfo of companyInfo?.proprietorsList;
                                        let i = index">
                                            <td scope="row">{{i}}</td>
                                            <td>{{singleProprietorInfo?.name}}</td>
                                            <td>{{singleProprietorInfo?.contactNo}}</td>
                                            <td>{{singleProprietorInfo?.share}}</td>
                                            <td>{{singleProprietorInfo?.province?.name}}</td>
                                            <td>{{singleProprietorInfo?.district?.name}}</td>
                                            <td>{{singleProprietorInfo?.municipalityVdc?.name}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </nb-accordion-item-body>
                            </nb-accordion-item>
                            <nb-accordion-item>
                                <nb-accordion-item-header>
                                    <div class="row col-md-12">
                                        <div class="col-md-6">
                                            <span>SWOT Analysis</span>
                                        </div>
                                    </div>
                                </nb-accordion-item-header>
                                <nb-accordion-item-body>
                                    <table aria-describedby="swot table" class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th scope="col">Strengths</th>
                                            <th scope="col">Weaknesses</th>
                                            <th scope="col">Opportunities</th>
                                            <th scope="col">Threats</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>{{companyInfo?.swot?.strength}}</td>
                                            <td>{{companyInfo?.swot?.weakness}}</td>
                                            <td>{{companyInfo?.swot?.opportunity}}</td>
                                            <td>{{companyInfo?.swot?.threats}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </nb-accordion-item-body>
                            </nb-accordion-item>
                        </nb-accordion>
                    </nb-card-body>

                </nb-card>
            </div>
            <div class="col-md-4">
                <nb-card accent="primary" style="height: 650px">
                    <nb-card-body>
                        <app-company-profile-additional-information [companyInfo]="companyInfo">
                        </app-company-profile-additional-information>
                    </nb-card-body>
                </nb-card>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <app-customer-loan-information
                        (triggerCustomerRefresh)="refreshCustomerInfo()"
                        *ngIf="customerInfo && maker"
                        [customerInfoId]="customerInfoId"
                        [customerInfo]="customerInfo"></app-customer-loan-information>
                <app-customer-loan-information-view *ngIf="!maker" [customerInfo]="customerInfo" ></app-customer-loan-information-view>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <app-customer-doc [customerInfo]="customerInfo" *ngIf="customerInfo" (refreshCustomerInfo)="refreshCustomerInfo()"></app-customer-doc>
            </div>
        </div>
    </nb-card-body>
</nb-card>

<ng-template #loanListTemplate>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Apply</h4>
        <a (click)="onClose()" aria-label="Close" class="close pull-right cursor">
            <span aria-hidden="true">&times;</span>
        </a>
    </div>
    <div class="modal-body">
        <form #f="ngForm" (ngSubmit)="f.form.valid && openLoanForm()">
            <div class="col-md-12 row">

                <div class="col-md-6">
                    <select #type="ngModel"
                            [(ngModel)]="applyForm.loanId"
                            [ngClass]="{ 'is-invalid': f.submitted && type.invalid }"
                            class="form-control rounded"
                            name="loanId" required>
                        <option [ngValue]="undefined" hidden> select Loan Type</option>
                        <option *ngFor="let allList of loanList"
                                [ngValue]="allList.id">{{allList.name}}</option>
                    </select>
                </div>

            </div>

            <div class="col-md-12 py-2">
                <button class="btn btn-success float-right" type="submit"
                >Next
                </button>
            </div>
        </form>
    </div>

</ng-template>
