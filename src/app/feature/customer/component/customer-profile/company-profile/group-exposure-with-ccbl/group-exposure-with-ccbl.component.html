<div class="row" [formGroup]="form" [nbSpinner]="spinner">
    <div class="col-md-12">
        <div class="form-group">
            <label for="groupName">Group Name</label>
            <input class="form-control"
                   placeholder="Group Name" id="groupName" formControlName="groupName">
        </div>
        <div class="form-group">
            <label for="groupCode">Group Code</label>
            <input class="form-control"
                   placeholder="Group Code" id="groupCode" formControlName="groupCode">
        </div>

    </div>
    <div class="col-md-12">
        <div class="form-group">
            <label>Group Exposure Date</label>
            <div class="row">
                <div class="col-md-4">
                    <div class="d-flex">
                        <nb-radio-group class="d-inline-flex"
                                        formControlName="groupExposureDateType">
                            <nb-radio value="AD">AD</nb-radio>
                            <nb-radio value="BS">BS</nb-radio>
                        </nb-radio-group>
                    </div>
                </div>
                <div class="col-md-4">
                    <input [nbDatepicker]="issuedYear"
                           *ngIf="form.get('groupExposureDateType').value === 'AD'"
                           class="form-control form-control-sm-error rounded"
                           formControlName="groupExposureDate"
                           id="groupExposureDate"
                           name="groupExposureDate"
                           placeholder="Group Exposure Date"
                           type="text">
                    <app-calendar
                            [ePreDate]="form.get('groupExposureDate').value"
                            *ngIf="form.get('groupExposureDateType').value === 'BS'"
                            (messageToEmit)="form.get('groupExposureDate').patchValue($event?.eDate)"></app-calendar>
                    <nb-datepicker #issuedYear></nb-datepicker>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12" *ngIf="customerInfo?.customerType === 'INSTITUTION'">
        <div class="form-group">
            <label for="detailInformation"><b>DETAIL INFORMATION</b></label>
            <ckeditor id="detailInformation" formControlName="detailInformation"
                      [config]="ckeConfig"></ckeditor>
        </div>
    </div>
    <div class="col-md-12" *ngIf="customerInfo?.customerType === 'INSTITUTION'">
        <div class="form-group">
            <label for="outstandingOverdue"><b>Outstanding Overdue and R/E collateral</b></label>
            <ckeditor id="outstandingOverdue" formControlName="outstandingOverdue"
                      [config]="ckeConfig"></ckeditor>
        </div>
    </div>

    <div class="col-md-12">
        <div class="form-group">
            <label><b>GROUP LIMITS</b></label>
            <table>
                <thead class="sb-bg-dark text-white">
                <tr class="table table-bordered table-responsive-md table-hover table-sm sb-small text-center">
                    <th rowspan="2" colspan="2">Group concerns/Borrowers</th>
                    <th colspan="3">Existing</th>
                    <th colspan="3">Proposed</th>
                    <th rowspan="2">Change</th>
                    <th rowspan="2">Pricing</th>
                    <th rowspan="2">Maturity</th>
                    <th *ngIf="form.get('groupLimit')['length'] > 1" rowspan="2">Action</th>
                </tr>
                <tr>
                    <th>FB limit</th>
                    <th>NFB limit</th>
                    <th>Total</th>
                    <th>FB limit</th>
                    <th>NFB limit</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody formArrayName="groupLimit"
                       *ngFor="let gl of form.get('groupLimit')['controls']; let i = index">
                <tr [formGroupName]="i">
                    <td class="sn text-center">{{i+1}}</td>
                    <td><input class="form-control text-center"
                               formControlName="concernName"
                               placeholder="Group Concerns/Borrowers"
                               type="text"/></td>
                    <td><input (change)="calculateTotal(i)"
                               class="form-control text-center"
                               formControlName="exFunded"
                               placeholder="Funded Limit"
                               type="number"/></td>
                    <td><input (change)="calculateTotal(i)"
                               class="form-control text-center"
                               formControlName="exNonFunded"
                               placeholder="Non-Funded Limit"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="exTotal"
                               placeholder="Total"
                               type="number"/></td>
                    <td><input (change)="calculateTotal(i)"
                               class="form-control text-center"
                               formControlName="proFunded"
                               placeholder="Funded limit"
                               type="number"/></td>
                    <td><input (change)="calculateTotal(i)"
                               class="form-control text-center"
                               formControlName="proNonFunded"
                               placeholder="Non-Funded Limit"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="proTotal"
                               placeholder="Total"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="changeAmount"
                               placeholder="Changes"
                               type="number"/></td>
                    <td><input class="form-control text-center"
                               formControlName="pricing"
                               placeholder="Pricing"
                               type="text"/></td>
                    <td><input class="form-control text-center"
                               formControlName="maturity"
                               placeholder="Maturity"
                               type="text"/></td>
                    <td *ngIf="form.get('groupLimit')['length'] > 1">
                        <input (click)="removeData(i, 'groupLimit')"
                               class="align-self-end btn btn-sm btn-danger btn-primary"
                               type="button" value="Delete"/>
                    </td>
                </tr>
                </tbody>
                <tbody>
                <tr class="sb-bg-secondary text-white">
                    <td></td>
                    <td>Total</td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="totalExFunded"
                               placeholder="Total Funded"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="totalExNonFunded"
                               placeholder="Total Non Funded"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="totalExTotal"
                               placeholder="Total"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="totalProFunded"
                               placeholder="Total Funded"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="totalProNonFunded"
                               placeholder="Total Non Funded"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="totalProTotal"
                               placeholder="Total"
                               type="number"/></td>
                    <td><input [readOnly]="true"
                               class="form-control text-center"
                               formControlName="totalChanges"
                               placeholder="Total Changes"
                               type="number"/></td>
                </tr>
                </tbody>
            </table>
            <div class="text-right">
                <input (click)="addGroupPosition()" class="btn btn-sm btn-flat btn-primary"
                       type="button" value="Add More"/>
            </div>
        </div>
    </div>
    <hr>
    <div class="col-md-12">
            <label><b>NAME OF THE COMPANIES UNDER THE GROUP</b></label>
        <div class="row">
            <div *ngFor="let cn of form?.get('companyGroup')['controls']; let ii = index"
                 formArrayName="companyGroup" class="col-md-4">
                <label for="name"><strong>Company Name {{ii + 1}}</strong></label>
                <div [formGroupName]="ii" class="form-group">
                    <input formControlName="name"
                           class="form-control"
                           id="name"
                           placeholder="Enter Name"/>
                    <div class="mt-2">
                        <button (click)="removeData(ii, 'companyGroup')"
                                *ngIf="form?.get('companyGroup')['length'] > 1"
                                nbButton size="small"
                                status="danger">
                            <nb-icon icon="trash-outline"></nb-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <button (click)="addCompany()"
                nbButton status="primary" size="small" class="pl-2"
                value="Add Account No.">Add
        </button>
    </div>

    <div class="col-md-12">
        <button nbButton (click)="onSubmit()" class="float-right">Submit</button>
    </div>
</div>
