<nb-card>
  <nb-card-header>
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-6">
          <div class="btn-group">
            <button
                (click)="isFilterCollapsed = !isFilterCollapsed"
                [attr.aria-expanded]="!isFilterCollapsed" aria-controls="searchModel"
                nbButton
                shape="rectangle"
                status="primary"
                size="small">
              <em class="fa fa-filter"> Filter</em>
            </button>

          </div>
        </div>
        <div class="col-md-6 d-flex justify-content-end">
          <button nbButton outline status="success" class="mr-2" size="small"
                  (click)="openTemplate(chooseCusType)" *ngIf="currentRoleTypeMaker">
            <i class="fa fa-plus"></i>
          </button>
          <button (click)="download()" nbButton outline
                  status="info" size="small">
            <i aria-hidden="true" class="fa fa-download"></i></button>
        </div>
      </div>
    </div>

    <div [ngbCollapse]="isFilterCollapsed" class="col-md-12" id="searchModel">
      <form [formGroup]="filterForm">
        <div class="row py-3">
          <div class="col-md-3 mb-3" *ngIf="accessSpecific || accessAll">
            <ng-select placeholder="branches" formControlName="branchIds">
              <ng-option *ngFor="let branch of branchList"
                         [value]="branch.id">{{branch.name}}</ng-option>
            </ng-select>
          </div>

          <div class="col-md-3 mb-3">
            <ng-select placeholder="Province" formControlName="provinceId">
              <ng-option *ngFor="let province of provinces"
                         [value]="province.id">{{province.name}}</ng-option>
            </ng-select>
          </div>

          <div class="col-md-3 mb-3">
            <input class="form-control rounded" formControlName="name" id="customerName"
                   placeholder="Enter customer name">
          </div>
          <div class="col-md-3 mb-3">
            <ng-select formControlName="customerType" placeholder="Customer Type">
              <ng-option value="INSTITUTION">INSTITUTION</ng-option>
              <ng-option value="INDIVIDUAL">INDIVIDUAL</ng-option>
            </ng-select>
          </div>
          <div class="col-md-3 mb-3">
            <ng-select [multiple]="false"
                       [appendTo]="'body'"
                       formControlName="idRegPlace"
                       id="idRegPlace"
                       placeholder="Id Registration place"
                       type="text">
              <ng-option *ngFor="let district of allDistrict" [value]="district?.name">
                {{district?.name}}
              </ng-option>
            </ng-select>
          </div>

          <div class="col-md-3 mb-3">
            <ng-select [multiple]="false"
                       [appendTo]="'body'"
                       formControlName="groupId"
                       id="groupId"
                       placeholder="Group"
                      >
              <ng-option *ngFor="let group of customerGroupList" [value]="group?.id">
                {{group?.groupCode}}
              </ng-option>
            </ng-select>
          </div>
        </div>

        <div class="col-md-12 p-0">
          <button (click)="onSearch()" [disabled]="!filterForm.valid" class="mr-2" nbButton
                  shape="rectangle"
                  status="info"
                  size="small">Search
          </button>
          <button nbButton shape="rectangle" (click)=" clear()" status="danger" type="button" size="small">Clear
          </button>
        </div>
      </form>
    </div>

  </nb-card-header>
  <nb-card-body>
    <br>
    <table class="table table-sm table-bordered table-hover sb-small text-center" id="add-branch-table">
      <thead>
      <tr class="sb-bg-dark text-white">
        <th>S.No.</th>
        <th *ngIf="!isMaker">Branch</th>
        <th>Customer Name</th>
        <th>Customer Type</th>
        <th>ID Number</th>
        <th>ID Issue Place</th>
        <th>ID Reg Date</th>
        <th>Email</th>
        <th>Contact No</th>
        <th>Associated Since</th>
        <th *ngIf="showBranchProvince">Branch Province</th>
        <th *ngIf="isMaker">Action</th>


      </tr>
      </thead>
      <tbody>
      <tr
          *ngFor="let model of customerList;let i=index" class="cursor">
        <td>{{(pageable.number - 1) * pageable.size + i + 1}}</td>
        <td *ngIf="!isMaker" (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.branch?.name}}</td>
        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.name}}</td>
        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.customerType}}</td>

        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.idNumber || 'NA'}}</td>
        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.idRegPlace || 'NA'}}</td>
        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.idRegDate | date}}</td>
        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.email || 'NA'}}</td>

        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.contactNo || 'NA'}}</td>
        <td (click)="customerProfile(model.associateId,model.id,model.customerType)">{{(model?.createdAt|date) || 'NA'}}</td>
        <td *ngIf="this.showBranchProvince" (click)="customerProfile(model.associateId,model.id,model.customerType)">{{model?.branch?.province?.name}}</td>
        <td *ngIf="isMaker"><button  nbButton size="tiny" shape="rectangle" (click)="editCustomer(model)"><em class="fa fa-edit"></em></button></td>
      </tr>

      </tbody>
    </table>
    <!--    <app-spinner *ngIf="spinner" class="d-flex justify-content-center"></app-spinner>-->
    <!-- ===================table-pagination==================== -->
    <app-paging (changePage)="changePage($event)" *ngIf="!spinner"
                [pageable]="pageable"></app-paging>
    <!-- ===================table-pagination==================== -->
  </nb-card-body>


</nb-card>

<ng-template #chooseCusType>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Choose Customer Type</h4>
    <a (click)="onClose()" aria-label="Close" class="close pull-right cursor">
      <span aria-hidden="true">&times;</span>
    </a>
  </div>
  <div class="modal-body">

    <div class="row">
      <div class="col-md-12">
        <ng-select [(ngModel)]="customerType" placeholder="select Customer Type">
          <ng-option value="INSTITUTION">INSTITUTION</ng-option>
          <ng-option value="INDIVIDUAL">INDIVIDUAL</ng-option>
        </ng-select>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn btn-success float-right" nbButton size="small" (click)="getForm(chooseAcType)">Next
    </button>
  </div>
</ng-template>
<ng-template #chooseAcType let-ref="dialogRef">
  <nb-card class="m-0" [nbSpinner]="onActionChangeSpinner">
    <nb-card-header>
      <a (click)="onClose()" aria-label="Close" class="close pull-right cursor">
        <span aria-hidden="true">&times;</span>
      </a>
      <h5>Are you registering as Joint Customer?</h5>
    </nb-card-header>
    <nb-card-footer>
      <div class="d-flex justify-content-end">
        <button (click)="changeAction(chooseJointNo);ref.close()" nbButton status="primary" type="submit">YES</button>
        <button (click)="onCloseJoint();ref.close()" nbButton status="warning" type="button">NO</button>
      </div>
    </nb-card-footer>
  </nb-card>
</ng-template>
<ng-template #chooseJointNo let-ref="dialogRef">
  <nb-card class="m-0" [nbSpinner]="onActionChangeSpinner">
    <nb-card-header>
      <a (click)="onClose()" aria-label="Close" class="close pull-right cursor">
        <span aria-hidden="true">&times;</span>
      </a>
      <h4>No. of Joint Customer</h4>
      <input class="form-control"
             placeholder="Please input greater or equal to 2"
             type="number"
             #joint>
    </nb-card-header>
    <nb-card-footer>
      <button class="btn btn-success float-right" nbButton size="small" (click)="onNextJointCustomer(joint.value);ref.close()">Next
      </button>
    </nb-card-footer>
  </nb-card>
</ng-template>
<app-overlay-spinner></app-overlay-spinner>
