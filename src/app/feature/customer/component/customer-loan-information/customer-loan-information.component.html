<nb-card accent="primary">
  <nb-card-header>
    Customer Loan Information
  </nb-card-header>

  <nb-card-body>
    <div class="row">
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #itemSiteVisit>
        <a class="cursor info-label" (click)="openModel(itemSiteVisitTemplate)">
          <div class="row cursor">

            <div class="col-md-8">
              <p class="custom-font">
                SITE VISIT
              </p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="customerInfo?.siteVisit" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.siteVisit" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #itemSiteVisitTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            Site Visit
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-site-visit #siteVisitComponent
                            (siteVisitDataEmitter)="saveSiteVisit($event);"
                            [formValue]="customerInfo?.siteVisit"
                            [customerInfo]="customerInfo"
                            [fromProfile]="true"></app-site-visit>
          </nb-card-body>
        </nb-card>
      </ng-template>
    </div>
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #ciclComponent>
        <a class="cursor info-label" (click)="openModel(ciclComponentTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">CICL</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="customerInfo?.cicl" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.cicl" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>

      <ng-template #ciclComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            CICL
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-cicl #ciclComponent [ciclValue]="ciclResponse" [fromProfile]="true"
                      (ciclDataEmitter)="saveCICL($event)"></app-cicl>

          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4" *ngIf="customerInfo?.customerType == customerType.INSTITUTION" >
        <div class="row">
        <nb-card class="col-md-11 py-2" #financ>
        <a class="cursor info-label" (click)="openModel(itemFinancial)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">Financial Upload</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="customerInfo?.financial" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.financial" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      </div>
      <div class="col-md-4" *ngIf=" (customerInfo?.customerType === customerType?.INDIVIDUAL)">
        <div class="row">
        <nb-card class="col-md-11 py-2" #itemFinancial>
        <a class="cursor info-label" (click)="openModel(itemFinancialTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">
                <span
                  *ngIf="customerInfo?.customerType == customerType.INDIVIDUAL">INCOME & EXPENSES</span>
              </p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="customerInfo?.financial" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.financial" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #itemFinancialTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
                <span
                    *ngIf="customerInfo?.customerType == customerType.INDIVIDUAL">INCOME & EXPENSES</span>
<!--            <span *ngIf="customerInfo?.customerType == customerType.INSTITUTION">FINANCIAL</span>-->
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-financial #financialComponent
                           (financialDataEmitter)="saveFinancial($event)"
                           [formData]="customerInfo?.financial"
                           [fromProfile]="true"></app-financial>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <ng-template #itemFinancial let-data let-ref="dialogRef">
          <nb-card class="template-css">
            <nb-card-header>
                <span
                        *ngIf="customerInfo?.customerType == customerType.INDIVIDUAL">INCOME & EXPENSES</span>
              <span *ngIf="customerInfo?.customerType == customerType.INSTITUTION">FINANCIAL</span>

              <a aria-label="Close" class="close cursor"
                 data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
            </nb-card-header>
            <nb-card-body>
              <!--            <app-financial #financialComponent-->
              <!--                           (financialDataEmitter)="saveFinancial($event)"-->

              <!--                           [formData]="customerInfo?.financial"-->
              <!--                           [fromProfile]="true"></app-financial>-->
              <app-financial-upload-view
                      [customerInfo]="customerInfo"
                      [customerInfoId] ="customerInfoId"
                      (customer)="update($event)"
                      [fromProfile]="false">
              </app-financial-upload-view>
            </nb-card-body>
          </nb-card>
      </ng-template>
      <!--      //remaining-->
      <div class="col-md-4" *ngIf="otherMicroDetailsVisibility">
      <div class="row">
        <nb-card class="col-md-11 py-2" #microCrgParamsComponent>
        <a class="cursor info-label" (click)="openModel(microCrgParamsComponentTemplate)">
          <div class="row">
            <div class="col-md-10">
              <p class="custom-font">
                <span class="text-capitalize">Other details (Mandatory for Micro CRG)</span>
                </p>
            </div>
            <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="microCrgParams" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!microCrgParams" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
      </div>
      <ng-template #microCrgParamsComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            Other details (Mandatory for Micro CRG)
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
        <app-micro-crg-params #microCrgParamsComponent

                              (dataEmitter)="saveMicroCrgParams($event)"
                              [fromProfile]="true"
                              [microCrgParams]="customerInfo?.microOtherParameters"
        ></app-micro-crg-params>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #itemIncomeFromAccount>
        <a class="cursor info-label" (click)="openModel(inccomeFromAccountComponentTemplate)">
          <div class="row">
            <div class="col-md-10">
              <p class="custom-font">EARNING, PROFITABILITY AND PRICING</p>
            </div>
            <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="customerInfo?.incomeFromAccount" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.incomeFromAccount" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #inccomeFromAccountComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>EARNING, PROFITABILITY AND PRICING
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-income-from-account [incomeFromAccountDataResponse]="incomeFromAccountDataResponse"
                                      [customerInfo]="customerInfo"
                                     [fromProfile]="true"
                                     (incomeFromAccountDataEmitter)="saveIncomeFromAccount($event)">
            </app-income-from-account>

          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4" *ngIf="customerInfo?.customerType === 'INSTITUTION'">
      <div class="row">
        <nb-card class="col-md-11 py-2" #itemNetTradingAssets>
        <a class="cursor info-label" (click)="openModel(netComponentTemplate)">
          <div class="row">
            <div class="col-md-10">
              <p class="custom-font">
                <span>NET TRADING ASSETS (NTA)</span>
              </p>
            </div>
            <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="customerInfo?.netTradingAssets" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.netTradingAssets" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
      </div>
        <ng-template #netComponentTemplate let-data let-ref="dialogRef">
          <nb-card class="template-css">
            <nb-card-header>
                <span>NET TRADING ASSETS (NTA)</span>
              <a aria-label="Close" class="close cursor"
                 data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
            </nb-card-header>
            <app-net-trading-assets
                    (netTradingAssetsEventEmitter)="saveNetTradingAssets($event)"
                    [fromProfile]=true

                    [netTradingAssetsData]="netTradingAssets">
            </app-net-trading-assets>
            <nb-card-body>
<!--        <ng-container-->
<!--            *ngIf="(client === clientName?.ICFC) || (client === clientName?.MEGA); else otherBank">-->
<!--          <app-nta-mega-->
<!--              (netTradingAssetsEventEmitter)="saveNetTradingAssets($event)"-->
<!--              [fromProfile]=true-->

<!--              [netTradingAssetsData]="netTradingAssets">-->
<!--          </app-nta-mega>-->
<!--        </ng-container>-->

        <ng-template #otherBank>
          <app-net-trading-assets
              (netTradingAssetsEventEmitter)="saveNetTradingAssets($event)"
              [fromProfile]=true

              [netTradingAssetsData]="netTradingAssets">
          </app-net-trading-assets>
        </ng-template>
            </nb-card-body>
          </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #itemSecurity>
        <a class="cursor info-label" (click)="openModel(securityComponentTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">SECURITY</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="customerInfo?.securities.length > 0" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span *ngIf="customerInfo?.securities.length === 0" style="color:red"
                    title="Status :Not Saved">
                <em class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #securityComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            SECURITY
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-security #securityComponent
                (securityDataEmitter)="saveSecurity($event)"
                          (refreshEmitter)="onRefresh()"
                [calendarType]="calendarType"
                [fromProfile]="true"
                [isMicroCustomer]="false"
                [customerType]="customerInfo?.customerType"
                [shareSecurity]="customerInfo?.shareSecurity"
                [customerInfo]="customerInfo"></app-security>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #itemGuarantor>
        <a class="cursor info-label" (click)="openModel(guarantorComponentTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">{{customerInfo?.customerType === 'INSTITUTION'?'SHAREHOLDER/GUARANTOR':'GUARANTOR'}}</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="customerInfo?.guarantors !== null" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span *ngIf="customerInfo?.guarantors == null" style="color:red"
                    title="Status :Not Saved">
                <em class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #guarantorComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            {{customerInfo?.customerType === 'INSTITUTION'?'SHAREHOLDER/GUARANTOR':'GUARANTOR'}}
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-guarantor
                       (guarantorDataEmitter)="saveGuarantor($event)"
                       [calendarType]="calendarType"
                       [fromProfile]="true"
                       [guarantorDetailValue]="customerInfo?.guarantors"
                       [customerInfo]="customerInfo"></app-guarantor>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #itemInsurance>
        <a class="cursor info-label" (click)="openModel(insuranceComponentTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">INSURANCE</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="insurance?.length>0" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="insurance?.length == 0" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #insuranceComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            INSURANCE
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
        <app-insurance
            (insuranceDataEmitter)="saveInsurance($event)"

            [insuranceDataFromModel]="customerInfo?.insurance"
            [fromProfile]="true" [customerInfo]="customerInfo"></app-insurance>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <!--<nb-accordion-item #itemCrgAlpha>
       <a class="cursor info-label">
          <div class="row col-md-12">
            <div class="col-md-8">
              <span>CREDIT RISK GRADING (ALPHA)</span>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="customerInfo?.creditRiskGradingAlpha" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.creditRiskGradingAlpha" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
        <ng-template>
          <app-credit-risk-grading-alpha #CrgAlphaComponent
                         (crgAlphaDataEmitter)="saveCrgAlpha($event)"
                         *ngIf="itemCrgAlpha.expanded"
                         [creditRiskGradingAlpha]="customerInfo?.creditRiskGradingAlpha"
                         [financial]="customerInfo?.financial"
                         [companyInfo]="companyInfo"
                         [fromProfile]="true"></app-credit-risk-grading-alpha>
        </ng-template>
     </div> -->

      <!--  DEFAULT CRG-->
      <!--     <nb-card class="col-md-4 py-2"   #itemCrg>-->
      <!--       <a class="cursor info-label">-->
      <!--          <div class="row col-md-12">-->
      <!--            <div class="col-md-8">-->
      <!--              <span>CREDIT RISK GRADING</span>-->
      <!--            </div>-->
      <!--            <div class="col-md-4 d-flex justify-content-end">-->
      <!--              <span *ngIf="customerInfo?.creditRiskGrading" style="color:green" title="Status : Saved">-->
      <!--                <em class="fas fa-check-circle px-2"></em>-->
      <!--              </span>-->
      <!--              <span style="color:red" title="Status :Not Saved">-->
      <!--                <em *ngIf="!customerInfo?.creditRiskGrading" class="fas fa-times-circle px-2"></em>-->
      <!--              </span>-->
      <!--            </div>-->
      <!--          </div>-->
      <!--        </a>-->
      <!--        <ng-template>-->
      <!--          <app-credit-grading #CrgComponent-->
      <!--                              (crgDataEmitter)="saveCrg($event)"-->
      <!--                              *ngIf="itemCrg.expanded"-->
      <!--                              [formData]="customerInfo?.creditRiskGrading"-->
      <!--                              [fromProfile]="true"></app-credit-grading>-->
      <!--        </ng-template>-->
      <!--     </div> -->
      <!--  DEFAULT CRG-->
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #itemloanChecklist>
        <a class="cursor info-label" (click)="openModel(creditCheckComponentTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">CREDIT CHECKLIST</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span *ngIf="creditChecklistGeneral" style="color:green" title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!creditChecklistGeneral" class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #creditCheckComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            CREDIT CHECKLIST
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-credit-checklist-general
                (creditChecklistGeneralEmitter)="saveCreditChecklist($event)"
                [formData]="customerInfo?.creditChecklist"
                [fromProfile]="true"
                [calendarType]="calendarType"
                [customerType]="customerInfo?.customerType"
            ></app-credit-checklist-general>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4">
        <div class="row">
        <nb-card class="col-md-11 py-2" #reportingInfoLevelAccordion>
        <a class="cursor info-label" (click)="openModel(customerComponentTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">CUSTOMER REPORTING INFORMATION</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span style="color: green" title="Status : Saved">
                <em *ngIf="reportingInfoLevelCode && reportingInfoLevelDescription"
                    class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color: red" title="Status : Not Saved">
                <em *ngIf="!reportingInfoLevelCode && !reportingInfoLevelDescription"
                    class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #customerComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            Customer Reporting Information
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-reporting-info-tagging #reportingInfoTagging

                                    (reportingInfoLevelsEmitter)="saveCustomerReportingInfo($event)"
                                    [type]="'c'"
                                    [reportingInfoLevels]="customerInfo?.reportingInfoLevels"></app-reporting-info-tagging>
        <div>
          <button class="btn float-right d-flex justify-content-end"
                  (click)="reportingInfoTaggingComponent.onSubmit()" type="submit" nbButton>Save
          </button>
        </div>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <div class="col-md-4"  *ngIf="companyInfo">
        <div class="row">
        <nb-card class="col-md-11 py-2">
        <a class="cursor info-label" (click)="openModel(commentComponentTemplate)">
          <div class="row">
            <div class="col-md-8">
              <p class="custom-font">COMMENTS</p>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
              <span style="color: green" title="Status : Saved">
                <em *ngIf="checkedPreviousComments"
                    class="fas fa-check-circle px-2"></em>
              </span>
              <span style="color: red" title="Status : Not Saved">
                <em *ngIf="!checkedPreviousComments"
                    class="fas fa-times-circle px-2"></em>
              </span>
            </div>
          </div>
        </a>
      </nb-card>
        </div>
      <ng-template #commentComponentTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header>
            COMMENTS
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-comments
                    #commentsInfoTagging
                    [commentsDataResponse]="commentsDataResponse"
                    [commentData]="customerInfo?.data"
                    [fromProfile]="true"

                    (commentsDataEmitter)="saveDataFromComments($event)">
            </app-comments>
            <div>
              <button class="btn float-right d-flex justify-content-end"
                      (click)="commentsComponent.submitForm()" type="submit" nbButton>Save
              </button>
        </div>
          </nb-card-body>
        </nb-card>
      </ng-template>
      </div>
      <!--<div class="col-md-4"  *ngIf="customerInfo?.customerType === 'INDIVIDUAL'">
        <div class="row">
          <nb-card class="col-md-11 py-2">
            <a class="cursor info-label" (click)="openModel(commonLoanDatas)">
              <div class="row">
                <div class="col-md-8">
                  <p class="custom-font">Common Loan Data</p>
                </div>
                <div class="col-md-4 d-flex justify-content-end">
              <span style="color: green" title="Status : Saved">
                <em *ngIf="customerInfo?.commonLoanData"
                    class="fas fa-check-circle px-2"></em>
              </span>
                  <span style="color: red" title="Status : Not Saved">
                <em *ngIf="!customerInfo?.commonLoanData"
                    class="fas fa-times-circle px-2"></em>
              </span>
                </div>
              </div>
            </a>
          </nb-card>
        </div>
      </div>-->

      <!-- ReviewDate-->
      <div class="col-md-4">
        <div class="row">
          <nb-card class="col-md-11 py-2" #reviewDate>
            <a class="cursor info-label" (click)="openModel(reviewDateTemplate)">
              <div class="row">
                <div class="col-md-10">
                  <p class="custom-font">REVIEW DATE</p>
                </div>
                <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="reviewDateResponse" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
                  <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!reviewDateResponse" class="fas fa-times-circle px-2"></em>
              </span>
                </div>
              </div>
            </a>
          </nb-card>
        </div>
      </div>
      <ng-template #reviewDateTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header> REVIEW DATE
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-review-date [fromProfile]="true"
                             [reviewData]="customerInfo?.reviewDate"
                             (reviewDateDataEmitter)="saveReviewDate($event)">
            </app-review-date>
          </nb-card-body>
        </nb-card>
      </ng-template>

      <!-- Multi Banking/Consortium Financing-->
      <div class="col-md-4" *ngIf="customerInfo?.customerType === 'INSTITUTION'">
        <div class="row">
          <nb-card class="col-md-11 py-2">
            <a class="cursor info-label" (click)="openModel(multiBankingTemplate)">
              <div class="row">
                <div class="col-md-10">
                  <p class="custom-font">MULTI BAKING/CONSORTIUM FINANCING</p>
                </div>
                <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="multiBankingResponse" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
                  <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!multiBankingResponse" class="fas fa-times-circle px-2"></em>
              </span>
                </div>
              </div>
            </a>
          </nb-card>
        </div>
      </div>
      <ng-template #multiBankingTemplate let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header> MULTI BANKING/CONSORTIUM FINANCING
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-multi-banking [fromProfile]="true"
                               [multiBankingData]="customerInfo?.multiBanking"
                               (multiBankingDataEmitter)="saveMultiBanking($event)">
            </app-multi-banking>
          </nb-card-body>
        </nb-card>
      </ng-template>

      <!--Group Summary Sheet (GSS)-->
      <div class="col-md-4" *ngIf="customerInfo?.customerType === 'INSTITUTION'">
        <div class="row">
          <nb-card class="col-md-11 py-2" #GSSTData>
            <a class="cursor info-label" (click)="openModel(GSSTemplate)">
              <div class="row">
                <div class="col-md-10">
                  <p class="custom-font">GROUP SUMMARY SHEET (GSS)</p>
                </div>
                <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="customerInfo?.gssData" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
                  <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.gssData" class="fas fa-times-circle px-2"></em>
              </span>
                </div>
              </div>
            </a>
          </nb-card>
        </div>
        <ng-template #GSSTemplate let-data let-ref="dialogRef">
          <nb-card class="template-css">
            <nb-card-header> GROUP SUMMARY SHEET (GSS)
              <a aria-label="Close" class="close cursor"
                 data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
            </nb-card-header>
            <nb-card-body>
              <app-group-summary-sheet [fromProfile]="true"
                                       [calendarType]="calendarType"
                                       [gssData]="customerInfo?.gssData"
                                       (gssDataEmitter)="saveGssData($event)">
              </app-group-summary-sheet>
            </nb-card-body>
          </nb-card>
        </ng-template>
      </div>

      <!--Other Details-->
      <div class="col-md-4">
        <div class="row">
          <nb-card class="col-md-11 py-2" #other>
            <a class="cursor info-label" (click)="openModel(otherTemplate)">
              <div class="row">
                <div class="col-md-10">
                  <p class="custom-font">Others</p>
                </div>
                <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="customerInfo?.otherDetails" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
                  <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.otherDetails" class="fas fa-times-circle px-2"></em>
              </span>
                </div>
              </div>
            </a>
          </nb-card>
        </div>
        <ng-template #otherTemplate let-data let-ref="dialogRef">
          <nb-card class="template-css">
            <nb-card-header> Others
              <a aria-label="Close" class="close cursor"
                 data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
            </nb-card-header>
            <nb-card-body>
              <app-other-details [fromProfile]="true"
                                 [otherData]="customerInfo?.otherDetails"
                                 (otherDataEmitter)="saveOthersData($event)">
              </app-other-details>
            </nb-card-body>
          </nb-card>
        </ng-template>
      </div>


<!--Facility Utilization-->
      <div class="col-md-4" *ngIf="customerInfo?.customerType === 'INSTITUTION'">
        <div class="row">
          <nb-card class="col-md-11 py-2">
            <a class="cursor info-label" (click)="openModel(facilityUtilization)">
              <div class="row">
                <div class="col-md-10">
                  <p class="custom-font">FACILITY UTILIZATION</p>
                </div>
                <div class="col-md-2 d-flex justify-content-end">
              <span *ngIf="customerInfo?.facilityUtilization" style="color:green"
                    title="Status : Saved">
                <em class="fas fa-check-circle px-2"></em>
              </span>
                  <span style="color:red" title="Status :Not Saved">
                <em *ngIf="!customerInfo?.facilityUtilization" class="fas fa-times-circle px-2"></em>
              </span>
                </div>
              </div>
            </a>
          </nb-card>
        </div>
      </div>
      <ng-template #facilityUtilization let-data let-ref="dialogRef">
        <nb-card class="template-css">
          <nb-card-header> FACILITY UTILIZATION
            <a aria-label="Close" class="close cursor"
               data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
          </nb-card-header>
          <nb-card-body>
            <app-facility-utilization [fromProfile]="true"
                               [customerInfo]="customerInfo"
                               (emitter)="update($event);saveCustomerInfo()">
            </app-facility-utilization>
          </nb-card-body>
        </nb-card>
      </ng-template>



      <!--      <div class="col-md-4">-->
<!--        <nb-card class="col-md-4 py-2" #commentsFromAccount >-->
<!--          <a class="cursor info-label">-->
<!--            <div class="row col-md-12">-->
<!--              <div class="col-md-8">-->
<!--                <span>COMMENTS</span>-->
<!--              </div>-->
<!--              <div class="col-md-4 d-flex justify-content-end">-->
<!--              <span *ngIf="checkedPreviousComments" style="color:green" title="Status : Saved">-->
<!--                <em class="fas fa-check-circle px-2"></em>-->
<!--              </span>-->
<!--                <span style="color:red" title="Status :Not Saved">-->
<!--                <em *ngIf="!checkedPreviousComments" class="fas fa-times-circle px-2"></em>-->
<!--              </span>-->
<!--              </div>-->
<!--            </div>-->
<!--          </a>-->
<!--        </nb-card>-->
<!--        <ng-template>-->
<!--          <app-comments-->
<!--                  #commentsInfoTagging-->
<!--                  [commentsDataResponse]="commentsDataResponse"-->
<!--                  [commentData]="customerInfo?.data"-->
<!--                  [fromProfile]="true"-->

<!--                  (commentsDataEmitter)="saveDataFromComments($event)">-->
<!--          </app-comments>-->
<!--          <div>-->
<!--            <button class="btn float-right d-flex justify-content-end"-->
<!--                    (click)="commentsComponent.submitForm()" type="submit" nbButton>Save-->
<!--            </button>-->
<!--          </div>-->
<!--        </ng-template>-->
<!--      </div>-->




<!--      <nb-card class="col-md-4 py-2" #dataFromPreviousSecurity *ngIf="client === clientName?.MEGA">-->
<!--        <a class="cursor info-label">-->
<!--          <div class="row col-md-12">-->
<!--            <div class="col-md-8">-->
<!--              <span>PREVIOUS SECURITY</span>-->
<!--            </div>-->
<!--            <div class="col-md-4 d-flex justify-content-end">-->
<!--              <span *ngIf="checkedPreviousSecurity" style="color:green" title="Status : Saved">-->
<!--                <em class="fas fa-check-circle px-2"></em>-->
<!--              </span>-->
<!--              <span style="color:red" title="Status :Not Saved">-->
<!--                <em *ngIf="!checkedPreviousSecurity" class="fas fa-times-circle px-2"></em>-->
<!--              </span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </a>-->
<!--      </nb-card>-->
      <ng-template>
        <app-previous-security
            #previousSecurityInfoTagging
            [securityDataResponse]="securityDataResponse"
            [securityData]="customerInfo?.data"
            [commentData]="customerInfo?.data"
            [fromProfile]="true"
            (securityDataEmitter)="saveDataFromSecurity($event)">
        </app-previous-security>
        <div>
          <button class="btn float-right d-flex justify-content-end"
                  (click)="previousSecurityComponent.submitForm()" type="submit" nbButton>Save
          </button>
        </div>
      </ng-template>

      <!--   CRG GAMMA-->
      <!--     <nb-card class="col-md-4 py-2"   #itemCrgGamma>-->
      <!--       <a class="cursor info-label">-->
      <!--          <div class="row col-md-12">-->
      <!--            <div class="col-md-8">-->
      <!--              <span>CREDIT RISK GRADING (GAMMA)</span>-->
      <!--            </div>-->
      <!--            <div class="col-md-4 d-flex justify-content-end">-->
      <!--              <span *ngIf="customerInfo?.crgGamma" style="color:green" title="Status : Saved">-->
      <!--                <em class="fas fa-check-circle px-2"></em>-->
      <!--              </span>-->
      <!--              <span style="color:red" title="Status :Not Saved">-->
      <!--                <em *ngIf="!customerInfo?.crgGamma" class="fas fa-times-circle px-2"></em>-->
      <!--              </span>-->
      <!--            </div>-->
      <!--          </div>-->
      <!--        </a>-->
      <!--        <ng-template>-->
      <!--          <app-credit-risk-grading-gamma #CrgGammaComponent-->
      <!--                                         (crgDataEmitter)="saveCrgGamma($event)"-->
      <!--                                         *ngIf="itemCrgGamma.expanded"-->
      <!--                                         [formData]="customerInfo?.crgGamma"-->
      <!--                                         [fromProfile]="true"></app-credit-risk-grading-gamma>-->
      <!--        </ng-template>-->
      <!--     </div> -->


      <!--   CRG GAMMA-->
      <!--     <nb-card class="col-md-4 py-2"   #itemCrgGamma>-->
      <!--       <a class="cursor info-label">-->
      <!--          <div class="row col-md-12">-->
      <!--            <div class="col-md-8">-->
      <!--              <span>CREDIT RISK GRADING (GAMMA)</span>-->
      <!--            </div>-->
      <!--            <div class="col-md-4 d-flex justify-content-end">-->
      <!--              <span *ngIf="customerInfo?.crgGamma" style="color:green" title="Status : Saved">-->
      <!--                <em class="fas fa-check-circle px-2"></em>-->
      <!--              </span>-->
      <!--              <span style="color:red" title="Status :Not Saved">-->
      <!--                <em *ngIf="!customerInfo?.crgGamma" class="fas fa-times-circle px-2"></em>-->
      <!--              </span>-->
      <!--            </div>-->
      <!--          </div>-->
      <!--        </a>-->
      <!--        <ng-template>-->
      <!--          <app-credit-risk-grading-gamma #CrgGammaComponent-->
      <!--                                         (crgDataEmitter)="saveCrgGamma($event)"-->
      <!--                                         *ngIf="itemCrgGamma.expanded"-->
      <!--                                         [formData]="customerInfo?.crgGamma"-->
      <!--                                         [fromProfile]="true"></app-credit-risk-grading-gamma>-->
      <!--        </ng-template>-->
      <!--     </div> -->
      <!--   CRG GAMMA-->
    </div>
  </nb-card-body>
</nb-card>
<ng-template #commonLoanDatas let-data let-ref="dialogRef">
  <nb-card class="template-css">
    <nb-card-header>
      Common Loan Data
      <a aria-label="Close" class="close cursor"
         data-dismiss="modal" (click)="ref.close()">
                      <span style="color: red" (click)="ref.close()">
                <em class="fas fa-times-circle px-2"></em>
              </span></a>
    </nb-card-header>
    <nb-card-body>
      <form [formGroup] = "commonLoanData" >
        <div class="row">
          <div class="col-md-12">
            <div class="form-group" style="max-height: 300px !important;height: 250px;">
              <strong>{{client === clientName?.LAXMIBANK ? 'Justification of limit' : 'Loan background' }}</strong>
              <ckeditor formControlName="borrowerInformation"
                        [style]="{height:'250px !important;'}"
                        placeholder="Background"
                        required
                        [config]="ckeConfig"
              >
              </ckeditor>
            </div>
          </div>
          <div class="clearfix"></div>

          <div class="col-md-12">
            <div class="form-group">
              <label class="title" for="disbursementCriteria"><strong>Disbursement Criteria</strong></label>
              <ckeditor
                      formControlName="disbursementCriteria" id="disbursementCriteria"
                      name="disbursementCriteria"
                      [config]="ckeConfig"></ckeditor>
            </div>
          </div>
          <div class="col-md-12">
            <div class="form-group">
              <label class="title" for="repayment"><strong>Repayment</strong></label>
              <ckeditor
                      formControlName="repayment" id="repayment"
                      name="repayment"
                      [config]="ckeConfig"></ckeditor>
            </div>
          </div>
          <div class="col-md-12">
            <div class="form-group">
              <label class="title" for="remark">
                <strong>{{client === clientName?.SHINE_RESUNGA ? 'Account Strategy' : 'Remarks'}}</strong></label>
              <ckeditor
                      formControlName="remark" id="remark"
                      [config]="ckeConfig"></ckeditor>
            </div>
          </div>


          <div class="col-md-12 mt-3">
            <div class="form-group">
              <label class="title"><strong>Summary & Recommendation</strong></label>
              <ckeditor formControlName="summeryRecommendation"
                        [style]="{height:'250px !important;'}"
                        placeholder="Summary & Recommendation"
                        [config]="ckeConfig">
              </ckeditor>
            </div>
          </div>

          <div class="col-md-12 form-group">
            <h6><strong>Additional Description</strong></h6>
            <nb-checkbox (change)="checkChecked($event.target.checked,'waiver')"
                         [checked]="waiverChecked">
              <b>Waiver</b>
            </nb-checkbox>
            <div *ngIf="waiverChecked">
              <ckeditor formControlName="waiverConclusionRecommendation"
                        [config]="ckeConfig"></ckeditor>
            </div>
          </div>

          <div class="col-md-12 form-group">
            <nb-checkbox (change)="checkChecked($event.target.checked,'deviation')"
                         [checked]="deviationChecked">
              <b>Deviation</b>
            </nb-checkbox>
            <div *ngIf="deviationChecked">
              <ckeditor formControlName="deviationConclusionRecommendation"
                        [config]="ckeConfig"></ckeditor>
            </div>
          </div>

          <div class="col-md-12 form-group">
            <nb-checkbox (change)="checkChecked($event.target.checked,'sol')"
                         [checked]="solChecked"><b>Single Obligor Limit</b>
            </nb-checkbox>
            <div *ngIf="solChecked">
              <ckeditor formControlName="solConclusionRecommendation"
                        [config]="ckeConfig"></ckeditor>
            </div>
          </div>
          <div class="col-md-12 form-group">

            <nb-checkbox (change)="checkChecked($event.target.checked,'risk')"
                         [checked]="riskChecked"><b>Risk & Mitigation</b>
            </nb-checkbox>
            <div *ngIf="riskChecked">
              <ckeditor formControlName="riskConclusionRecommendation"
                        [config]="ckeConfig"></ckeditor>
            </div>
          </div>
          <div class="col-md-12 form-group">

            <nb-checkbox (change)="checkChecked($event.target.checked,'debt')"
                         [checked]="debtChecked"><b>Debt Structure and Control</b>
            </nb-checkbox>
            <div *ngIf="debtChecked">
              <ckeditor formControlName="termsAndCondition"
                        [config]="ckeConfig"></ckeditor>
            </div>
          </div>
          <div class="col-md-12">
            <div class="form-group">
              <nb-checkbox (change)="checkChecked($event.target.checked,'net')"
                           [checked]="netChecked"><b>Net Worth</b>
              </nb-checkbox>
              <table *ngIf="netChecked"
                     class="table table-condensed table-bordered table-responsive-md text-center table-sm sb-small">
                <thead>
                <tr class="sb-bg-dark text-white">
                  <th>Assets</th>
                  <th>Amount</th>
                </tr>
                </thead>
                <tbody class="text-left">
                <tr>
                  <td colspan="1"><b>Deposit</b></td>
                  <td colspan="1"><a class="float-right" href="javascript: void(0)" (click)="addKeyValue('deposit')"><i class="fa fa-plus" nbTooltip="Add Deposit"></i></a></td>
                </tr>
                <tr *ngFor="let controls of commonLoanData?.get('deposit')['controls'];let i = index" formArrayName="deposit">
                  <ng-container [formGroupName]="i">
                    <td><input nbInput type="text" formControlName="assets"></td>
                    <td><input nbInput type="number" (change)="calculate()" formControlName="amount"> <a   *ngIf="commonLoanData?.get('deposit')['length'] > 1" href="javascript: void(0)" (click)="removeValue('deposit', i)"><i class="fa fa-times-circle px-4" nbTooltip="Delete Row"></i></a></td>
                  </ng-container>
                </tr>
                <tr>
                  <td colspan="1"><b>Shares & Securities</b></td>
                  <td colspan="1"><a class="float-right" href="javascript: void(0)" (click)="addKeyValue('shares')"><i class="fa fa-plus" nbTooltip="Add Shares & security"></i></a></td>
                </tr>
                <tr *ngFor="let controls of commonLoanData?.get('shares')['controls'];let i = index" formArrayName="shares">
                  <ng-container [formGroupName]="i">
                    <td><input nbInput type="text" formControlName="assets"></td>
                    <td><input nbInput type="number" (change)="calculate()" formControlName="amount"> <a   *ngIf="commonLoanData?.get('shares')['length'] > 1" href="javascript: void(0)" (click)="removeValue('shares', i)"><i class="fa fa-times-circle px-4" nbTooltip="Delete Row"></i></a></td>
                  </ng-container>
                </tr>
                <tr>
                  <td><b>Real Estate (Land and Building)</b></td>
                  <td colspan="1"><a class="float-right" href="javascript: void(0)" (click)="addKeyValue('realState')"><i class="fa fa-plus" nbTooltip="Add Real Estate (Land and Building)"></i></a></td>

                </tr>

                <tr *ngFor="let controls of commonLoanData?.get('realState')['controls'];let i = index" formArrayName="realState">
                  <ng-container [formGroupName]="i">
                    <td><input nbInput type="text" formControlName="assets"></td>
                    <td><input nbInput type="number" (change)="calculate()" formControlName="amount"> <a *ngIf="commonLoanData?.get('realState')['length'] > 1" href="javascript: void(0)" (click)="removeValue('realState', i)"><i class="fa fa-times-circle px-4" nbTooltip="Delete Row"></i></a></td>
                  </ng-container>
                </tr>
                <tr>
                  <td><b>Vehicles</b></td>
                  <td colspan="1"><a class="float-right" href="javascript: void(0)" (click)="addKeyValue('vehicle')"><i class="fa fa-plus" nbTooltip="Add Vehicles"></i></a></td>
                </tr>
                <tr *ngFor="let controls of commonLoanData?.get('vehicle')['controls'];let i = index" formArrayName="vehicle">
                  <ng-container [formGroupName]="i">
                    <td><input nbInput type="text" formControlName="assets"></td>
                    <td>
                      <input nbInput type="number" (change)="calculate()" formControlName="amount">
                      <a *ngIf="commonLoanData?.get('vehicle')['length'] > 1" href="javascript: void(0)" (click)="removeValue('vehicle', i)"><i class="fa fa-times-circle px-4" nbTooltip="Delete Row"></i></a>
                    </td>
                  </ng-container>
                </tr>
                <tr>
                  <td class="text-right"><b>Total:</b></td>
                  <td><input nbInput formControlName="total" (change)="calculate()" type="number"></td>
                </tr>
                <tr>
                  <td class="text-right"><b>Net Worth (Total Assets - Banking Relationship Exposure):</b></td>
                  <td><input nbInput formControlName="totals"  type="number"></td>
                </tr>
                </tbody>

              </table>

            </div>
          </div>
        </div>
      </form>
      <div class="col-md-12 form-group">
        <button nbButton (click)="openCadSetup(datax)"><b>Setup Security Schedule</b>
        </button>
      </div>
      <div>
        <button class="btn float-right d-flex justify-content-end"
                (click)="saveCommonLoanData()" type="submit" nbButton>Save
        </button>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>

<ng-template #datax>
  <!--    <app-cad-file-setup [files] = "files" [proposal]="true" (legalFile)="getData($event)" ></app-cad-file-setup>-->
</ng-template>
