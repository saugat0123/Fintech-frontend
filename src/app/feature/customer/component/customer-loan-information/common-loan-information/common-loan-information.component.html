<div class="row">
    <div class="col-md-12">
        <form [formGroup]="commonLoanForm">
            <div clas="col-md-12" *ngFor="let controls of commonLoanForm.get('data')['controls']; let i = index;">
                <div class="nb-card-header"><p><b>Loan Name: {{controls?.get('loanName')?.value}}</b></p> <p><b>Loan Type: {{controls?.get('loanType')?.value}}</b></p></div>
                <div class="row" [formGroup]="controls?.get('proposalData')">
                    <div class="col-md-4" *ngIf="conditionalArray[i]?.checkApproved">
                        <div class="form-group">
                            <label class="title" for="existingLimit"><strong>Existing Limit</strong></label>
                            <input class="form-control"
                                   (keyup)="calculateLimitValues(i)"
                                   formControlName="existingLimit" id="existingLimit"
                                   name="existingLimit" placeholder="Existing limit"
                                   type="number">
                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="controls?.get('loanType')?.value !== 'NEW_LOAN'">
                        <div class="form-group">
                            <label class="title" for="outStandingLimit">
                                <strong>Outstanding Limit</strong>
                            </label>
                            <input class="form-control"
                                   (keyup)="calculateLimitValues(i)"
                                   formControlName="outStandingLimit" id="outStandingLimit"
                                   name="outStandingLimit" placeholder="Limit Amount"
                                   type="number">
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="controls?.get('loanType')?.value === 'PARTIAL_SETTLEMENT_LOAN'">
                        <div class="form-group">
                            <label class="title" for="settlementAmount"></label>
                            <strong>Settlement Amount</strong>
                            <input class="form-control"
                                   (keyup)="calculateLimitValues(i)"
                                   formControlName="settlementAmount" id="settlementAmount"
                                   name="settlementAmount" placeholder="Settlement Amount"
                                   type="number">
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="controls?.get('loanType')?.value === 'RENEW_WITH_ENHANCEMENT' || controls?.get('loanType')?.value === 'ENHANCED_LOAN'" >
                        <div class="form-group">
                            <label class="title" for="enhanceLimitAmount">
                                <strong>Enhancement Amount</strong>
                            </label>
                            <input class="form-control"
                                   (keyup)="calculateLimitValues(i)"
                                   formControlName="enhanceLimitAmount" id="enhanceLimitAmount"
                                   name="enhanceLimitAmount" placeholder="Enhance Amount"
                                   type="number">
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title" for="proposedLimit"><strong>Proposed Limit</strong></label>
                            <input
                                    class="form-control"
                                    formControlName="proposedLimit" id="proposedLimit"
                                    name="proposedLimit" placeholder="Proposed limit"
                                    type="number" (input)="checkRepaymentMode(i);checkCustomRepaymentMode(i)"
                                    appDecimalNumber>
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="!conditionalArray[i]?.isFundable && conditionalArray[i]?.fundableNonFundableSelcted && controls?.get('loanType')?.value !== 'NEW_LOAN'">
                        <div class="form-group">
                            <label class="title" for="existCashMargin"><strong> Existing Cash Margin</strong>
                                <input
                                        formControlName="existCashMarginMethod"
                                        name="existCashMarginMethod"
                                        type="radio"
                                        value="PERCENT"> <strong> % </strong>
                                <input
                                        formControlName="existCashMarginMethod"
                                        name="existCashMarginMethod"
                                        type="radio"
                                        value="FLAT"> <strong>Flat</strong>
                            </label>
                            <input
                                    class="form-control" formControlName="existCashMargin"
                                    id="existCashMargin"
                                    name="existCashMargin" placeholder=" Existing Cash Margin"
                                    type="number">

                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="!conditionalArray[i]?.isFundable && conditionalArray[i]?.fundableNonFundableSelcted">
                        <div class="form-group">
                            <label class="title" for="cashMargin"><strong>Cash Margin</strong>
                                <input
                                        formControlName="cashMarginMethod"
                                        name="cashMarginMethod" type="radio"
                                        value="PERCENT"><strong>% </strong>
                                <input formControlName="cashMarginMethod" name="cashMarginMethod"
                                       type="radio" value="FLAT"><strong> Flat</strong>
                            </label>
                            <input
                                    class="form-control" formControlName="cashMargin"
                                    id="cashMargin"
                                    name="cashMargin" placeholder="Cash Margin"
                                    type="number">
                        </div>

                    </div>

                    <div class="col-md-4" *ngIf="!conditionalArray[i]?.isFundable && conditionalArray[i]?.fundableNonFundableSelcted && controls?.get('loanType')?.value !== 'NEW_LOAN'">
                        <div class="form-group">
                            <label for="existCommissionPercentage"><strong>Existing Commission (%)</strong></label>
                            <input
                                    class="form-control" formControlName="existCommissionPercentage"
                                    id="existCommissionPercentage" name="existCommissionPercentage"
                                    placeholder="Existing Commision (%)"
                                    type="number">
                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="!conditionalArray[i]?.isFundable && conditionalArray[i]?.fundableNonFundableSelcted">
                        <div class="form-group">
                            <label class="title" for="commissionPercentage"><strong>Commission (%)</strong></label>
                            <input
                                    class="form-control" formControlName="commissionPercentage"
                                    id="commissionPercentage" name="commissionPercentage"
                                    placeholder="Commission (%)"
                                    type="number">
                            <!--                    <div *ngIf="(submitted) && formControls.commissionPercentage.invalid"-->
                            <!--                         class="invalid-feedback">-->
                            <!--                      <span *ngIf="formControls.commissionPercentage.errors.required">Commission % is required</span>-->
                            <!--                    </div>-->
                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="!conditionalArray[i]?.isFundable && conditionalArray[i]?.fundableNonFundableSelcted">
                        <div class="form-group">
                            <label class="title" for="commissionFrequency"><strong>Commission
                                Frequency</strong></label>
                            <select
                                    class="form-control" formControlName="commissionFrequency"
                                    id="commissionFrequency" name="commissionFrequency">
                                <option [ngValue]="null" hidden>Select Commission Frequency</option>
                                <option value="MONTH">Per Month</option>
                                <option value="QUARTER">Per Quarter</option>
                                <option value="ANNUM">Per Annum</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-4" *ngIf="conditionalArray[i]?.isFixedDeposit">
                        <div class="form-group">
                            <label class="title" for="couponRate"><strong>Coupon Rate</strong></label>
                            <input
                                    class="form-control" formControlName="couponRate"
                                    id="couponRate" name="couponRate" placeholder="Coupon Rate"
                                    type="number">
                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="conditionalArray[i]?.isFixedDeposit">
                        <div class="form-group">
                            <label class="title" for="premiumOnCouponRate"><strong>Premium On Coupon
                                Rate</strong></label>
                            <input
                                    class="form-control" formControlName="premiumOnCouponRate"
                                    id="premiumOnCouponRate" name="premiumOnCouponRate"
                                    placeholder="Premium On Coupon Rate"
                                    type="number">
                        </div>
                    </div>
                    <div class="col-md-4"
                         *ngIf="((conditionalArray[i]?.isFundable && (conditionalArray[i]?.isTerminating || conditionalArray[i]?.isRevolving)) || conditionalArray[i]?.isFixedDeposit ||
                          conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral) &&
                           controls?.get('loanType')?.value !== 'NEW_LOAN'">
                        <div class="form-group">
                            <label class="title" for="existInterestRate"> <strong> Existing Interest
                                Rate(%)</strong></label>
                            <input
                                    class="form-control" formControlName="existInterestRate"
                                    id="existInterestRate" name="existInterestRate"
                                    placeholder="Existing Interest Rate(%)"
                                    type="number" appDecimalNumber
                            >
                        </div>

                    </div>
                    <div class="col-md-4"
                         *ngIf="(conditionalArray[i]?.isFundable &&
                          (conditionalArray[i]?.isTerminating || conditionalArray[i]?.isRevolving))
                           || conditionalArray[i]?.isFixedDeposit || conditionalArray[i]?.isVehicle ||
                            conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral">
                        <div class="form-group">
                            <label class="title" for="interestRate"><strong>Interest
                                Rate(%)</strong></label>
                            <input
                                    class="form-control" formControlName="interestRate"
                                    id="interestRate" name="interestRate" placeholder="Interest Rate(%)"
                                    type="number" (input)="checkRepaymentMode(i); checkCustomRepaymentMode(i)"
                                    appDecimalNumber
                                    readonly>
                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="(conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isFundable && (conditionalArray[i]?.isTerminating || conditionalArray[i]?.isRevolving)) || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral">
                        <div class="form-group">
                            <label class="title" for="baseRate"><strong>Base Rate(%)</strong></label>
                            <input
                                    class="form-control" formControlName="baseRate" id="baseRate"
                                    name="baseRate" placeholder="Base Rate(%)"
                                    type="number" appDecimalNumber>
                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="(conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isFundable && (conditionalArray[i]?.isTerminating || conditionalArray[i]?.isRevolving)) || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral">
                        <div class="form-group" >
                            <label class="title" for="premiumRateOnBaseRate"><strong>Premium Rate On Base
                                Rate(%)</strong></label>
                            <input
                                    class="form-control"
                                    class="form-control" formControlName="premiumRateOnBaseRate"
                                    id="premiumRateOnBaseRate" name="premiumRate"
                                    placeholder="Base Rate(%)" placeholder="Premium Rate On Base Rate(%)"
                                    type="number">
                        </div>
                    </div>
                    <div class="col-md-4"  *ngIf="(conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted &&
                     conditionalArray[i]?.isFundable && (conditionalArray[i]?.isTerminating || conditionalArray[i]?.isRevolving)) || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare
                      || conditionalArray[i]?.isGeneral">
                        <div class="form-group">
                            <label class="title" for="serviceCharge"><strong>Loan Administration Fee </strong>
                                <input
                                        formControlName="serviceChargeMethod"
                                        name="serviceChargeMethod" type="radio"
                                        value="PERCENT"><strong>% </strong>
                                <input formControlName="serviceChargeMethod" name="serviceChargeMethod"
                                       type="radio" value="FLAT"><strong> Flat</strong>
                            </label>
                            <input
                                    class="form-control" formControlName="serviceCharge"
                                    id="serviceCharge"
                                    name="serviceCharge" placeholder="Loan Administration Fee"
                                    type="number" appDecimalNumber>
                        </div>
                    </div>
                    <div class="col-md-4"   *ngIf="(conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted &&
                     conditionalArray[i]?.isFundable && conditionalArray[i]?.isTerminating) || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral">
                        <div class="form-group">
                            <label class="title" for="tenureDurationInMonths"><strong>Tenure Duration in
                                Month.</strong></label>
                            <input
                                    class="form-control"
                                    formControlName="tenureDurationInMonths" id="tenureDurationInMonths"
                                    placeholder="Tenure Duration in Months"
                                    type="number" (input)="checkRepaymentMode(i);checkCustomRepaymentMode(i)"
                                    appDecimalNumber>

                        </div>
                    </div>

                    <!--                                start of repayment mode-->
                    <div class="col-md-4" *ngIf="(conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted &&  conditionalArray[i]?.isFundable &&  conditionalArray[i]?.isTerminating) || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral">
                        <div class="form-group">
                            <label class="title" for="repaymentMode"><strong>Repayment Mode</strong></label>
                            <select
                                    class="custom-select" formControlName="repaymentMode"
                                    id="repaymentMode"
                                    name="repaymentMode"
                                    (change)="checkInstallmentAmount(i)">
                                <option [ngValue]="null" hidden selected>Select</option>
                                <option value="EMI">EMI</option>
                                <option value="EQI">EQI</option>
                                <option value="AT MATURITY">At Maturity</option>
                                <option value="CUSTOM">Custom</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="conditionalArray[i]?.showRepaymentMode">
                        <div class="form-group">
                            <label class="title" for="repaymentModeInterest"><strong>Interest Payment</strong></label>
                            <select
                                #interestRepayment
                                class="custom-select" formControlName="repaymentModeInterest"
                                id="repaymentModeInterest"
                                name="repaymentModeInterest"
                                (change)="calculateRepaymentModeAmounts(interestRepayment.value , 'INTEREST',i)">
                                <option [ngValue]="null" hidden selected>Select</option>
                                <option value="MONTHLY">Monthly</option>
                                <option value="QUARTERLY">Quarterly</option>
                                <option value="SEMI-ANNUALLY">Semi-Annually</option>
                                <option value="ANNUALLY">Annually</option>
                            </select>

                        </div>
                    </div>
                    <div class="col-md-4" *ngIf="conditionalArray[i]?.showRepaymentMode">
                        <div class="form-group">
                            <label class="title" for="repaymentModePrincipal"><strong>Principal Payment</strong></label>
                            <select
                                #repaymentModePrincipal
                                class="custom-select" formControlName="repaymentModePrincipal"
                                id="repaymentModePrincipal"
                                name="repaymentModePrincipal"
                                (change)="calculateRepaymentModeAmounts(repaymentModePrincipal.value , 'PRINCIPAL',i)">
                                <option [ngValue]="null" hidden selected>Select</option>
                                <option value="MONTHLY">Monthly</option>
                                <option value="QUARTERLY">Quarterly</option>
                                <option value="SEMI-ANNUALLY">Semi-Annually</option>
                                <option value="ANNUALLY">Annually</option>
                            </select>
                        </div>
                    </div>
                    <!--                                end of repayment mode-->

                    <!--                start of installment amount div-->
                    <div class="col-md-4"  *ngIf="conditionalArray[i]?.showInstallmentAmount  && ((conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isTerminating  && conditionalArray[i]?.isFundable) || ( conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral))">
                        <div class="form-group>">
                            <label class="title"> <strong>Installment Amount</strong></label>
                            <input
                                    class="form-control" formControlName="installmentAmount"
                                    id="installmentAmount"
                                    name="installmentAmount" placeholder="Installment Amount"
                                    type="number" readonly>
                        </div>
                    </div>
                    <!--                end of ng s
                    installment amount div-->
                    <div class="col-md-4" *ngIf="((controls?.get('proposalData')?.get('repaymentMode').value != null) && (!conditionalArray[i]?.showInstallmentAmount || conditionalArray[i]?.showRepaymentMode) &&
                                           ((conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.isFundable && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isTerminating) || (conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral)))
                                         ">
                        <div class="form-group>">
                            <label class="title"> <strong>Interest Amount</strong></label>
                            <input
                                    class="form-control" formControlName="interestAmount"
                                    id="interestAmount"
                                    name="interestAmount" placeholder="Interest Amount" disabled
                                    type="number">
                        </div>
                    </div>
                    <div class="col-md-4"  *ngIf="((controls?.get('proposalData').get('repaymentMode').value != null) && (!conditionalArray[i]?.showInstallmentAmount || conditionalArray[i]?.showRepaymentMode) &&
                                           ((conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.isFundable && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isTerminating)
                                            || (conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral)))
                                           ">
                        <div class="form-group>">
                            <label class="title"> <strong>Principal Amount</strong></label>
                            <input
                                    class="form-control" formControlName="principalAmount"
                                    id="principalAmount"
                                    name="principalAmount" placeholder="Principle Amount" disabled
                                    type="number">
                        </div>
                    </div>

                    <!--                start of Moratorium period amount div-->
                    <div class="col-md-4"   *ngIf="(conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isFundable && conditionalArray[i]?.isTerminating) || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isGeneral">
                        <div class="form-group>">
                            <label class="title"> <strong>Moratorium Period (Month)</strong></label>
                            <input
                                    class="form-control" formControlName="moratoriumPeriod"
                                    id="moratoriumPeriod"
                                    name="moratoriumPeriod" placeholder="Example: 4 month"
                                    type="number" appDecimalNumber>
                        </div>
                    </div>
                    <!--                end of Moratorium Period amount div-->

                    <div class="col-md-4"   *ngIf="((conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isFundable && (conditionalArray[i]?.isTerminating || conditionalArray[i]?.isRevolving)) || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral)">
                        <div class="form-group">
                            <div class="variable">
                                <label class="title" for="commitmentFee"><strong>Commitment Fee (in%)</strong>
                                </label>
                            </div>
                            <input
                                    class="form-control"
                                    formControlName="commitmentFee" id="commitmentFee"
                                    name="commitmentFee"
                                    placeholder="Commitment Fee"
                                    type="text"
                            />
                        </div>
                    </div>

                    <div class="col-md-4"
                         *ngIf="(conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isFundable && conditionalArray[i]?.isRevolving) "
                    >
                        <div class="form-group">
                            <label class="title" for="tenorOfEachDeal"><strong>Tenure of each deal</strong></label>
                            <input
                                    class="form-control"
                                    formControlName="tenorOfEachDeal" id="tenorOfEachDeal"
                                    name="tenorOfEachDeal"
                                    placeholder="Tenure of each deal" type="text"/>

                        </div>
                    </div>

                    <!--                start of Prepayment charge  div-->
                    <div class="col-md-4"  *ngIf="((conditionalArray[i]?.loanNatureSelected && conditionalArray[i]?.fundableNonFundableSelcted && conditionalArray[i]?.isFundable && conditionalArray[i]?.isTerminating)
                    || conditionalArray[i]?.isVehicle || conditionalArray[i]?.isShare || conditionalArray[i]?.isGeneral)">
                        <div class="form-group>">
                            <div class="variable">
                                <label class="title"> <strong>Prepayment Charge (in%)
                                </strong></label> &nbsp;
                            </div>
                            <input
                                    class="form-control" formControlName="prepaymentCharge"
                                    id="prepaymentCharge" name="prepaymentCharge"
                                    type="text"
                                    placeholder="Prepayment Charge"
                            >
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title" for="collateralRequirement"><strong>Collateral requirement
                                (in%)</strong></label>
                            <input
                                    class="form-control"
                                    formControlName="collateralRequirement" id="collateralRequirement"
                                    name="collateralRequirement"
                                    placeholder="Collateral requirement" type="number" appDecimalNumber/>
                        </div>
                    </div>
                    <div class="col-md-4 form-group">
                        <div>
                            <div class="variable">
                                <input
                                        formControlName="swapChargeMethod"
                                        name="swapChargeMethod" type="radio"
                                        value="PERCENT"><strong> % </strong>
                                <input formControlName="swapChargeMethod" name="swapChargeMethod"
                                       type="radio" value="FLAT"><strong> Flat</strong>
                                &nbsp
                            </div>
                            <input
                                    class="form-control" formControlName="swapCharge"
                                    id="swapCharge"
                                    name="swapCharge" placeholder="Swap Charge"
                                    type="text"/>
                        </div>
                    </div>
                    <button class="float-right" (click)="removeLoans(i)" nbButton><i class="fa fa-trash"></i></button>
                </div>
            </div>
        </form>
        <button class="float-right" [disabled]="commonLoans?.length < 1" (click)="save()" nbButton>Save</button>
    </div>
</div>
