<nb-card style="max-height: 90vh;">
    <nb-card-header>
        <div>
        <div class="float-left">
            <button (click)="onBack()" class="btn-primary float-left"><i class="fas fa-arrow-left"></i>
            </button>
        </div>
        <div class="float-right">
            <button [useExistingCss]="true" class="btn-sm btn-warning float-right"
                    ngxPrint printSectionId="print-detail" styleSheetFile="assets/css/printStyles.scss">
                PRINT
<!--                <i class="col-md-1 fa fa-print"></i>-->
            </button>
        </div>
        <div class="float-right">
            <button  [nbPopover]="allDocumentView" class="btn-sm btn-success float-right">
                UPLOADED DOC
<!--                <i class="col-md-1 fa fa-file"></i>-->
            </button>
        </div>
    </div></nb-card-header>
    <nb-card-body>
        <div id="print-detail">
            <div class="summary">
            <div class="row text-center">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-left">
                                <strong>Priority:</strong>
                                <span class="badge badge-danger">{{loanDataHolder?.priority?.toString() | titlecase}}</span>
                            </div>

                            <div class="text-left">
                                <strong>
                                Approving Level:
                                </strong>
                                <span class="badge badge-danger">{{loanDataHolder?.approvingLevel?.toString() | titlecase}}</span>
                            </div>

                            <div class="text-left">
                                <strong>
                                Loan Status:
                                </strong>
                                <span class="badge badge-info">{{loanDataHolder?.documentStatus?.toString() | titlecase}}</span>
                            </div>
                            <div class="clearfix" style="margin-top: 4em">
                                <div class="float-left">
                                    <span><strong>Ref. No: </strong>{{loanDataHolder?.refNo}}</span>
                                </div>
                                <br/>
                                <div class="float-left">
                                    <b>Branch Code: {{loanDataHolder?.branch.branchCode}}</b>
                                </div>
                                <br/>
                                <div><strong class="float-left">Product:</strong>
                                    <table id="table-border" class="table table-bordered table-condensed table-responsive-md text-center table-sm sb-small">
                                        <thead>
                                        <tr class="sb-bg-gray">
                                            <td>Facility Name</td>
                                            <td>Product Code</td>
                                            <td>Approval Level</td>
                                            <td>Credit Risk Grade</td>
                                        </tr>
                                        </thead>
                                        <tr *ngFor="let allLoan of allLoanList">
                                            <td>
                                                {{allLoan?.loan?.name}}
                                            </td>
                                            <td>
                                                {{allLoan?.loan?.shortNames}}
                                            </td>
                                            <td>
                                                {{allLoan?.approvingLevel}}
                                            </td>
                                            <td>
                                                {{allLoan?.creditRisk}}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <br/>
                                <div *ngIf="smallBusiness || deprivedSector || consumerFinance || microFinancialService"><strong class="float-left">Review Date:</strong>
                                    <table class="table table-sm table-responsive-sm table-bordered sb-small float-left">
                                        <thead>
                                        <tr class="sb-bg-gray">
                                            <td>Facility Name</td>
                                            <td>Last Review Date</td>
                                            <td>Next Review Date</td>
                                        </tr>
                                        </thead>
                                        <tr *ngFor="let allLoan of allLoanList">
                                            <ng-container *ngIf="allLoan?.reviewDate?.data">
                                                <td>
                                                    {{allLoan?.loan?.name}}
                                                </td>
                                                <td>
                                                    <span [innerHTML]="(allLoan?.reviewDate?.data | jsonParse)?.lastReviewDate || 'N/A' | safeHtml"></span>
                                                </td>
                                                <td>
                                                    <span [innerHTML]="(allLoan?.reviewDate?.data | jsonParse)?.nextReviewDate || 'N/A' | safeHtml"></span>
                                                </td>
                                            </ng-container>
                                        </tr>
                                    </table>
                                </div>
                                <br>
                                <ng-container class="float-left" *ngIf="loanDataHolder?.loanHolder?.reviewDate && !smallBusiness && !deprivedSector && !microFinancialService && !consumerFinance">
                            <span><strong>Review Date: </strong>
                                <ng-container *ngIf="naChecked; else date">
                                    {{'NA'}}
                                </ng-container>
                                <ng-template #date>
                                    <br>
                                    Last Review Date: {{reviewDateData?.lastReviewDate ? (reviewDateData?.lastReviewDate | date) : 'NA'}}
                                    <br>
                                    Next Review Date: {{reviewDateData?.nextReviewDate ? (reviewDateData?.nextReviewDate | date) : 'NA'}}
                                </ng-template>
                            </span>
                                    <!--                                    <div>-->
                                    <!--                                        <strong *ngIf="loanDataHolder?.creditRisk">Credit Risk Grade:</strong>-->
                                    <!--                                        <p class="badge badge-info">{{loanDataHolder?.creditRisk}}</p>-->
                                    <!--                                    </div>-->
                                </ng-container>
                                <!--<strong *ngIf="loanDataHolder?.creditRisk">Credit Risk Grade:</strong>
                                <p class="badge badge-info">{{loanDataHolder?.creditRisk}}</p>-->
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="report-header">
                                <div class="report-header-heading header"><strong class="header">{{client}}</strong></div>
                                <div class="report-header-sub-heading">
                                    Credit Appraisal
                                    <br/>
                                    for
                                </div>
                                <div class="report-header-sub-heading" *ngIf="!isJointInfo">
                                    <strong class="customer-name">
                                    {{loanCategory === 'INSTITUTION' ?
                                    loanDataHolder?.companyInfo?.companyName
                                    : loanDataHolder?.customerInfo?.customerName}}
                                    </strong>
                                </div>
                                <div class="report-header-sub-heading" *ngIf="isJointInfo">
                                    <div *ngFor="let jointCustomer of jointInfo">
                                        <ng-container *ngFor="let info of jointCustomer">
                                            <span class="sb-medium">
                                                <strong class="customer-name">
                                                {{loanCategory === 'INSTITUTION' ?
                                                loanDataHolder?.companyInfo?.companyName : info?.customerName}}
                                                </strong></span><br/>
                                        </ng-container>
                                    </div>
                                </div>
                                <div class="report-header-sub-heading">{{loanDataHolder?.branch?.name}} Branch ,
                                    {{loanDataHolder?.branch?.province?.name}}</div>
                                <div class="badge badge-warning">Detail</div>
                            </div>
                        </div>
                        <div class="col-md-4 text-left">
                            <img class="report-log img-thumbnail border-0"
                                 src="../../../../../assets/img/logo.png">
                            <br/>
                            <div class="row sb-small">
                                <div class="col-md-12">
                                    <span class="float-left"><b>Loan Authority Under</b>- {{loanDataHolder?.currentStage?.toUser?.name}}
                                        ({{loanDataHolder?.currentStage?.toRole?.roleName}})</span>
                                </div>
                            </div>
                            <div class="row sb-small mb-1">
                                <div class="col-md-12">
                                    <span class="float-left"> <b>Application Received On:</b> {{loanDataHolder?.createdAt | date}} ({{loanDataHolder?.createdAt | engNepDate: false}})</span>
                                    <span class="float-left"><b>
                        <span *ngIf="currentDocAction === 'FORWARD'">Forwarded</span>
                        <span *ngIf="currentDocAction === 'BACKWARD'">Backwarded</span> by: </b>{{loanDataHolder?.currentStage?.fromUser?.name}}
                                        ({{loanDataHolder?.currentStage?.fromRole?.roleName}})
                        <b> on:</b> {{loanDataHolder?.lastModifiedAt | date}} ({{loanDataHolder?.lastModifiedAt | engNepDate: false}})
                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <ng-template  #allDocumentView>
                <app-all-document-view  *ngIf="loanDataHolder" [loanDataHolder]="loanDataHolder" [siteVisitDocument]="siteVisitDocuments"></app-all-document-view>
            </ng-template>
                <hr class="print-line">
                <!--     Group Summary Sheet    -->
                <app-group-summary-sheet-view class="page-break" *ngIf="loanDataHolder?.loanHolder?.mgroupInfo" [loanDataHolder]="loanDataHolder?.loanHolder"></app-group-summary-sheet-view>
                <hr class="print-line" *ngIf="loanDataHolder?.loanHolder?.mgroupInfo">
                <app-detail-view-of-individual *ngIf="loanDataHolder?.loanHolder?.customerType === 'INDIVIDUAL' && loaded"
                                           [loanDataHolder]="loanDataHolder"
                                           [customerAllLoanList]="customerAllLoanList"
                                               [loanSecurity]="loanSecurity"
                                               [approvedSecurity]="approvedSecurity"
                                           [combinedLoan]="combinedLoanList"
                                           [signatureList] = "signatureList"></app-detail-view-of-individual>
            <app-detail-view-of-institutional *ngIf="loanDataHolder?.loanHolder?.customerType === 'INSTITUTION'  && loaded"
                                              [loanDataHolder]="loanDataHolder" [customerAllLoanList]="customerAllLoanList"
                                              [loanConfig] = "loanConfig"
                                              [loanSecurity]="loanSecurity"
                                              [approvedSecurity]="approvedSecurity"
                                              [combinedLoan]="combinedLoanList"
                                              [signatureList] = "signatureList"></app-detail-view-of-institutional>
        </div>
        </div>
<app-overlay-spinner></app-overlay-spinner>
    </nb-card-body>
</nb-card>
