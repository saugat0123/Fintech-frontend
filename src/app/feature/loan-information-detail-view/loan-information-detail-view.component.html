<nb-card style="max-height: 90vh;">
    <nb-card-header>
        <div>
            <div class="float-left">
                <button (click)="onBack()" class="btn-primary float-left"><i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="float-right">
                <button [useExistingCss]="true" class="btn-sm btn-warning float-right" ngxPrint
                    printSectionId="print-detail" styleSheetFile="assets/css/printStyles.scss">
                    PRINT
                    <!--                <i class="col-md-1 fa fa-print"></i>-->
                </button>
            </div>
            <div class="float-right">
                <button [nbPopover]="allDocumentView" class="btn-sm btn-success float-right">
                    UPLOADED DOCUMENT
                    <!--                <i class="col-md-1 fa fa-file"></i>-->
                </button>
            </div>
        </div>
    </nb-card-header>
    <nb-card-body>
        <div id="print-detail">
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mt-2">
                                Loan Status:
                                <span class="badge badge-info"
                                    style="font-size: 13px">{{loanDataHolder?.documentStatus?.toString() |
                                    titlecase}}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="report-header text-center">
                                <div class="report-header-heading mb-2">
                                    {{client}}
                                </div>
                                <ng-container>
                                    <div>
                                        <span class="report-header-sub-heading"> Credit Appraisal </span>
                                        <br />
                                        <span class="report-header-sub-heading"> for </span>
                                    </div>
                                    <div *ngIf="!isJointInfo">
                                        <span class="report-header-sub-heading">
                                            <strong>
                                                {{loanCategory === 'INSTITUTION' ?
                                                loanDataHolder?.companyInfo?.companyName
                                                : loanDataHolder?.customerInfo?.customerName}}
                                            </strong>
                                        </span>
                                    </div>
                                    <div class="report-header-sub-heading" *ngIf="isJointInfo">
                                        <div *ngFor="let jointCustomer of jointInfo">
                                            <ng-container *ngFor="let info of jointCustomer">
                                                <span class="sb-medium">{{loanCategory === 'INSTITUTION' ?
                                                    loanDataHolder?.companyInfo?.companyName :
                                                    info?.customerName}}</span><br />
                                            </ng-container>
                                        </div>
                                    </div>
                                </ng-container>
                                <div class="report-header-sub-heading mt-1 ml-1 mb-1">{{loanDataHolder?.branch?.name}}
                                    Branch
                                    ,
                                    {{loanDataHolder?.branch?.province?.name}}</div>
                            </div>
                        </div>
                        <div class="col-md-3 text-right">
                            <img class="report-log img-thumbnail border-0" src="../../../../../assets/img/logo.png">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-9 d-flex justify-content-start">
                <div>
                    <button nbButton outline (click)="onOpen()" class="btn btn-danger btn-flat btn-sm" type="button">Credit Risk Gamma
                    </button>
                </div>
            </div>
            <hr>
            <section class="container-fluid">
                <div class="row">
                    <div class="col-md-12 sb-small">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">TO</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">: <span
                                        class="font-weight-bold">{{loanDataHolder?.currentStage?.toUser?.name}}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 sb-small">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">THROUGH</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">: ...................</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 sb-small">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">FROM</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">: <span
                                        class="font-weight-bold">{{loanDataHolder?.currentStage?.fromUser?.name}}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 sb-small">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">SUBJECT</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">: <span
                                        class="font-weight-bold">{{loanDataHolder?.currentStage?.docAction}}</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 sb-small">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">CLIENT NAME</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">: <span
                                        class="font-weight-bold">{{loanDataHolder?.loanHolder?.name}}</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 sb-small">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">GROUP(Name,Code)</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">{{loanDataHolder?.loanHolder?.mgroupInfo?.groupName}}, {{loanDataHolder?.loanHolder?.mgroupInfo?.groupCode}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 sb-small" *ngFor="let item of individualData?.accountDetails; let i = index">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">ACCOUNT NUMBER {{i + 1}}</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">: <span class="font-weight-bold">{{item?.accountNo}}</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 sb-small">
                        <div class="row">
                            <div class="col-md-2">
                                <p class="font-weight-bold sb-small">CUSTOMER ID</p>
                            </div>
                            <div class="col-md-2">
                                <p class="sb-small">: <span
                                        class="font-weight-bold">{{loanDataHolder?.loanHolder?.idNumber}}</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 sb-small">
                        <div class="row">
                            <div class="col-md-4">
                                <p class="font-weight-bold sb-small">DATE</p>
                            </div>
                            <div class="col-md-4">
                                <p class="sb-small">: <span
                                        class="font-weight-bold">{{loanDataHolder?.loanHolder?.idRegDate | date}}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 sb-small">
                        <div class="row justify-content-end">
                            <div class="col-md-4">
                                <p class="font-weight-bold sb-small text-right">REF. NO. CCBL</p>
                            </div>
                            <div class="col-md-4">
                                <p class="sb-small">: <span class="font-weight-bold">{{loanDataHolder.refNo}}</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- DO NOT REMOVE -->

            <!-- <div class="row">
                <div class="col-md-6 sb-small">
                    <span><strong>Ref. No: </strong>{{loanDataHolder?.refNo}}</span>
                </div>
            </div>

            <div class="row sb-small">
                <div class="col-md-12">
                    <b>Purpose: {{loanDataHolder?.loan?.name}}</b>
                    <span class="float-right"><b>Loan Authority Under</b>- {{loanDataHolder?.currentStage?.toUser?.name}}
                        ({{loanDataHolder?.currentStage?.toRole?.roleName}})</span>
                </div>
            </div>
            <div class="row sb-small mb-1">
                <div class="col-md-12">
                    <span> <b>Application Received On:</b> {{loanDataHolder?.createdAt | date}} ({{loanDataHolder?.createdAt | engNepDate: false}})</span>
                    <span class="float-right"><b>
                        <span *ngIf="currentDocAction === 'FORWARD'">Forwarded</span>
                        <span *ngIf="currentDocAction === 'BACKWARD'">Backwarded</span> by: </b>{{loanDataHolder?.currentStage?.fromUser?.name}}
                        ({{loanDataHolder?.currentStage?.fromRole?.roleName}})
                        <b> on:</b> {{loanDataHolder?.lastModifiedAt | date}} ({{loanDataHolder?.lastModifiedAt | engNepDate: false}})
                    </span>

                </div>
            </div> -->
            <hr>
            <div class="container-fluid">
                <ol class="heading-list">
                    <li>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Date of Association: </strong>New Client</p>
                            </div>
                            <div class="col-md-6 text-right">
                                <p><strong>Late Date of Inspection: </strong>................</p>
                                <p><strong>Group: </strong>NA</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <p><strong>Capital Structure:</strong> NA</p>
                    </li>
                    <li>
                        <p><strong>Proprietor/Promoters/Shareholding Pattern:</strong> NA</p>
                    </li>
                    <li>
                        <p><strong>Request of the Client: </strong></p>
                        <p>............................................................................</p>
                    </li>
                    <li>
                        <p><strong>Business activity/customer background: </strong></p>
                        <p> Mr. ...........................................................................</p>
                    </li>
                    <li>
                        <p><strong>Financial Performance</strong></p>
                        <app-retail-financial-performance [loanDataHolder]="loanDataHolder"
                            [financialData]="financialData">
                        </app-retail-financial-performance>
                    </li>
                    <li>
                        <p><strong>Purpose and Justification of Credit Proposal:</strong></p>
                        <app-retail-purpose-and-justification [loanDataHolder]="loanDataHolder"
                                                              [proposalData]="proposalData"></app-retail-purpose-and-justification>
                    </li>
                    <li>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Source of Repayment</strong></p>
                            </div>
                            <div class="col-md-6">
                                <p class="text-right"><strong>PAN No. : {{incomeSource?.panNumber}}</strong></p>
                            </div>
                        </div>
                        <app-retail-source-of-repayment></app-retail-source-of-repayment>
                    </li>
                    <li>
                        <p><strong>Present Stock and Receivables, Payable Position: NA</strong></p>
                    </li>
                    <li>
                        <p><strong>Current limits and outstanding of the Client: NA</strong></p>
                    </li>
                    <li>
                        <p><strong>Name of the companies under the group: NA</strong></p>
                    </li>

                    <li *ngIf="loanDataHolder?.loanHolder?.mgroupInfo">
                        <!-- group position -->
                        <strong>GROUP EXPOSURE</strong>
                        as of {{loanDataHolder?.loanHolder?.mgroupInfo?.groupExposureDate
                        ? (loanDataHolder?.loanHolder?.mgroupInfo?.groupExposureDate | date) : 'NA'}}
                        <app-m-group-summary [mGroup]="loanDataHolder?.loanHolder.mgroupInfo"></app-m-group-summary>
                    </li>
                    <li>
                        <p><strong>Regularity of payments: NA</strong></p>
                    </li>
                    <li>
                        <p><strong>Transaction Record of the client: New Relationship. Yet to be tested </strong></p>
                    </li>
                    <li>
                        <p><strong>Profitability of the Client:</strong></p>
                        <app-retail-profitability-of-clien></app-retail-profitability-of-clien>
                    </li>
                    <li>
                        <p><strong>Profitability: NA</strong></p>
                    </li>
                    <li>
                        <p><strong>Risks:</strong></p>
                        <app-retail-risks></app-retail-risks>
                    </li>
                    <li>
                        <p><strong>Compliance:</strong> We have fully adhered the policy of NRB and internal bank
                            policies.</p>
                        <app-retail-compliance></app-retail-compliance>
                    </li>
                    <li>
                        <p class="text-uppercase"><strong>Banking Arrangement</strong></p>
                        <app-above-banking-arrangement-of-the-customer *ngIf="loanDataHolder?.loanHolder?.multiBanking"
                                                                       [multiBanking]="loanDataHolder?.loanHolder?.multiBanking"
                                                                       [proposal]="loanDataHolder?.proposal"
                                                                       [cicl]="loanDataHolder?.loanHolder?.cicl"
                                                                       [customerCategory]="loanDataHolder?.loanHolder?.customerCategory"></app-above-banking-arrangement-of-the-customer>
<!--                        <p><strong>Report from CICL</strong></p>-->
<!--                        <app-retail-report-cicl></app-retail-report-cicl>-->
                    </li>
                    <li>
                        <p><strong>Waiver/Deviation: ...................</strong></p>
                        <p>Justification: ..........................</p>
                    </li>
                    <li>
                        <p><strong>Recommendation: </strong></p>
                        <app-retail-recommendation [loanDataHolder]="loanDataHolder"></app-retail-recommendation>
                    </li>
                    <li>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Security (to be obtained)</strong></p>
                            </div>
                            <div class="col-md-6 text-right">
                                <p>Amount in NPR Million</p>
                            </div>
                        </div>
                        <app-retail-security></app-retail-security>
                    </li>
                </ol>
            </div>

            <ng-template #allDocumentView>
                <app-all-document-view *ngIf="loanDataHolder" [loanDataHolder]="loanDataHolder"
                    [siteVisitDocument]="siteVisitDocuments"></app-all-document-view>
            </ng-template>

        </div>
    </nb-card-body>
</nb-card>
