<nb-card class="p-3">
    <div class="box-header with-border">
        <h2 class="box-title title">Insurance Policy Security</h2>
    </div>
    <hr>
    <form [formGroup]="insurancePolicyForm">
        <div *ngFor="let insurancePolicy of insurancePolicyForm.get('insurancePolicy')['controls']; let i = index"
             class="font-weight-bold"
             formArrayName="insurancePolicy">
            <div [formGroupName]="i.toString()">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Insured Amount</label>
                            <input [ngClass]="{'is-invalid': (submitted) && (insurancePolicy.get('insuredAmount').errors)}"
                                   class="form-control rounded" formControlName="insuredAmount"
                                   placeholder="Insured Amount"
                                   type="number" required/>
                            <div *ngIf="(submitted) && (insurancePolicy.get('insuredAmount').invalid)"
                                 class="invalid-feedback">
                                <div *ngIf="insurancePolicy.get('insuredAmount').errors.required">
                                    Insured amount is required
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Considered Value</label>
                            <input [ngClass]="{'is-invalid': (submitted) && (insurancePolicy.get('coniderValue').errors)}"
                                   class="form-control rounded" formControlName="considerValue"
                                   placeholder="Consider Value"
                                   type="number" required/>
                            <div *ngIf="(submitted) && (insurancePolicy.get('considerValue').invalid)"
                                 class="invalid-feedback">
                                <div *ngIf="insurancePolicy.get('considerValue').errors.required">
                                    Consider Value is required
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="insuranceCompanyName"><strong>Insurance Company</strong></label>
                            <select class="form-control"
                                    [ngClass]="{'is-invalid': (submitted) && (insurancePolicy.get('insuranceCompanyName').errors)}"
                                    formControlName="insuranceCompanyName"
                                    id="insuranceCompanyName">
                                <option [ngValue]="null">--Select Insurance Company--</option>
                                <option *ngFor="let insuranceCompany of insuranceCompanyList"
                                        [ngValue]="insuranceCompany.id">{{insuranceCompany.name}}</option>
                            </select>
                            <div *ngIf="(submitted) && (insurancePolicy.get('insuranceCompanyName').invalid)"
                                 class="invalid-feedback">
                                <div *ngIf="insurancePolicy.get('insuranceCompanyName').errors.required">
                                    Insured amount is required
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Insurance Policy Start </label>
                            <input class="form-control rounded" formControlName="policyStartDate"
                                   name="policyStartDate" placeholder="Insurance Policy Start date"
                                   [nbDatepicker]="insurancePolicyDate"
                                   *ngIf="calendarType === 'AD'">
                            <app-calendar
                                    (messageToEmit)="insurancePolicyForm.get(['insurancePolicy',i,'policyStartDate']).patchValue($event?.eDate)"
                                    *ngIf="calendarType === 'BS'"
                                    [ePreDate]="insurancePolicyForm.get(['insurancePolicy',i,'policyStartDate']).value"></app-calendar>
                            <nb-datepicker #insurancePolicyDate></nb-datepicker>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Maturity Date</label>
                            <input class="form-control rounded" formControlName="maturityDate"
                                   name="policyStartDate" placeholder="Maturity Date" [nbDatepicker]="maturityDate"
                                   *ngIf="calendarType === 'AD'">
                            <app-calendar
                                    (messageToEmit)="insurancePolicyForm.get(['insurancePolicy',i,'maturityDate']).patchValue($event?.eDate)"
                                    *ngIf="calendarType === 'BS'"
                                    [ePreDate]="insurancePolicyForm.get(['insurancePolicy',i,'maturityDate']).value"></app-calendar>
                            <nb-datepicker #maturityDate></nb-datepicker>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Insurance Policy Type</label>
                            <input class="form-control rounded" formControlName="insurancePolicyType"
                                   placeholder="Insurance Policy Type"
                                   type="text"/>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Surrender Value</label>
                            <input class="form-control rounded" formControlName="surrenderValue"
                                   placeholder="Surrender Value"
                                   type="number"/>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Earliest Surrender Date</label>
                            <input class="form-control rounded" formControlName="earlySurrenderDate"
                                   name="earlySurrenderDate" placeholder="Earliest Surrender Date"
                                   [nbDatepicker]="earlySurrenderDate"
                                   *ngIf="calendarType === 'AD'">
                            <app-calendar
                                    (messageToEmit)="insurancePolicyForm.get(['insurancePolicy',i,'earlySurrenderDate']).patchValue($event?.eDate)"
                                    *ngIf="calendarType === 'BS'"
                                    [ePreDate]="insurancePolicyForm.get(['insurancePolicy',i,'earlySurrenderDate']).value"></app-calendar>
                            <nb-datepicker #earlySurrenderDate></nb-datepicker>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Realisable Value</label>
                            <input class="form-control rounded" formControlName="consideredValue"
                                   placeholder="Realisable Value"
                                   type="number" appDecimalNumber/>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title">Yearly Cash Back Amount <em class="sb-medium">(if any)</em></label>
                            <input class="form-control rounded" formControlName="cashBackAmount"
                                   placeholder="Yearly Cash Back Amount"
                                   type="number"/>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="title" for="insurancePolicyFirstValuationDate">First Valuation Date</label>
                            <input *ngIf="calendarType === 'AD'" class="form-control rounded"
                                   formControlName="insurancePolicyFirstValuationDate"
                                   id="insurancePolicyFirstValuationDate"
                                   name="insurancePolicyFirstValuationDate" placeholder="First Valuation Date"
                                   [nbDatepicker]="firstValuationDate"
                                   type="text"/>
                            <app-calendar
                                    (messageToEmit)="insurancePolicyForm.get(['insurancePolicy', i,'insurancePolicyFirstValuationDate']).patchValue($event?.eDate)"
                                    *ngIf="calendarType === 'BS'"
                                    [ePreDate]="insurancePolicyForm.get(['insurancePolicy', i,'insurancePolicyFirstValuationDate']).value"></app-calendar>
                            <nb-datepicker #firstValuationDate></nb-datepicker>
                        </div>
                    </div>
                </div>
                <div *ngIf="insurancePolicyForm.get('insurancePolicy') ['length'] > 1" class="text-right">
                    <input (click)="removeInsurance(i)"
                           class="align-self-end btn btn-sm btn-danger btn-primary"
                           type="button" value="Delete"/>
                </div>
                <br>
            </div>
            <div class="text-right" >
                <input (click)="addInsurancePolicy()" class="btn btn-sm btn-flat btn-primary" type="button"
                       value="Add More Insurance Policy"/>
            </div>

        </div>
    </form>
</nb-card>
