<div class="tab-pane fade active show" id="proposal">
    <div class="row">
        <div class="col-md-12">
            <nb-card>
                <nb-card-body>
                    <div class="form-group">
                        <form (ngSubmit)="onSubmit()" [formGroup]="proposalForm" class="form-horizontal">
                            <div class="row">
                                <div class="col-md-4" *ngIf="checkApproved">
                                    <div class="form-group">
                                        <label class="title" for="existingLimit"><strong>Existing Limit</strong></label>
                                        <input class="form-control"
                                               [readOnly]="loanType == 'PARTIAL_SETTLEMENT_LOAN'"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.existingLimit.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="existingLimit" id="existingLimit"
                                               name="existingLimit" placeholder="Existing limit"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.existingLimit.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.existingLimit.errors.required)">Existing Limit is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4" *ngIf="loanType !== 'NEW_LOAN'">
                                    <div class="form-group">
                                        <label class="title" for="outStandingLimit">
                                            <strong>Outstanding Limit</strong>
                                        </label>
                                        <input class="form-control"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.outStandingLimit.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="outStandingLimit" id="outStandingLimit"
                                               name="outStandingLimit" placeholder="Limit Amount"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.outStandingLimit.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.outStandingLimit.errors.required)">Amount is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4" *ngIf="loanType === 'PARTIAL_SETTLEMENT_LOAN'">
                                    <div class="form-group">
                                        <label class="title" for="settlementAmount"></label>
                                        <strong>Settlement Amount</strong>
                                        <input class="form-control"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.settlementAmount.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="settlementAmount" id="settlementAmount"
                                               name="settlementAmount" placeholder="Settlement Amount"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.settlementAmount.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.settlementAmount.errors.required)">Settlement Amount is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4" *ngIf="loanType === 'RENEW_WITH_ENHANCEMENT' || loanType === 'ENHANCED_LOAN'">
                                    <div class="form-group">
                                        <label class="title" for="enhanceLimitAmount">
                                            <strong>{{loanType === 'RENEW_WITH_ENHANCEMENT' ? 'Enhance Limit' : 'Enhancement Amount'}}</strong>
                                        </label>
                                        <input class="form-control"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.enhanceLimitAmount.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="enhanceLimitAmount" id="enhanceLimitAmount"
                                               name="enhanceLimitAmount" placeholder="Enhance Amount"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.enhanceLimitAmount.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.enhanceLimitAmount.errors.required)">Enhance limit is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="proposedLimit"><strong>Proposed Limit</strong></label>
                                        <input
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.proposedLimit.errors }"
                                                class="form-control"
                                                [readOnly]="loanType == 'PARTIAL_SETTLEMENT_LOAN' || loanType === 'RENEW_WITH_ENHANCEMENT' || loanType === 'ENHANCED_LOAN'"
                                                formControlName="proposedLimit" id="proposedLimit"
                                                name="proposedLimit" placeholder="Proposed limit"
                                                type="number" (input)="checkRepaymentMode();checkCustomRepaymentMode()" appDecimalNumber>
                                        <div *ngIf=" (submitted)  && formControls.proposedLimit.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.proposedLimit.errors.required)">Proposed Limit is required</span>

                                            <span *ngIf="(formControls.proposedLimit.errors.min)">Proposed Limit must be positive numerical value.</span>
                                            <span *ngIf="proposalForm.get('proposedLimit').hasError('amountRange') ">Minimum proposed amount must be greater than Rs.<strong>{{minimumAmountLimit}}</strong></span>
                                        </div>
                                    </div>
                                </div>

                                <div *ngIf="!isFundable && fundableNonFundableSelcted" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="commissionFrequency"><strong>Commission
                                            Frequency</strong></label>
                                        <select
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.commissionFrequency.errors }"
                                                class="form-control" formControlName="commissionFrequency"
                                                id="commissionFrequency" name="commissionFrequency">
                                            <option [ngValue]="null" hidden>Select Commission Frequency</option>
                                            <option value="MONTH">Per Month</option>
                                            <option value="QUATER">Per Quarter</option>
                                            <option value="ANNUM">Per Annum</option>
                                        </select>
                                        <div *ngIf="(submitted) && formControls.commissionFrequency.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.commissionFrequency.errors.required">Commission Frequency is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div *ngIf="isFixedDeposit" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="couponRate"><strong>Coupon Rate</strong></label>
                                        <input
                                                class="form-control" formControlName="couponRate"
                                                id="couponRate" name="couponRate" placeholder="Coupon Rate"
                                                type="number">
                                    </div>
                                </div>
                                <div *ngIf="isFixedDeposit" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="premiumOnCouponRate"><strong>Premium On Coupon
                                            Rate</strong></label>
                                        <input
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.premiumOnCouponRate.errors }"
                                                class="form-control" formControlName="premiumOnCouponRate"
                                                id="premiumOnCouponRate" name="premiumOnCouponRate"
                                                placeholder="Premium On Coupon Rate"
                                                type="number">
                                        <div *ngIf="(submitted) && formControls.premiumOnCouponRate.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.premiumOnCouponRate.errors.required">Premium On Coupon Rate is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral || isHomeLoan">
                                    <div class="form-group">
                                        <label class="title" for="baseRate"><strong>Base Rate(%)</strong></label>
                                        <input
                                                class="form-control" formControlName="baseRate" id="baseRate"
                                                name="baseRate" placeholder="Base Rate(%)"
                                                type="number" appDecimalNumber>
                                    </div>
                                </div>
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral || isHomeLoan">
                                    <div class="form-group">
                                        <label class="title" for="premiumRateOnBaseRate"><strong>Premium Rate On Base
                                            Rate(%)</strong></label>
                                        <input
                                                class="form-control"
                                                class="form-control" formControlName="premiumRateOnBaseRate"
                                                id="premiumRateOnBaseRate" name="premiumRate"
                                                placeholder="Base Rate(%)" placeholder="Premium Rate On Base Rate(%)"
                                                type="number" readonly>
                                    </div>
                                </div>
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral || isHomeLoan">
                                    <div class="form-group">
                                        <label class="title" for="tenureDurationInMonths"><strong>Tenure Duration in
                                            Month.</strong></label>
                                        <input
                                                class="form-control"
                                                formControlName="tenureDurationInMonths" id="tenureDurationInMonths"
                                                placeholder="Tenure Duration in Months"
                                                type="number" (input)="checkRepaymentMode();checkCustomRepaymentMode()" appDecimalNumber>
                                    </div>
                                </div>

                                <!--                                start of repayment mode-->
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted &&  isFundable &&  isTerminating) || isVehicle || isShare || isGeneral || isHomeLoan">
                                    <div class="form-group">
                                        <label class="title" for="repaymentMode" ><strong>Repayment Mode</strong></label>
                                        <select
                                                class="custom-select" formControlName="repaymentMode"
                                                id="repaymentMode"
                                                name="repaymentMode"
                                                (change)="checkInstallmentAmount()">
                                            <option [ngValue]="null" hidden selected>Select</option>
                                            <option value="EMI">EMI</option>
                                            <option value="EQI">EQI</option>
                                            <option value="AT MATURITY">At Maturity</option>
                                            <option value="CUSTOM">Custom</option>
                                        </select>
                                    </div>
                                </div>
                                <div  *ngIf="showRepaymentMode" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="repaymentModeInterest"><strong>Interest Payment</strong></label>
                                        <select
                                            #interestRepayment
                                            [ngClass]="{ 'is-invalid': (submitted) && formControls.repaymentModeInterest.errors }"
                                            class="custom-select" formControlName="repaymentModeInterest"
                                            id="repaymentModeInterest"
                                            name="repaymentModeInterest"
                                            (change)="calculateRepaymentModeAmounts(interestRepayment.value , 'INTEREST')">
                                            <option [ngValue]="null" hidden selected>Select</option>
                                            <option value="MONTHLY">Monthly</option>
                                            <option value="QUARTERLY">Quarterly</option>
                                            <option value="SEMI-ANNUALLY">Semi-Annually</option>
                                            <option value="ANNUALLY">Annually</option>
                                        </select>

                                        <div *ngIf="(submitted) && formControls.repaymentModeInterest.invalid"
                                             class="invalid-feedback">
                                        <span *ngIf="formControls.repaymentModeInterest.errors.required">
                                            Repayment Frequency is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div  class="col-md-4" *ngIf="showRepaymentMode">
                                    <div class="form-group">
                                        <label class="title" for="repaymentModePrincipal"><strong>Principal Payment</strong></label>
                                        <select
                                            #repaymentModePrincipal
                                            [ngClass]="{ 'is-invalid': (submitted) && formControls.repaymentModePrincipal.errors }"
                                            class="custom-select" formControlName="repaymentModePrincipal"
                                            id="repaymentModePrincipal"
                                            name="repaymentModePrincipal"
                                            (change)="calculateRepaymentModeAmounts(repaymentModePrincipal.value , 'PRINCIPAL')">
                                            <option [ngValue]="null" hidden selected>Select</option>
                                            <option value="MONTHLY">Monthly</option>
                                            <option value="QUARTERLY">Quarterly</option>
                                            <option value="SEMI-ANNUALLY">Semi-Annually</option>
                                            <option value="ANNUALLY">Annually</option>
                                        </select>
                                        <div *ngIf="(submitted) && formControls.repaymentModePrincipal.invalid"
                                             class="invalid-feedback">
                                        <span *ngIf="formControls.repaymentModePrincipal.errors.required">
                                            Repayment Frequency is required</span>
                                        </div>
                                    </div>
                                </div>
                                <!--                                end of repayment mode-->

                                <!--                start of installment amount div-->
                                <div class="col-md-4" (change)="checkRepaymentMode()"
                                     *ngIf="showInstallmentAmount  && ((loanNatureSelected && fundableNonFundableSelcted && isTerminating  && isFundable) || ( isVehicle || isShare || isGeneral || isHomeLoan))">
                                    <div class="form-group>">
                                        <label class="title"> <strong>Installment Amount</strong></label>
                                        <input
                                                class="form-control" formControlName="installmentAmount"
                                                id="installmentAmount"
                                                name="installmentAmount" placeholder="Installment Amount"
                                                type="number" readonly>
                                    </div>
                                </div>
                                <!--                end of ng s
                                installment amount div-->
                                    <div class="col-md-4"
                                         *ngIf="((this.proposalForm.get('repaymentMode').value != null) && (!showInstallmentAmount || showRepaymentMode) &&
                                           ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral || isHomeLoan)))
                                           ">
                                        <div class="form-group>">
                                            <label class="title"> <strong>Interest Amount</strong></label>
                                            <input
                                                    class="form-control" formControlName="interestAmount"
                                                    id="interestAmount"
                                                    name="interestAmount" placeholder="Interest Amount" disabled
                                                    type="number">
                                        </div>
                                    </div>
                                    <div class="col-md-4"
                                         *ngIf="((this.proposalForm.get('repaymentMode').value != null) && (!showInstallmentAmount || showRepaymentMode) &&
                                           ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral || isHomeLoan)))
                                           ">
                                        <div class="form-group>">
                                            <label class="title"> <strong>Principal Amount</strong></label>
                                            <input
                                                    class="form-control" formControlName="principalAmount"
                                                    id="principalAmount"
                                                    name="principalAmount" placeholder="Principle Amount" disabled
                                                    type="number">
                                        </div>
                                    </div>

                                <!--                start of Moratorium period amount div-->
                                <div class="col-md-4" (change)="checkRepaymentMode()"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isGeneral || isHomeLoan">
                                    <div class="form-group>">
                                        <label class="title"> <strong>Moratorium Period (Month)</strong></label>
                                        <input
                                                class="form-control" formControlName="moratoriumPeriod"
                                                id="moratoriumPeriod"
                                                name="moratoriumPeriod" placeholder="Example: 4 month"
                                                type="number" appDecimalNumber>
                                    </div>
                                </div>
                                <!--                end of Moratorium Period amount div-->
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="collateralRequirement"><strong>Collateral requirement
                                            (in%)</strong></label>
                                        <input
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.collateralRequirement.errors }"
                                                class="form-control"
                                                formControlName="collateralRequirement" id="collateralRequirement"
                                                name="collateralRequirement"
                                                placeholder="Collateral requirement" type="number" appDecimalNumber/>
                                        <div *ngIf="(submitted) && formControls.collateralRequirement.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.collateralRequirement.errors.required">Collateral requirement is required.</span>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-4" *ngIf="loanType !== 'NEW_LOAN'">
                                    <div class="form-group">
                                        <label class="title" for="existingDateOfExpiry"><strong>Existing Date of Expiry</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && formControls.existingDateOfExpiry.errors }"
                                               class="form-control" formControlName="existingDateOfExpiry" id="existingDateOfExpiry"
                                               name="existingDateOfExpiry" placeholder="Existing Date of Expiry" type="date">
                                        <div *ngIf="(submitted) && formControls.existingDateOfExpiry.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.existingDateOfExpiry.errors">
                                                Date of Expiry is required
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group" style="max-height: 300px !important;height: 250px;">
                                        <strong>Purpose {{customerType === 'INDIVIDUAL' ? ' and Justification' :
                                            '(utilization, drawdown ratio, tenure, repayment sources)'}}</strong>
                                        <ckeditor formControlName="purposeOfLoan"
                                                  [style]="{height:'250px !important;'}"
                                                  placeholder="Purpose"
                                                  required
                                                  [config]="ckeConfig"
                                                  [ngClass]="{'is-invalid': formControls.purposeOfLoan.invalid && submitted}">
                                        </ckeditor>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="col-md-12" style="padding-top: 70px;">
                                    <div *ngIf="submitted">
                                        <span *ngIf="formControls.purposeOfLoan.invalid" class="text-danger">
                                            <sup>*</sup> Purpose is required!
                                        </span>
                                    </div>
                                </div>
                                <div *ngIf="isShare" class="col-md-12">
                                    <div class="form-group"><strong>Debt Structure and Control Mechanism: For Overdraft/Demand Loan (Loan Against Share)</strong>
                                        <ckeditor
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.debtStructure.errors }"
                                                formControlName="debtStructure"
                                                name="debtStructure"
                                                [config]="ckeConfig"></ckeditor>
                                        <div *ngIf="(submitted) && formControls.debtStructure.invalid"
                                             class="text-danger">
                                            <span *ngIf="formControls.debtStructure.errors.required">Debt Structure Criteria is required</span>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-12" *ngIf="customerType === 'INDIVIDUAL'">
                                    <div class="form-group">
                                        <label class="title"><strong>Compliance</strong></label>
                                        <ckeditor formControlName="compliance"
                                                  [style]="{height:'250px !important;'}"
                                                  placeholder="Compliance"
                                                  [config]="ckeConfig">
                                        </ckeditor>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="title"><strong>Pricing</strong></label>
                                    <table class="table table-condensed table-bordered table-responsive-md table-sm sb-small">
                                        <thead>
                                            <tr class="sb-bg-dark text-white">
                                                <th>Pricing</th>
                                                <th>Card Rate</th>
                                                <th>Existing Rate</th>
                                                <th>Proposed Rate</th>
                                                <th>Deviation with Card Rate</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        <ng-container>
                                            <tr *ngIf="(isFundable && (isTerminating || isRevolving)) || isFixedDeposit || isVehicle || isShare || isGeneral || isHomeLoan">
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Interest Rate</td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="interestCardRate"
                                                              id="interestCardRate">
                                                </td>
                                                <td><input rows="1" class="form-control mt-1 mb-1" name="existInterestRate" formControlName="existInterestRate"
                                                               id="existInterestRate" [(ngModel)]="existInterestLimit"
                                                           type="number" appDecimalNumber></td>
                                                <td>
                                                    <input rows="1" id="interestRate" class="form-control mt-1 mb-1" type="number"
                                                           [(ngModel)]="interestLimit" formControlName="interestRate" type="number"
                                                           (input)="checkRepaymentMode(); checkCustomRepaymentMode()" appDecimalNumber>
                                                </td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="interestDevCardRate"
                                                           id="interestDevCardRate">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Processing Fee</td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="processCardRate"
                                                              id="processCardRate">
                                                </td>
                                                <td><input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="processExistingRate"
                                                              id="processExistingRate"></td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="number" formControlName="processProposedRate"
                                                              id="processProposedRate">
                                                </td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="processDevCardRate"
                                                           id="processDevCardRate">
                                                </td>
                                            </tr>
                                            <tr *ngIf="!isFundable && fundableNonFundableSelcted">
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Commissions</td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="commissionsCardRate"
                                                              id="commissionsCardRate">
                                                </td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="number" formControlName="existCommissionPercentage"
                                                              id="existCommissionPercentage"></td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="number" formControlName="commissionPercentage"
                                                              id="commissionPercentage">
                                                </td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="commissionDevCardRate"
                                                           id="commissionDevCardRate">
                                                </td>
                                            </tr>
                                            <tr *ngIf="!isFundable && fundableNonFundableSelcted">
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Cash Margin</td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="cashCardRate"
                                                              id="cashCardRate">
                                                </td>
                                                <td><input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="existCashMargin"
                                                              id="existCashMargin"></td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="number" formControlName="cashMargin">
                                                </td>
                                                <td>
                                                    <input rows="1" class="form-control mt-1 mb-1" type="text" formControlName="cashMarginDevCardRate"
                                                           id="cashMarginDevCardRate">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Prepayment Charge</td>
                                                <td colspan="4">
                                                    <table class="table-borderless table-sm" style="width: 100%">
                                                        <tbody>
                                                        <td class="border-right">If paid by own sources
                                                            <input rows="1" class="form-control mt-1 mb-1" formControlName="prepaymentCardRate"
                                                                   id="prepaymentCardRate">% of the pre-paid amount, flat
                                                        </td>
                                                        <td>If swapped to other bank/FI
                                                            <input rows="1" class="form-control mt-1 mb-1" formControlName="prepaymentExistingRate"
                                                                   id="prepaymentExistingRate">% of the pre-paid amount, flat</td>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">STR Charge</td>
                                                <td colspan="4">
                                                    <input rows="1" class="form-control mt-1 mb-1" formControlName="strCharge"
                                                              id="strCharge">
                                                </td>
                                            </tr>
                                            <tr *ngIf="((loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral || isHomeLoan)">
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Commitment Fee</td>
                                                <td colspan="4">
                                                    <input rows="1" class="form-control mt-1 mb-1" formControlName="commitmentFee">
                                                </td>
                                            </tr>
                                            <tr *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral ||isHomeLoan">
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Administrative Rate</td>
                                                    <td colspan="4">
                                                        <input rows="1" class="form-control mt-1 mb-1" formControlName="serviceCharge"
                                                                  id="serviceCharge" appDecimalNumber>
                                                    </td>
                                            </tr>
                                            <tr>
                                                <td style="vertical-align: middle;font-weight: bold; text-align: center">Other</td>
                                                <td colspan="4">
                                                        <input rows="1" class="form-control mt-1 mb-1" formControlName="other"
                                                                  id="other">
                                                </td>
                                            </tr>
                                        </ng-container>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-12" *ngIf="isHomeLoan">
                                    <nb-checkbox class="title" (change)="checkChecked($event.target.checked,'firstTimeHomeBuyer')"
                                                 [checked]="firstTimeHomeBuyerChecked"><strong style="font-size: 16px">First Time Home Buyer</strong>
                                    </nb-checkbox>
                                    <nb-radio-group class="d-flex" formControlName="creditHistory" id="creditHistory" *ngIf="fromProfile">
                                        <nb-radio value="0">With Credit History</nb-radio>
                                        <nb-radio value="1">WithOut Credit History</nb-radio>
                                    </nb-radio-group>
                                    <div class="form-group" *ngIf="firstTimeHomeBuyerChecked">
                                    </div>
                                    <div class="form-group" *ngIf="firstTimeHomeBuyerChecked">
                                        <p><i>Note: As per Unified NRB Directive 3/076, clause number 10, drawdown
                                            has been allowed up to 70% is allowed in case of fulfillment of below
                                            mentioned criteria;</i></p>
                                        <table class="table table-bordered table-responsive table-hover"
                                               style="overflow-x: hidden">
                                            <thead class="font-weight-bold">
                                            <tr>
                                                <td>S.N</td>
                                                <td>Particulars</td>
                                                <td>YES</td>
                                                <th>NO</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td>1.</td>
                                                <td>
                                                    Area of the House / Apartment to be purchased or constructed
                                                    shall not be exceeded by 3,000 square feet. Also house
                                                    /Apartment to be purchased or constructed shall be occupied
                                                    solely by the borrower?
                                                </td>
                                                <td *ngFor="let ans of yesNo">
                                                    <input [value]="ans?.value"
                                                           formControlName="yesNo1"
                                                           type="radio">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>2.</td>
                                                <td>
                                                    Has the borrower availed any loan to buy or construct a house or
                                                    apartment before form any Bank or Financial Institutions
                                                    (BFIâ€™s)?
                                                </td>
                                                <td *ngFor="let ans of yesNo">
                                                    <input [value]="ans?.value"
                                                           formControlName="yesNo2"
                                                           type="radio">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>3.</td>
                                                <td>
                                                    Rented income considered for repayment purpose?
                                                </td>
                                                <td *ngFor="let ans of yesNo">
                                                    <input [value]="ans?.value"
                                                           formControlName="yesNo3"
                                                           type="radio">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>4.</td>
                                                <td>
                                                    Monthly installments shall remain same even after increase in
                                                    interest rate in future and repayment modality will be
                                                    structured accordingly. This debt covenant shall be included in
                                                    Offer Letter
                                                </td>
                                                <td *ngFor="let ans of yesNo">
                                                    <input [value]="ans?.value"
                                                           formControlName="yesNo4"
                                                           type="radio">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>5.</td>
                                                <td>
                                                    Checklist regarding above clauses (1-3) has been duly filled by
                                                    borrower
                                                </td>
                                                <td *ngFor="let ans of yesNo">
                                                    <input [value]="ans?.value"
                                                           formControlName="yesNo5"
                                                           type="radio">
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <ng-container *ngIf="!fromProfile && customerType === 'INSTITUTION'">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="title" for="specialCovenant"><strong>Special Covenants/Conditions, If Any</strong></label>
                                            <ckeditor
                                                    [ngClass]="{ 'is-invalid': (submitted) && formControls.specialCovenant.errors }"
                                                    formControlName="specialCovenant" id="specialCovenant"
                                                    name="specialCovenant"
                                                    [config]="ckeConfig"></ckeditor>
                                            <div *ngIf="(submitted) && formControls.specialCovenant.invalid"
                                                 class="text-danger">
                                                <span *ngIf="formControls.specialCovenant.errors.required">Special Covenants/Conditions is required.</span>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="customerType === 'INSTITUTION'">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="title" for="disbursementCriteria"><strong>Disbursement Criteria</strong></label>
                                            <ckeditor
                                                    [ngClass]="{ 'is-invalid': (submitted) && formControls.disbursementCriteria.errors }"
                                                    formControlName="disbursementCriteria" id="disbursementCriteria"
                                                    name="disbursementCriteria"
                                                    [config]="ckeConfig"></ckeditor>
                                            <div *ngIf="(submitted) && formControls.disbursementCriteria.invalid"
                                                 class="text-danger">
                                                <span *ngIf="formControls.disbursementCriteria.errors.required">Disbursement Criteria is required.</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label class="title" for="repayment"><strong>Repayment</strong></label>
                                            <ckeditor
                                                    [ngClass]="{ 'is-invalid': (submitted) && formControls.repayment.errors }"
                                                    formControlName="repayment" id="repayment"
                                                    name="repayment"
                                                    [config]="ckeConfig"></ckeditor>
                                            <div *ngIf="(submitted) && formControls.repayment.invalid"
                                                 class="text-danger">
                                                <span *ngIf="formControls.repayment.errors.required">Repayment is required.</span>
                                            </div>
                                        </div>
                                    </div>

                                </ng-container>
                                <div class="col-md-12 form-group" *ngIf="!fromProfile">
                                    <b>WAIVERS, DEVIATIONS, DIFERRALS AND REBETS, <em>(IF ANY)</em></b>
                                    <div>
                                        <ckeditor formControlName="waiverConclusionRecommendation"
                                                  [config]="ckeConfig"></ckeditor>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <ng-container *ngIf="customerType === 'INDIVIDUAL' && fromProfile">
                        <div class="col-md-12">
                            <nb-accordion>
                                <nb-accordion-item>
                                    <nb-accordion-item-header>
                                        Credit Scoring
                                    </nb-accordion-item-header>
                                    <nb-accordion-item-body>
                                        <app-credit-risk-grading-gamma  #crgGamma *ngIf="fromProfile"
                                                                        [formData]="loan?.crgGamma"
                                                                       [fromProfile]="true"
                                                                       [loanConfigId]="fromProfile ? loan?.loan?.id : allId?.loanId"
                                                                        [creditHistory]="proposalForm?.get('creditHistory')?.value"
                                                                        (crgDataEmitter)="setIndividualCrgGamma($event)"
                                                                       ></app-credit-risk-grading-gamma>
                                    </nb-accordion-item-body>
                                </nb-accordion-item>


                            </nb-accordion>
                        </div>
                    </ng-container>
                    <br>
                    <ng-container  *ngIf="fromProfile" >
                        <div class="col-md-12">
                            <app-guarantor-adder  (emitter)="guarantors($event)"
                                                  [taggedGuarantors]="loan?.taggedGuarantors"
                                                  [guarantorData]="customerInfo?.guarantors">
                            </app-guarantor-adder>
                        </div>
                    </ng-container>
                    <button class="float-right" nbButton (click)="onSubmit()" *ngIf="fromProfile">Save</button>
                </nb-card-body>
            </nb-card>
        </div>
    </div>
</div>
