<div class="tab-pane fade active show" id="proposal">
    <div class="row">
        <div class="col-md-12">
            <nb-card>
                <nb-card-body>
                    <div class="form-group">
                        <form (ngSubmit)="onSubmit()" [formGroup]="proposalForm" class="form-horizontal">
                            <div class="row">
                                <div class="col-md-4" *ngIf="checkApproved">
                                    <div class="form-group">
                                        <label class="title" for="existingLimit"><strong>Existing Limit</strong></label>
                                        <input class="form-control"
                                               [readOnly]="loanType == 'PARTIAL_SETTLEMENT_LOAN'"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.existingLimit.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="existingLimit" id="existingLimit"
                                               name="existingLimit" placeholder="Existing limit"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.existingLimit.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.existingLimit.errors.required)">Existing Limit is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4" *ngIf="loanType !== 'NEW_LOAN'">
                                    <div class="form-group">
                                        <label class="title" for="outStandingLimit">
<!--                                            <span [ngSwitch]="loanType">-->
<!--                                            <strong  *ngSwitchCase = "'PARTIAL_SETTLEMENT_LOAN'">Settlement Amount</strong>-->
<!--                                            <strong  *ngSwitchCase = "'ENHANCED_LOAN'">Enhancement Amount</strong>-->
<!--                                            <strong  *ngSwitchDefault>Outstanding Limit</strong>-->
<!--                                            </span>-->
                                            <strong>Outstanding Limit</strong>
                                        </label>
                                        <input class="form-control"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.outStandingLimit.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="outStandingLimit" id="outStandingLimit"
                                               name="outStandingLimit" placeholder="Limit Amount"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.outStandingLimit.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.outStandingLimit.errors.required)">Amount is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4" *ngIf="loanType === 'PARTIAL_SETTLEMENT_LOAN'">
                                    <div class="form-group">
                                        <label class="title" for="settlementAmount"></label>
                                        <strong>Settlement Amount</strong>
                                        <input class="form-control"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.settlementAmount.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="settlementAmount" id="settlementAmount"
                                               name="settlementAmount" placeholder="Settlement Amount"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.settlementAmount.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.settlementAmount.errors.required)">Settlement Amount is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4" *ngIf="loanType === 'RENEW_WITH_ENHANCEMENT' || loanType === 'ENHANCED_LOAN'">
                                    <div class="form-group">
                                        <label class="title" for="enhanceLimitAmount">
                                            <strong>{{loanType === 'RENEW_WITH_ENHANCEMENT' ? 'Enhance Limit' : 'Enhancement Amount'}}</strong>
                                        </label>
                                        <input class="form-control"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.enhanceLimitAmount.errors }"
                                               (keyup)="calculateLimitValues()"
                                               formControlName="enhanceLimitAmount" id="enhanceLimitAmount"
                                               name="enhanceLimitAmount" placeholder="Enhance Amount"
                                               type="number">
                                        <div *ngIf=" (submitted)  && formControls.enhanceLimitAmount.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.enhanceLimitAmount.errors.required)">Enhance limit is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="proposedLimit"><strong>Proposed Limit</strong></label>
                                        <input
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.proposedLimit.errors }"
                                                class="form-control"
                                                [readOnly]="loanType == 'PARTIAL_SETTLEMENT_LOAN' || loanType === 'RENEW_WITH_ENHANCEMENT' || loanType === 'ENHANCED_LOAN'"
                                                formControlName="proposedLimit" id="proposedLimit"
                                                name="proposedLimit" placeholder="Proposed limit"
                                                type="number" (input)="checkRepaymentMode();checkCustomRepaymentMode()" appDecimalNumber>
                                        <div *ngIf=" (submitted)  && formControls.proposedLimit.errors"
                                             class="invalid-feedback">
                                            <span *ngIf="(formControls.proposedLimit.errors.required)">Proposed Limit is required</span>

                                            <span *ngIf="(formControls.proposedLimit.errors.min)">Proposed Limit must be positive numerical value.</span>
                                            <span *ngIf="proposalForm.get('proposedLimit').hasError('amountRange') ">Minimum proposed amount must be greater than Rs.<strong>{{minimumAmountLimit}}</strong></span>
                                        </div>
                                    </div>
                                </div>

                                <div *ngIf="!isFundable && fundableNonFundableSelcted && loanType !== 'NEW_LOAN'" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="existCashMargin"><strong> Existing Cash Margin</strong>
                                            <input
                                                    formControlName="existCashMarginMethod"
                                                    name="existCashMarginMethod"
                                                    type="radio"
                                                    value="PERCENT"> <strong> % </strong>
                                            <input
                                                    formControlName="existCashMarginMethod"
                                                    name="existCashMarginMethod"
                                                    type="radio"
                                                    value="FLAT"> <strong>Flat</strong>
                                        </label>
                                        <input
                                                class="form-control" formControlName="existCashMargin"
                                                id="existCashMargin"
                                                name="existCashMargin" placeholder=" Existing Cash Margin"
                                                type="number">

                                    </div>
                                </div>

                                <div *ngIf="!isFundable && fundableNonFundableSelcted" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="cashMargin"><strong>Cash Margin</strong>
                                            <input
                                                    formControlName="cashMarginMethod"
                                                    name="cashMarginMethod" type="radio"
                                                    value="PERCENT"><strong>% </strong>
                                            <input formControlName="cashMarginMethod" name="cashMarginMethod"
                                                   type="radio" value="FLAT"><strong> Flat</strong>
                                            <!--                      <small-->
                                            <!--                          *ngIf="(submitted) && formControls.cashMarginMethod.invalid && formControls.cashMarginMethod.errors.required"-->
                                            <!--                          style="color:#DC3545">-->
                                            <!--                        Charge method is required-->
                                            <!--                      </small>-->
                                        </label>
                                        <input
                                                class="form-control" formControlName="cashMargin"
                                                id="cashMargin"
                                                name="cashMargin" placeholder="Cash Margin"
                                                type="number">
                                        <!--                    <div *ngIf="(submitted) && formControls.cashMargin.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.cashMargin.errors.required">Cash Margin is required</span>-->

                                        <!--                    </div>-->
                                    </div>

                                </div>

                                <div *ngIf="!isFundable && fundableNonFundableSelcted && loanType !== 'NEW_LOAN'" class="col-md-4">
                                    <div class="form-group">
                                        <label for="existCommissionPercentage"><strong>Existing Commission (%)</strong></label>
                                        <input
                                                class="form-control" formControlName="existCommissionPercentage"
                                                id="existCommissionPercentage" name="existCommissionPercentage"
                                                placeholder="Existing Commision (%)"
                                                type="number">
                                    </div>
                                </div>
                                <div *ngIf="!isFundable && fundableNonFundableSelcted" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="commissionPercentage"><strong>Commission (%)</strong></label>
                                        <input
                                                class="form-control" formControlName="commissionPercentage"
                                                id="commissionPercentage" name="commissionPercentage"
                                                placeholder="Commission (%)"
                                                type="number">
                                        <!--                    <div *ngIf="(submitted) && formControls.commissionPercentage.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.commissionPercentage.errors.required">Commission % is required</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>
                                <div *ngIf="!isFundable && fundableNonFundableSelcted" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="commissionFrequency"><strong>Commission
                                            Frequency</strong></label>
                                        <select
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.commissionFrequency.errors }"
                                                class="form-control" formControlName="commissionFrequency"
                                                id="commissionFrequency" name="commissionFrequency">
                                            <option [ngValue]="null" hidden>Select Commission Frequency</option>
                                            <option value="MONTH">Per Month</option>
                                            <option value="QUATER">Per Quarter</option>
                                            <option value="ANNUM">Per Annum</option>
                                        </select>
                                        <div *ngIf="(submitted) && formControls.commissionFrequency.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.commissionFrequency.errors.required">Commission Frequency is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div *ngIf="isFixedDeposit" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="couponRate"><strong>Coupon Rate</strong></label>
                                        <input
                                                class="form-control" formControlName="couponRate"
                                                id="couponRate" name="couponRate" placeholder="Coupon Rate"
                                                type="number">
                                        <!--                    <div *ngIf="(submitted) && formControls.couponRate.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.couponRate.errors.required">Coupon Rate is required</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>
                                <div *ngIf="isFixedDeposit" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="premiumOnCouponRate"><strong>Premium On Coupon
                                            Rate</strong></label>
                                        <input
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.premiumOnCouponRate.errors }"
                                                class="form-control" formControlName="premiumOnCouponRate"
                                                id="premiumOnCouponRate" name="premiumOnCouponRate"
                                                placeholder="Premium On Coupon Rate"
                                                type="number">
                                        <div *ngIf="(submitted) && formControls.premiumOnCouponRate.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.premiumOnCouponRate.errors.required">Premium On Coupon Rate is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4"
                                        *ngIf="((isFundable && (isTerminating || isRevolving)) || isFixedDeposit || isVehicle || isShare || isGeneral) && loanType !== 'NEW_LOAN' ">
                                    <div class="form-group">
                                        <label class="title" for="existInterestRate"> <strong> Existing Interest Rate(%)</strong></label>
                                        <input
                                                class="form-control" formControlName="existInterestRate"
                                                id="existInterestRate" name="existInterestRate" placeholder="Existing Interest Rate(%)"
                                                [(ngModel)]="existInterestLimit"
                                                type="number" appDecimalNumber
                                                >
                                    </div>

                                </div>
                                <div class="col-md-4"
                                     *ngIf="(isFundable && (isTerminating || isRevolving)) || isFixedDeposit || isVehicle || isShare || isGeneral">
                                    <div class="form-group">
                                        <label class="title" for="interestRate"><strong>Interest
                                            Rate(%)</strong></label>
                                        <input
                                                class="form-control" formControlName="interestRate"
                                                id="interestRate" name="interestRate" placeholder="Interest Rate(%)"
                                                [(ngModel)]="interestLimit"
                                                type="number" (input)="checkRepaymentMode(); checkCustomRepaymentMode()" appDecimalNumber
                                                >
                                        <!--                    <div *ngIf="(submitted) && formControls.interestRate.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.interestRate.errors.required">Interest Rate is required</span>-->
                                        <!--                      <span *ngIf="formControls.interestRate.errors.min">Interest Rate must be positive numerical value.</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral">
                                    <div class="form-group">
                                        <label class="title" for="baseRate"><strong>Base Rate(%)</strong></label>
                                        <input
                                                class="form-control" formControlName="baseRate" id="baseRate"
                                                name="baseRate" placeholder="Base Rate(%)"
                                                type="number" appDecimalNumber>
                                        <!--                    <div *ngIf="(submitted) && formControls.baseRate.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span-->
                                        <!--                          *ngIf="formControls.baseRate.errors.required">Base Rate is required</span>-->

                                        <!--                      <span *ngIf="formControls.baseRate.errors.min">Base Rate must be positive numerical value.</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral">
                                    <div class="form-group">
                                        <label class="title" for="premiumRateOnBaseRate"><strong>Premium Rate On Base
                                            Rate(%)</strong></label>
                                        <input
                                                class="form-control"
                                                class="form-control" formControlName="premiumRateOnBaseRate"
                                                id="premiumRateOnBaseRate" name="premiumRate"
                                                placeholder="Base Rate(%)" placeholder="Premium Rate On Base Rate(%)"
                                                type="number" readonly>
                                        <!--                    <div *ngIf="(submitted) && formControls.premiumRateOnBaseRate.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.premiumRateOnBaseRate.errors.required">Premium Rate On Base Rate is required</span>-->

                                        <!--                      <span *ngIf="formControls.premiumRateOnBaseRate.errors.min">Premium Rate On Base Rate must be positive numerical value.</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral">
                                    <div class="form-group">
                                        <label class="title" for="serviceCharge"><strong>Service Charge </strong>
                                            <input
                                                    formControlName="serviceChargeMethod"
                                                    name="serviceChargeMethod" type="radio"
                                                    value="PERCENT"><strong>% </strong>
                                            <input formControlName="serviceChargeMethod" name="serviceChargeMethod"
                                                   type="radio" value="FLAT"><strong> Flat</strong>
                                            <!--                      <small-->
                                            <!--                          *ngIf="(submitted) && formControls.serviceChargeMethod.invalid && formControls.serviceChargeMethod.errors.required"-->
                                            <!--                          style="color:#DC3545">-->
                                            <!--                        Charge method is required-->
                                            <!--                      </small>-->
                                        </label>
                                        <input
                                                class="form-control" formControlName="serviceCharge"
                                                id="serviceCharge"
                                                name="serviceCharge" placeholder="Service charge"
                                                type="number" appDecimalNumber>
                                        <!--                    <div *ngIf="(submitted) && formControls.serviceCharge.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.serviceCharge.errors.required">Service Charge is required</span>-->

                                        <!--                      <span *ngIf="formControls.serviceCharge.errors.min">Service Charge must be positive numerical value.</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral">
                                    <div class="form-group">
                                        <label class="title" for="tenureDurationInMonths"><strong>Tenure Duration in
                                            Month.</strong></label>
                                        <input
                                                class="form-control"
                                                formControlName="tenureDurationInMonths" id="tenureDurationInMonths"
                                                placeholder="Tenure Duration in Months"
                                                type="number" (input)="checkRepaymentMode();checkCustomRepaymentMode()" appDecimalNumber>

                                        <!--                                        <input [nbDatepicker]="tenurePicker"-->
                                        <!--                                               [ngClass]="{ 'is-invalid':submitted &&formControls.tenureDurationInMonths.errors}"-->
                                        <!--                                               class="form-control rounded"-->
                                        <!--                                               formControlName="tenureDurationInMonths"-->
                                        <!--                                               id="tenureDurationInMonths" placeholder="Enter the date"-->
                                        <!--                                               type="text"/>-->
                                        <!--                                        <nb-datepicker #tenurePicker></nb-datepicker>-->

                                        <!--                    <div *ngIf="(submitted) && formControls.tenureDurationInMonths.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.tenureDurationInMonths.errors.required ">Tenure duration is required.</span>-->
                                        <!--                      <span *ngIf="formControls.tenureDurationInMonths.errors.min ">Tenure duration must be positive numerical value.</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>

                                <!--                                start of repayment mode-->
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted &&  isFundable &&  isTerminating) || isVehicle || isShare || isGeneral">
                                    <div class="form-group">
                                        <label class="title" for="repaymentMode" ><strong>Repayment Mode</strong></label>
                                        <select
                                                class="custom-select" formControlName="repaymentMode"
                                                id="repaymentMode"
                                                name="repaymentMode"
                                                (change)="checkInstallmentAmount()">
                                            <option [ngValue]="null" hidden selected>Select</option>
                                            <option value="EMI">EMI</option>
                                            <option value="EQI">EQI</option>
                                            <option value="AT MATURITY">At Maturity</option>
                                            <option value="CUSTOM">Custom</option>
                                        </select>
                                        <!--                    <div *ngIf="(submitted) && formControls.repaymentMode.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.repaymentMode.errors.required">Repayment mode is required</span>-->
                                        <!--                    </div>-->
                                    </div>
                                </div>
                                <div  *ngIf="showRepaymentMode" class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="repaymentModeInterest"><strong>Interest Payment</strong></label>
                                        <select
                                            #interestRepayment
                                            [ngClass]="{ 'is-invalid': (submitted) && formControls.repaymentModeInterest.errors }"
                                            class="custom-select" formControlName="repaymentModeInterest"
                                            id="repaymentModeInterest"
                                            name="repaymentModeInterest"
                                            (change)="calculateRepaymentModeAmounts(interestRepayment.value , 'INTEREST')">
                                            <option [ngValue]="null" hidden selected>Select</option>
                                            <option value="MONTHLY">Monthly</option>
                                            <option value="QUARTERLY">Quarterly</option>
                                            <option value="SEMI-ANNUALLY">Semi-Annually</option>
                                        </select>

                                        <div *ngIf="(submitted) && formControls.repaymentModeInterest.invalid"
                                             class="invalid-feedback">
                                        <span *ngIf="formControls.repaymentModeInterest.errors.required">
                                            Repayment Frequency is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div  class="col-md-4" *ngIf="showRepaymentMode">
                                    <div class="form-group">
                                        <label class="title" for="repaymentModePrincipal"><strong>Principal Payment</strong></label>
                                        <select
                                            #repaymentModePrincipal
                                            [ngClass]="{ 'is-invalid': (submitted) && formControls.repaymentModePrincipal.errors }"
                                            class="custom-select" formControlName="repaymentModePrincipal"
                                            id="repaymentModePrincipal"
                                            name="repaymentModePrincipal"
                                            (change)="calculateRepaymentModeAmounts(repaymentModePrincipal.value , 'PRINCIPAL')">
                                            <option [ngValue]="null" hidden selected>Select</option>
                                            <option value="MONTHLY">Monthly</option>
                                            <option value="QUARTERLY">Quarterly</option>
                                            <option value="SEMI-ANNUALLY">Semi-Annually</option>
                                            <option value="AT MATURITY" *ngIf="client === clientName?.ICFC">AT Maturity</option>
                                        </select>
                                        <div *ngIf="(submitted) && formControls.repaymentModePrincipal.invalid"
                                             class="invalid-feedback">
                                        <span *ngIf="formControls.repaymentModePrincipal.errors.required">
                                            Repayment Frequency is required</span>
                                        </div>
                                    </div>
                                </div>
                                <!--                                end of repayment mode-->

                                <!--                start of installment amount div-->
                                <div class="col-md-4"
                                     *ngIf="showInstallmentAmount  && ((loanNatureSelected && fundableNonFundableSelcted && isTerminating  && isFundable) || ( isVehicle || isShare || isGeneral))">
                                    <div class="form-group>">
                                        <label class="title"> <strong>Installment Amount</strong></label>
                                        <input
                                                class="form-control" formControlName="installmentAmount"
                                                id="installmentAmount"
                                                name="installmentAmount" placeholder="Installment Amount"
                                                type="number" readonly>
                                    </div>
                                </div>
                                <!--                end of ng s
                                installment amount div-->
                                    <div class="col-md-4"
                                         *ngIf="((this.proposalForm.get('repaymentMode').value != null) && (!showInstallmentAmount || showRepaymentMode) &&
                                           ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral)))
                                           && (showInterestAmount || client !== clientName?.ICFC)">
                                        <div class="form-group>">
                                            <label class="title"> <strong>Interest Amount<em class="sb-medium">(in year)</em></strong></label>
                                            <input
                                                    class="form-control" formControlName="interestAmount"
                                                    id="interestAmount"
                                                    name="interestAmount" placeholder="Interest Amount" disabled
                                                    type="number">
                                        </div>
                                    </div>
                                    <div class="col-md-4"
                                         *ngIf="((this.proposalForm.get('repaymentMode').value != null) && (!showInstallmentAmount || showRepaymentMode) &&
                                           ((loanNatureSelected && isFundable && fundableNonFundableSelcted && isTerminating) || (isVehicle || isShare || isGeneral)))
                                           && (showInterestAmount || client !== clientName?.ICFC)">
                                        <div class="form-group>">
                                            <label class="title"> <strong>Principal Amount<em class="sb-medium">(in year)</em></strong></label>
                                            <input
                                                    class="form-control" formControlName="principalAmount"
                                                    id="principalAmount"
                                                    name="principalAmount" placeholder="Principle Amount" disabled
                                                    type="number">
                                        </div>
                                    </div>

                                <!--                start of Moratorium period amount div-->
                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isGeneral">
                                    <div class="form-group>">
                                        <label class="title"> <strong>Moratorium Period (Month)</strong></label>
                                        <input
                                                class="form-control" formControlName="moratoriumPeriod"
                                                id="moratoriumPeriod"
                                                name="moratoriumPeriod" placeholder="Example: 4 month"
                                                type="number" appDecimalNumber>
                                    </div>
                                </div>
                                <!--                end of Moratorium Period amount div-->

                                <div class="col-md-4"
                                     *ngIf="(client !== clientName?.SHINE_RESUNGA) && ((loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral)">
                                    <div class="form-group">
                                        <label class="title" for="commitmentFee"><strong>Commitment Fee (in%)</strong></label>
                                        <input
                                                class="form-control"
                                                formControlName="commitmentFee" id="commitmentFee"
                                                name="commitmentFee"
                                                placeholder="Commitment Fee" type="number" appDecimalNumber/>
                                        <!--                    <div *ngIf="(submitted) && formControls.commitmentFee.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.commitmentFee.errors.required">Commitment Fee is required.</span>-->
                                        <!--                    </div>-->

                                    </div>
                                </div>

                                <div class="col-md-4"
                                     *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isRevolving) ">
                                    <div class="form-group">
                                        <label class="title" for="tenorOfEachDeal"><strong>Tenure of each deal</strong></label>
                                        <input
                                                class="form-control"
                                                formControlName="tenorOfEachDeal" id="tenorOfEachDeal"
                                                name="tenorOfEachDeal"
                                                placeholder="Tenure of each deal" type="text"/>
                                        <!--                    <div *ngIf="(submitted) && formControls.tenorOfEachDeal.invalid"-->
                                        <!--                         class="invalid-feedback">-->
                                        <!--                      <span *ngIf="formControls.tenorOfEachDeal.errors.required">Tenor of each deal</span>-->
                                        <!--                    </div>-->

                                    </div>
                                </div>

                                <!--                start of Prepayment charge  div-->
                                <div class="col-md-4"
                                     *ngIf="(client !== clientName?.SHINE_RESUNGA) && ((loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral)">
                                    <div class="form-group>">
                                        <label class="title"> <strong>Prepayment Charge (in%) </strong></label>
                                        <input
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.prepaymentCharge.errors }"
                                                class="form-control" formControlName="prepaymentCharge"
                                                id="prepaymentCharge" name="prepaymentCharge"
                                                placeholder="Prepayment Charge" appDecimalNumber>
                                        <div *ngIf="(submitted) && formControls.prepaymentCharge.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formControls.prepaymentCharge.errors.required">
                                                Prepayment Charge is required
                                            </div>
                                            <div *ngIf="formControls.prepaymentCharge.errors.min || formControls.prepaymentCharge.errors.max">
                                                Enter 0 - 100 number only
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="title" for="collateralRequirement"><strong>Collateral requirement
                                            (in%)</strong></label>
                                        <input
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.collateralRequirement.errors }"
                                                class="form-control"
                                                formControlName="collateralRequirement" id="collateralRequirement"
                                                name="collateralRequirement"
                                                placeholder="Collateral requirement" type="number" appDecimalNumber/>
                                        <div *ngIf="(submitted) && formControls.collateralRequirement.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.collateralRequirement.errors.required">Collateral requirement is required.</span>
                                        </div>

                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="title"><strong>Limit Expiry/Loan Tenure </strong><br>
                                            <div class="pt-3">
                                                <input
                                                        [ngClass]="{ 'is-untouched': (submitted) && formControls.limitExpiryMethod.errors }"
                                                        formControlName="limitExpiryMethod"
                                                        name="limitExpiryMethod" type="radio"
                                                        value="ABSOLUTE"><strong>Absolute </strong>
                                                <input formControlName="limitExpiryMethod" name="limitExpiryMethod"
                                                       type="radio" value="CUSTOM"><strong> Custom</strong>
                                                <small
                                                        *ngIf="(submitted) && formControls.limitExpiryMethod.invalid && formControls.limitExpiryMethod.errors.required"
                                                        style="color:#DC3545">
                                                    Limit Expiry Method is required
                                                </small>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4" *ngIf="absoluteSelected">
                                    <div class="form-group">
                                        <label class="title" for="dateOfExpiry"><strong>Date of Expiry</strong></label>
                                        <input [nbDatepicker]="DOE"
                                               [ngClass]="{ 'is-invalid': (submitted) && formControls.dateOfExpiry.errors }"
                                               class="form-control" formControlName="dateOfExpiry" id="dateOfExpiry"
                                               name="dateOfExpiry" placeholder="Date of Expiry">
                                        <nb-datepicker #DOE></nb-datepicker>
                                        <div *ngIf="(submitted) && formControls.dateOfExpiry.invalid"
                                             class="invalid-feedback">
                      <span
                              *ngIf="formControls.dateOfExpiry.errors.required">Date of Expiry is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4" *ngIf="customSelected">
                                    <div class="form-group">
                                        <label class="title" for="duration"><strong>Duration</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && formControls.duration.errors }"
                                               class="form-control" formControlName="duration" id="duration"
                                               name="duration" placeholder="Duration"
                                               type="number">
                                        <div *ngIf="(submitted) && formControls.duration.invalid"
                                             class="invalid-feedback">
                      <span
                              *ngIf="formControls.duration.errors.required">Duration is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4" *ngIf="customSelected">
                                    <div class="form-group">
                                        <label class="title" for="frequency"><strong>Frequency</strong></label>
                                        <select
                                                [ngClass]="{ 'is-invalid': (submitted ) && formControls.frequency.errors }"
                                                class="custom-select" formControlName="frequency"
                                                id="frequency"
                                                name="frequency">
                                            <option [ngValue]="undefined" hidden selected>Select</option>
                                            <option value="DAY">Day(s)</option>
                                            <option value="MONTH">Month(s)</option>
                                            <option value="QUATER">Quarter(s)</option>
                                            <option value="YEAR">Year(s)</option>
                                        </select>
                                        <div *ngIf="(submitted) && formControls.frequency.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.frequency.errors.required">Frequency is required</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4" *ngIf="customSelected">
                                    <div class="form-group">
                                        <label class="title" for="condition"><strong>Condition</strong></label>
                                        <select
                                                [ngClass]="{ 'is-invalid': (submitted ) && formControls.condition.errors }"
                                                class="custom-select" formControlName="condition"
                                                id="condition"
                                                name="condition">
                                            <option [ngValue]="undefined" hidden selected>Select</option>
                                            <option value="FROM THE DATE OF APPROVAL">From the date of approval</option>
                                            <option value="FROM THE DATE OF INITIATION OF LOAN">From the date of
                                                initiation of loan
                                            </option>
                                            <option value="FROM EACH DEAL">From each deal</option>
                                            <option value="FROM THE DATE OF IMPLEMENTATION">From the date of implementation</option>
                                        </select>
                                        <div *ngIf="(submitted) && formControls.condition.invalid"
                                             class="invalid-feedback">
                                            <span *ngIf="formControls.condition.errors.required">Condition is required</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4 form-group" *ngIf="(client !== clientName?.MEGA) && (client !== clientName?.SHINE_RESUNGA)">
                                    <nb-checkbox (change)="checkChecked($event.target.checked,'swapCharge')"
                                                 [checked]="swapChargeChecked"><b>Swap Charge<em class="sb-medium">(if any)</em></b>
                                    </nb-checkbox>
                                    <div *ngIf="swapChargeChecked">
                                            <input
                                                    formControlName="swapChargeMethod"
                                                    name="swapChargeMethod" type="radio"
                                                    value="PERCENT"><strong> % </strong>
                                            <input formControlName="swapChargeMethod" name="swapChargeMethod"
                                                   type="radio" value="FLAT"><strong> Flat</strong>
                                            <input  [ngClass]="{ 'is-invalid': (submitted) && formControls.swapCharge.errors }"
                                                    class="form-control" formControlName="swapCharge"
                                                    id="swapCharge"
                                                    name="swapCharge" placeholder="Swap Charge"
                                                    type="number" appDecimalNumber/>
                                    </div>
                                </div>

                                <div *ngIf="client !== clientName?.MEGA">
                                    <nb-checkbox class="ml-3" (change)="checkChecked($event.target.checked,'subsidizedLoan')"
                                                 [checked]="subsidizedLoanChecked"><b>Subsidized Loan<em class="sb-medium">(if any)</em></b>
                                    </nb-checkbox>
                                    <div class="row ml-2">
                                        <div class="col-md-4 form-group">
                                            <div *ngIf="subsidizedLoanChecked">
                                                <label for="subsidizedLoan"><strong>Subsidy Rate(%)</strong></label>
                                                <input  [ngClass]="{ 'is-invalid': (submitted) && formControls.subsidizedLoan.errors }"
                                                        class="form-control" formControlName="subsidizedLoan"
                                                        id="subsidizedLoan"
                                                        name="subsidizedLoan" placeholder="Discount Rate"
                                                        type="number" appDecimalNumber/>
                                            </div>
                                        </div>
                                        <div class="col-md-4 form-group">
                                            <div *ngIf="subsidizedLoanChecked">
                                                <label for="subsidyLoanType"><strong>Subsidy Loan Type</strong></label>
                                                <nb-select formControlName="subsidyLoanType" id="subsidyLoanType"
                                                      placeholder="Select Loan Type" fullWidth (selectedChange)="onChange()">
                                                    <nb-option *ngFor="let type of subsidyLoanType" [value]="type?.value">
                                                        {{type?.value}}
                                                    </nb-option>
                                                </nb-select>
                                            </div>
                                        </div>
                                        <div *ngIf="othersSubsidyLoan" class="col-md-4 form-group">
                                            <label for="others"><strong>Others</strong></label>
                                            <input class="form-control" formControlName="others"
                                                   id="others" placeholder="Others">
                                        </div>
                                    </div>

                                </div>


                                <!--                end of Moratorium Period amount div-->
                                <div class="col-md-12 form-group" *ngIf="client !== clientName?.MEGA">
                                    <label class="title" for="prepaymentSwapCommitment"
                                           *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && isTerminating) || isVehicle || isShare || isGeneral; else commitmentDescription">
                                        <strong>Prepayment/Commitment/Swap Charge Description</strong>
                                    </label>
                                    <ng-template #commitmentDescription>
                                        <label *ngIf="(loanNatureSelected && fundableNonFundableSelcted && isFundable && (isTerminating || isRevolving)) || isVehicle || isShare || isGeneral; else swapChargeDescription">
                                            <strong>Commitment/Swap Charge Description</strong>
                                        </label>
                                    </ng-template>
                                    <ng-template #swapChargeDescription>
                                        <label class="title" for="prepaymentSwapCommitment"><strong>Swap Charge Description</strong></label>
                                    </ng-template>
                                    <ckeditor [ngClass]="{ 'is-invalid': (submitted) && formControls.prepaymentSwapCommitment.errors}"
                                              formControlName="prepaymentSwapCommitment" id="prepaymentSwapCommitment"
                                              name="prepaymentSwapCommitment"
                                              [config]="ckeConfig"></ckeditor>
                                    <div *ngIf="(submitted) && formControls.prepaymentSwapCommitment.invalid"
                                         class="text-danger">
                                        <span *ngIf="formControls.prepaymentSwapCommitment.errors">Prepayment/Commitment/Swap Charge Description</span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="form-group" style="max-height: 300px !important;height: 250px;">
                                        <strong>{{client === clientName?.MEGA ? 'Justification of limit' : 'Loan background' }}</strong>
                                        <ckeditor formControlName="borrowerInformation"
                                                  [style]="{height:'250px !important;'}"
                                                  placeholder="Background"
                                                  required
                                                  [config]="ckeConfig"
                                                  [ngClass]="{'is-invalid': formControls.borrowerInformation.invalid && submitted}">
                                        </ckeditor>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="col-md-12" style="padding-top: 70px;">
                                    <div *ngIf="submitted">
                                        <span *ngIf="formControls.borrowerInformation.invalid" class="text-danger">
                                            <sup>*</sup> {{client === clientName?.MEGA ? 'Justification of limit is required!' : 'Loan background Information is required.' }}
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-12" *ngIf="client != clientName.MEGA">
                                    <div class="form-group">
                                        <label class="title"><b>Purpose of Loan</b></label>
                                        <ckeditor formControlName="purposeOfLoan" [config]="ckeConfig"></ckeditor>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="title" for="disbursementCriteria"><strong>Disbursement Criteria</strong></label>
                                        <ckeditor
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.disbursementCriteria.errors }"
                                                formControlName="disbursementCriteria" id="disbursementCriteria"
                                                name="disbursementCriteria"
                                                [config]="ckeConfig"></ckeditor>
                                        <div *ngIf="(submitted) && formControls.disbursementCriteria.invalid"
                                             class="text-danger">
                                            <span *ngIf="formControls.disbursementCriteria.errors.required">Disbursement Criteria is required.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="title" for="repayment"><strong>Repayment</strong></label>
                                        <ckeditor
                                                [ngClass]="{ 'is-invalid': (submitted) && formControls.repayment.errors }"
                                                formControlName="repayment" id="repayment"
                                                name="repayment"
                                                [config]="ckeConfig"></ckeditor>
                                        <div *ngIf="(submitted) && formControls.repayment.invalid"
                                             class="text-danger">
                                            <span *ngIf="formControls.repayment.errors.required">Repayment is required.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="title" for="remark">
                                            <strong>{{client === clientName?.SHINE_RESUNGA ? 'Account Strategy' : 'Remarks'}}</strong></label>
                                        <ckeditor
                                                formControlName="remark" id="remark"
                                                [config]="ckeConfig"></ckeditor>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="title"><strong>Terms And Condition</strong></label>
                                        <ckeditor formControlName="termsAndCondition"
                                                  [style]="{height:'250px !important;'}"
                                                  placeholder="Terms & Condition"
                                                  [config]="ckeConfig">
                                        </ckeditor>
                                    </div>
                                </div>

                                <div class="col-md-12 mt-3">
                                    <div class="form-group">
                                        <label class="title"><strong>Summary & Recommendation</strong></label>
                                        <ckeditor formControlName="summeryRecommendation"
                                                  [style]="{height:'250px !important;'}"
                                                  placeholder="Summary & Recommendation"
                                                  [config]="ckeConfig">
                                        </ckeditor>
                                    </div>
                                </div>

                                <div class="col-md-12 mt-3" *ngIf="client === clientName?.SHINE_RESUNGA">
                                    <div class="form-group">
                                        <label><strong>Proposal Remark</strong></label>
                                        <ckeditor formControlName="proposalRemark"
                                                  [style]="{height:'250px !important;'}"
                                                  placeholder="Proposal Remark"
                                                  [config]="ckeConfig">></ckeditor>
                                    </div>
                                </div>

                                <div class="col-md-12 form-group">
                                    <h6><strong>Additional Description</strong></h6>
                                    <nb-checkbox (change)="checkChecked($event.target.checked,'waiver')"
                                                 [checked]="waiverChecked">
                                        <b>Waiver/Deviation</b>
                                    </nb-checkbox>
                                    <div *ngIf="waiverChecked">
                                        <ckeditor formControlName="waiverConclusionRecommendation"
                                                  [config]="ckeConfig"></ckeditor>
                                    </div>

                                </div>
                                <div class="col-md-12 form-group">
                                    <nb-checkbox (change)="checkChecked($event.target.checked,'sol')"
                                                 [checked]="solChecked"><b>Single Obligor Limit</b>
                                    </nb-checkbox>
                                    <div *ngIf="solChecked">
                                        <div *ngIf="client === clientName?.SHINE_RESUNGA">
                                            <table
                                                    class="table table-bordered table-responsive table-hover" style="overflow-x: hidden">
                                                <thead class="font-weight-bold">
                                                <tr>
                                                    <th>S.N</th>
                                                    <th>Client's Name</th>
                                                    <th>Facility Type</th>
                                                    <th>Loan Limit(NPR)</th>
                                                    <th>O/S Limit (NPR)</th>
                                                    <th>Proposed Limit(NPR)</th>
                                                    <th>FMV/DV</th>
                                                    <th>Exposure(%)</th>
                                                    <th>Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody *ngFor="let data of proposalForm.get('groupExposure')['controls']; let index = index" formArrayName="groupExposure">
                                                <tr [formGroupName]="index">
                                                    <td>{{index + 1}}</td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="clientName"
                                                               placeholder="Client's Name"
                                                               type="text"/></td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="facilityType"
                                                               placeholder="Facility Type"
                                                               type="text"/></td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="loanLimit"
                                                               placeholder="Loan Limit(NPR)"
                                                               type="number"/></td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="osLimit"
                                                               placeholder="O/S Limit(NPR)"
                                                               type="number"/></td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="proposedLimit"
                                                               placeholder="Proposed Limit(NPR)"
                                                               type="number"/></td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="fmvDv"
                                                               placeholder="FMV/DV"
                                                               type="number"/></td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="exposure"
                                                               placeholder="Exposure(%)"
                                                               type="text"/></td>
                                                    <td><input class="form-control text-center"
                                                               formControlName="remarks"
                                                               placeholder="Remarks"
                                                               type="text"/></td>
                                                    <div>
                                                        <button (click)="removeGroupExposureData(index)"
                                                                *ngIf="index > 0"
                                                                class="btn btn-success" nbButton size="small"
                                                                status="primary">Delete </button>
                                                    </div>
                                                </tr>
                                                </tbody>
                                            </table>
                                            <div class="text-right">
                                                <input (click)="addGroupExposureData()" class="btn btn-sm btn-flat btn-primary"
                                                       type="button" value="Add More"/>
                                            </div>
                                        </div>
                                        <ckeditor formControlName="solConclusionRecommendation"
                                                  [config]="ckeConfig"></ckeditor>
                                    </div>
                                </div>
                                <div class="col-md-12 form-group">

                                    <nb-checkbox (change)="checkChecked($event.target.checked,'risk')"
                                                 [checked]="riskChecked"><b>Risk &
                                        Mitigation</b>
                                    </nb-checkbox>
                                    <div *ngIf="riskChecked">
                                        <ckeditor formControlName="riskConclusionRecommendation"
                                                  [config]="ckeConfig"></ckeditor>
                                    </div>
                                </div>
                            </div>

                        </form>
                    </div>
                </nb-card-body>
            </nb-card>
        </div>
    </div>
</div>
