<form [formGroup]="financialForm" class="form-horizontal mb-2">
    <div *ngIf="!isBusinessLoan">
        <nb-card>
            <nb-card-header>
                <h3><strong>Income of Borrower</strong></h3>
            </nb-card-header>
            <nb-card-body>
                <div *ngFor="let incomeOfBorrower of financialForm.get('incomeOfBorrower')['controls']; let incomeIndex = index"
                     class="border-bottom border-dark m-4"
                     formArrayName="incomeOfBorrower">
                    <div [formGroupName]="incomeIndex">
                        <!-- START ROW -->
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="title"><strong>Income Source</strong></label><strong
                                        class="text-danger">*</strong>
                                    <input [ngClass]="{
                               'is-invalid': incomeOfBorrower.get('incomeSource').invalid && (incomeOfBorrower.get('incomeSource').dirty || incomeOfBorrower.get('incomeSource').touched),
                                'is-valid': !incomeOfBorrower.get('incomeSource').invalid && (incomeOfBorrower.get('incomeSource').dirty || incomeOfBorrower.get('incomeSource').touched)
                                }"
                                           class="form-control" formControlName="incomeSource"
                                           placeholder="Income source" type="text">
                                    <span *ngIf="incomeOfBorrower.get('incomeSource').invalid"
                                          class="invalid-feedback">Income source required</span>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="title"><strong>Organization</strong></label><strong
                                        class="text-danger">*</strong>
                                    <input [ngClass]="{
                               'is-invalid': incomeOfBorrower.get('organization').invalid && (incomeOfBorrower.get('organization').dirty || incomeOfBorrower.get('organization').touched),
                                'is-valid': !incomeOfBorrower.get('organization').invalid && (incomeOfBorrower.get('organization').dirty || incomeOfBorrower.get('organization').touched)
                                }" class="form-control"
                                           formControlName="organization" placeholder="Organization"
                                           type="text">
                                    <span *ngIf="incomeOfBorrower.get('organization').invalid"
                                          class="invalid-feedback">Organization required</span>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="title"><strong>Amount</strong></label><strong
                                        class="text-danger">*</strong>
                                    <input (input)="totalAdditionInitialForm('incomeOfBorrower', 'totalIncome')"
                                           [ngClass]="{
                               'is-invalid': incomeOfBorrower.get('amount').invalid && (incomeOfBorrower.get('amount').dirty || incomeOfBorrower.get('amount').touched),
                                'is-valid': !incomeOfBorrower.get('amount').invalid && (incomeOfBorrower.get('amount').dirty || incomeOfBorrower.get('amount').touched)
                                }" class="form-control"
                                           formControlName="amount" placeholder="Amount"
                                           type="number">
                                    <span *ngIf="incomeOfBorrower.get('amount').invalid" class="invalid-feedback">Amount required</span>
                                </div>
                            </div>

                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="title"><strong>Remarks</strong></label><strong
                                        class="text-danger">*</strong>
                                    <input [ngClass]="{
                               'is-invalid': incomeOfBorrower.get('remarks').invalid && (incomeOfBorrower.get('remarks').dirty || incomeOfBorrower.get('remarks').touched),
                                'is-valid': !incomeOfBorrower.get('remarks').invalid && (incomeOfBorrower.get('remarks').dirty || incomeOfBorrower.get('remarks').touched)
                                }" class="form-control"
                                           formControlName="remarks" placeholder="Remarks"
                                           type="text">
                                    <span *ngIf="incomeOfBorrower.get('remarks').invalid" class="invalid-feedback">Remarks required</span>
                                </div>
                            </div>

                            <div class="col-md-1 ml-0 pl-0 mt-4">
                                <button (click)="removeIncomeIndex(incomeIndex)"
                                        *ngIf="financialForm.get('incomeOfBorrower')['controls'].length > 1"
                                        class="btn btn-sm btn-flat btn-danger" value="Delete">
                                    <em class="fa fa-trash" style="color:white;"></em>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 pl-5">
                        <label class="title"><strong>Total Income :
                            Rs.{{financialForm.get('totalIncome').value | currencyFormatter}}</strong></label>
                    </div>
                    <div class="col-md-6 text-right">
                        <input (click)="addIncomeOfBorrower()" class="btn btn-sm btn-flat btn-primary"
                               type="button" value="Add Field"/>
                    </div>
                </div>
            </nb-card-body>
        </nb-card>

        <nb-card>
            <nb-card-header>
                <h3><strong>Expenses of Borrower</strong></h3>
            </nb-card-header>
            <nb-card-body>
                <div *ngFor="let expensesOfBorrower of financialForm.get('expensesOfBorrower')['controls']; let expenseIndex = index"
                     class="border-bottom border-dark m-4"
                     formArrayName="expensesOfBorrower">
                    <div [formGroupName]="expenseIndex">

                        <!-- START ROW -->
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="title"><strong>Particulars</strong><strong
                                            class="text-danger">*</strong></label>
                                    <input [ngClass]="{
                               'is-invalid': expensesOfBorrower.get('particulars').invalid && (expensesOfBorrower.get('particulars').dirty || expensesOfBorrower.get('particulars').touched),
                                'is-valid': !expensesOfBorrower.get('particulars').invalid && (expensesOfBorrower.get('particulars').dirty || expensesOfBorrower.get('particulars').touched)
                                }" class="form-control"
                                           formControlName="particulars" placeholder="Particulars"
                                           type="text">
                                    <span *ngIf="expensesOfBorrower.get('particulars').invalid"
                                          class="invalid-feedback">Particulars required</span>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="title"><strong>Amount</strong><strong
                                            class="text-danger">*</strong></label>
                                    <input (input)="totalAdditionInitialForm('expensesOfBorrower', 'totalExpense')"
                                           [ngClass]="{
                               'is-invalid': expensesOfBorrower.get('amount').invalid && (expensesOfBorrower.get('amount').dirty || expensesOfBorrower.get('amount').touched),
                                'is-valid': !expensesOfBorrower.get('amount').invalid && (expensesOfBorrower.get('amount').dirty || expensesOfBorrower.get('amount').touched)
                                }" class="form-control"
                                           formControlName="amount" placeholder="Amount"
                                           type="number">
                                    <span *ngIf="expensesOfBorrower.get('amount').invalid" class="invalid-feedback">Amount required</span>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="title"><strong>Remarks</strong><strong
                                            class="text-danger">*</strong></label>
                                    <input [ngClass]="{
                               'is-invalid': expensesOfBorrower.get('remarks').invalid && (expensesOfBorrower.get('remarks').dirty || expensesOfBorrower.get('remarks').touched),
                                'is-valid': !expensesOfBorrower.get('remarks').invalid && (expensesOfBorrower.get('remarks').dirty || expensesOfBorrower.get('remarks').touched)
                                }" class="form-control"
                                           formControlName="remarks" placeholder="Remarks"
                                           type="text">
                                    <span *ngIf="expensesOfBorrower.get('remarks').invalid"
                                          class="invalid-feedback">Remarks required</span>
                                </div>
                            </div>

                            <div class="col-md-1 ml-0 pl-0 mt-4">
                                <button (click)="removeExpensesIndex(expenseIndex)"
                                        *ngIf="financialForm.get('expensesOfBorrower')['controls'].length > 1"
                                        class="btn btn-sm btn-flat btn-danger" value="Delete">
                                    <em class="fa fa-trash" style="color:white;"></em>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 pl-5">
                        <label class="title"><strong>Total Expense :
                            Rs.{{financialForm.get('totalExpense').value | currencyFormatter}}</strong></label>
                    </div>
                    <div class="col-md-6 text-right">
                        <input (click)="addExpensesOfBorrower()" class="btn btn-sm btn-flat btn-primary"
                               type="button" value="Add Field"/>
                    </div>
                </div>

            </nb-card-body>
        </nb-card>
    </div>

</form>

<div *ngIf="isBusinessLoan">
    <hr>
    <div class="row my-2">
        <div class="col-md-12 text-right">
            <button (click)="openFiscalYearModal()" class="mb-2" nbButton>Add Fiscal year</button>
        </div>
    </div>

    <hr>

    <div *ngIf="auditorList.length > 0" class="row mb-4">
        <div class="col-md-12">
            <nb-card class="mark">
                <nb-card-body>
                    <h3 class="mb-2">Financial Auditor Detail Information</h3>
                    <table aria-describedby="auditor list table" class="table table-bordered table-hover">
                        <thead>
                        <tr>
                            <th scope="col">S.N</th>
                            <th scope="col">Audited</th>
                            <th scope="col">Audit Firm</th>
                            <th scope="col">Propriete/Partner</th>
                            <th scope="col">Membership No.</th>
                            <th scope="col">Certificate of Practice</th>
                            <th scope="col">Class</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let auditor of auditorList; let i = index">
                            <td><strong>{{i + 1}}</strong></td>
                            <td>{{auditor['audited']}}</td>
                            <td>{{auditor['auditFirm']}}</td>
                            <td>{{auditor['proprietePartner']}}</td>
                            <td>{{auditor['membershipNo']}}</td>
                            <td>{{auditor['certificateOfPractice']}}</td>
                            <td>{{auditor['class']}}</td>
                        </tr>
                        </tbody>
                    </table>
                </nb-card-body>
            </nb-card>
        </div>
    </div>

    <nb-tabset #currentTabSet (changeTab)="changeActiveTab(currentTabSet['tabs'])" class="mb-4" fullWidth>

        <nb-tab class="px-0" tabTitle="Income Statement">
            <app-income-statement #incomeStatement
                                  (removeFiscalYear)="removeFiscalYear($event)"
                                  *ngIf="activeTab === 'Income Statement'" [fiscalYear]="fiscalYear"
                                  [formData]="currentFormData">
            </app-income-statement>
        </nb-tab>

        <nb-tab class="px-0" tabTitle="Balance Sheet">
            <app-balance-sheet #balanceSheet
                               (removeFiscalYear)="removeFiscalYear($event)"
                               *ngIf="activeTab === 'Balance Sheet'"
                               [fiscalYear]="fiscalYear" [formData]="currentFormData">
            </app-balance-sheet>
        </nb-tab>

        <nb-tab class="px-0" tabTitle="Cash Flow Statement">
            <app-cash-flow-statement #cashFlowStatement
                                     (removeFiscalYear)="removeFiscalYear($event)"
                                     *ngIf="activeTab === 'Cash Flow Statement'"
                                     [fiscalYear]="fiscalYear" [formData]="currentFormData">
            </app-cash-flow-statement>
        </nb-tab>

        <nb-tab class="px-0" tabTitle="Key Indicators">
            <app-key-indicators #keyIndicators
                                (removeFiscalYear)="removeFiscalYear($event)"
                                *ngIf="activeTab === 'Key Indicators'"
                                [fiscalYear]="fiscalYear" [formData]="currentFormData">
            </app-key-indicators>
        </nb-tab>
    </nb-tabset>
</div>

<div *ngIf="fromProfile" class="py-4 d-flex justify-content-end">
    <button (click)="onSubmit()" nbButton type="button">save</button>
</div>
