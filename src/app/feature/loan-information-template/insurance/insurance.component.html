<nb-card>
    <nb-card-body>
        <form [formGroup]="form">
            <div formArrayName="formArray">
            <div *ngFor="let formArrays of form.get('formArray')['controls']; let i = index">
                <div [formGroupName]="i">
                    <div class="row">
                        <h4 class="col-md-10">{{i+1}}.Insurance</h4>
                        <div *ngIf="form.get('formArray')['length']>1" class="col-md-2">
                            <button (click)="removeForm(i)"
                                    class="float-right btn tbn-sm btn-flat btn-danger"
                                    value="Delete">
                                <em class="fa fa-trash" style="color: white;"></em></button>
                        </div>
                    </div><hr>

                    <div class="row">
                        <div class="col-md-4 form-group">
                            <label for="policyNumber"><strong>Policy Number</strong></label>
                            <input class="form-control" formControlName="policyNumber" id="policyNumber"
                                   placeholder="Policy Number" required
                                   type="text" [ngClass]="{'is-invalid': isSubmitted && formArrays.get('policyNumber').errors}">
                            <div *ngIf="isSubmitted && formArrays.get('policyNumber').invalid" class="invalid-feedback">
                                Policy Number is required!
                            </div>
                        </div>
                    </div>

            <div class="form-group">
                <label for="insuranceCompany"><strong>Insurance Company</strong></label>
                <select class="form-control" formControlName="company" id="insuranceCompany" [ngClass]="{'is-invalid': isSubmitted && formArrays.get('company').errors}">
                    <option [ngValue]="null" hidden>Select Insurance Company</option>
                    <option *ngFor="let insuranceCompany of insuranceCompanyList" [ngValue]="insuranceCompany.id">{{insuranceCompany.name}}</option>
                </select>
                <div *ngIf="isSubmitted && formArrays.get('company').invalid" class="invalid-feedback">
                    Insurance Company name is required!
                </div>
            </div>
            <div class="row">
                <div class="col form-group">
                    <label for="insuredAmount"><strong>Insured Amount</strong></label>
                    <input class="form-control" formControlName="insuredAmount" id="insuredAmount"
                           type="text" [ngClass]="{'is-invalid': isSubmitted && formArrays.get('insuredAmount').errors}">
                    <div *ngIf="isSubmitted && formArrays.get('insuredAmount').invalid" class="invalid-feedback">
                        Insured Amount is required!
                    </div>
                </div>
                <div class="col form-group">
                    <label for="premiumAmount"><strong>Premium Amount</strong></label>
                    <input class="form-control" formControlName="premiumAmount" id="premiumAmount"
                           type="text" [ngClass]="{'is-invalid': isSubmitted && formArrays.get('premiumAmount').errors}">
                    <div *ngIf="isSubmitted && formArrays.get('premiumAmount').invalid" class="invalid-feedback">
                        Premium Amount is required!
                    </div>
                </div>

                        <div class="col form-group">
                            <label for="issuedDate"><strong>Issued Date</strong></label>
                            <input [nbDatepicker]="issuedDate"
                                   class="form-control" formControlName="issuedDate"
                                   id="issuedDate" placeholder="03/04/2020"
                                   type="text" required [ngClass]="{'is-invalid': isSubmitted && formArrays.get('issuedDate').errors}">
                            <div *ngIf="isSubmitted && formArrays.get('issuedDate').invalid" class="invalid-feedback">
                                Issued Date is required!
                            </div>
                            <nb-datepicker #issuedDate></nb-datepicker>
                        </div>
                        <div class="col form-group">
                            <label for="expiryDate"><strong>Expiry Date</strong></label>
                            <input [nbDatepicker]="expiryDate"
                                   class="form-control"
                                   formControlName="expiryDate"
                                   id="expiryDate" placeholder="03/04/2021"
                                   required type="text" [ngClass]="{'is-invalid': isSubmitted && formArrays.get('expiryDate').errors}">
                            <div *ngIf="isSubmitted && formArrays.get('expiryDate').invalid" class="invalid-feedback">
                                Expiry Date is required!
                            </div>
                            <nb-datepicker #expiryDate [min]="returnIssuedDate(form.get(['formArray' ,i, 'issuedDate']))"></nb-datepicker>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="policyType"><strong>Insurance Policy Type</strong></label>
                        <textarea class="form-control" formControlName="policyType"
                                  id="policyType"
                                  rows="4">
                </textarea>
                    </div>

                </div>
            </div>
                <div class="float-right">
                    <button (click)="addEmptyForm()" class="btn btn-sm btn-flat btn-primary">Add More Insurance</button>
                </div>
            </div>
        </form>
    </nb-card-body>
    <nb-card-footer>
        <div *ngIf="fromProfile" class="py-4 d-flex justify-content-end">
            <button (click)="submit()" nbButton type="button">save</button>
        </div>
    </nb-card-footer>
</nb-card>
