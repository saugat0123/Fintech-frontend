<div class="col-md-12">
    <div class="d-flex justify-content-end">
        <nb-radio-group [(ngModel)]="calendarType" class="d-inline-flex"
                        name="guarantorCalendarType">
            <nb-radio value="AD">AD</nb-radio>
            <nb-radio value="BS">BS</nb-radio>
        </nb-radio-group>
    </div>
</div>
<nb-card>
    <nb-card-header><h1>Guarantors Details</h1></nb-card-header>
    <nb-card-body>
        <div class="form-group">
            <form [formGroup]="form" class="form-horizontal">
                <!--START ROW-->
                <div formArrayName="guarantorDetails">
                    <div
                        *ngFor="let guarantorDetails of form.get('guarantorDetails')['controls']; let i = index">
                        <div [formGroupName]="i">
                            <div class="row">
                                <div class="col-md-10">
                                    <h5>{{i + 1}}) Guarantor Information</h5>
                                </div>
                                <div *ngIf="form.get('guarantorDetails')['length']>1"
                                class="col-md-2 ">
                                <button (click)="removeGuarantorDetails(i)"
                                        class="float-right btn tbn-sm btn-flat btn-danger"
                                        value="Delete">
                                    <em class="fa fa-trash" style="color: white;"></em>

                                </button>

                            </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong> Name</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('name').errors }"
                                               class="form-control form-control-sm-error rounded"
                                               formControlName="name"
                                               id="name"
                                               name="name"
                                               placeholder="Name of Guarantor"
                                               type="text">
                                        <div *ngIf="(submitted) && guarantorDetails.get('name').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('name').errors.required">Name is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Province</strong></label>
                                        <select (change)="getDistrict(guarantorDetails.get('province').value,i)"
                                                [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('province').errors}"
                                                class="custom-select"
                                                formControlName="province"
                                                name="province">
                                            <option [value]="null" hidden>Select Province</option>
                                            <option *ngFor="let provinceVal of provinceList"
                                                    [ngValue]="provinceVal.id">
                                                {{provinceVal.name}}
                                        </select>
                                        <div *ngIf="(submitted) && guarantorDetails.get('province').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('province').errors.required">Province
                                                is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>District</strong></label>
                                        <select (change)="getMunicipalities(guarantorDetails.get('district').value, i)"
                                                [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('district').errors}"
                                                class="custom-select"
                                                formControlName="district"
                                                name="district">
                                            <option [value]="null" hidden>Select District</option>
                                            <option *ngFor="let districtVal of addressList[i].districtList"
                                                    [ngValue]="districtVal.id">
                                                {{districtVal.name}}</option>
                                        </select>
                                        <div *ngIf="(submitted) && guarantorDetails.get('district').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('district').errors.required">District
                                                is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Municipalities/VDC</strong></label>
                                        <select [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('municipalities').errors}"
                                                class="custom-select"
                                                formControlName="municipalities"
                                                name="municipalities">
                                            <option [value]="null" hidden>Select Municipalities/VDC</option>
                                            <option *ngFor="let municipalitiesVal of addressList[i].municipalityVdcList"
                                                    [ngValue]="municipalitiesVal.id">
                                                {{municipalitiesVal.name}}
                                        </select>
                                        <div *ngIf="(submitted) && guarantorDetails.get('municipalities').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('municipalities').errors.required">
                                                Municipality or VDC is required
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Citizenship Number</strong></label>
                                        <input (change)="checkBlackListByCitizenshipNo(guarantorDetails.get('citizenNumber').value, i)"
                                               [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('citizenNumber').errors }"
                                               class="form-control form-control-sm-error rounded"
                                               formControlName="citizenNumber"
                                               id="citizenNumber"
                                               name="citizenNumber"
                                               placeholder="Number"
                                               type="text">
                                        <div *ngIf="(submitted) && guarantorDetails.get('citizenNumber').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('citizenNumber').errors.required">
                                                Citizenship Number is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Citizenship Issued Date</strong></label>
                                        <input [nbDatepicker]="issuedYear"
                                               *ngIf="calendarType === 'AD'"
                                               [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('issuedYear').errors }"
                                               class="form-control form-control-sm-error rounded"
                                               formControlName="issuedYear"
                                               id="citizenIssuedYear"
                                               name="citizenIssuedYear"
                                               placeholder="Citizenship Issued Date"
                                               type="text">
                                        <app-calendar
                                            [ePreDate]="form.get(['guarantorDetails', i, 'issuedYear']).value"
                                            *ngIf="calendarType === 'BS'"
                                            (messageToEmit)="form.get(['guarantorDetails', i, 'issuedYear']).patchValue($event?.eDate)"></app-calendar>

                                        <nb-datepicker #issuedYear></nb-datepicker>
                                        <div *ngIf="(submitted) && guarantorDetails.get('issuedYear').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('issuedYear').errors.required">
                                                Citizenship issued Date is required
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!--END ROW-->
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Citizenship Issued District</strong></label>
                                        <ng-select [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('issuedPlace').errors }"
                                                   [multiple]="false"
                                                   formControlName="issuedPlace"
                                                   placeholder="Select district">
                                            <ng-option *ngFor="let district of allDistrict" [value]="district?.name">
                                                {{district?.name}}
                                            </ng-option>
                                        </ng-select>
                                        <div *ngIf="(submitted) && guarantorDetails.get('issuedPlace').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('issuedPlace').errors.required">
                                                Citizenship issued Place is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Contact</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('contactNumber').errors }"
                                               class="form-control form-control-sm-error rounded"
                                               formControlName="contactNumber"
                                               id="contactNumber"
                                               name="contactNumber"
                                               placeholder="contact Number"
                                               type="text"/>
                                        <div *ngIf="(submitted) && guarantorDetails.get('contactNumber').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('contactNumber').errors.required">
                                                Contact Number is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Guarantor's Father Name</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('fatherName').errors }"
                                               class="form-control form-control-sm-error rounded"
                                               formControlName="fatherName"
                                               id="fatherName"
                                               name="fatherName"
                                               placeholder="Father's Name"
                                               type="text"/>
                                        <div *ngIf="(submitted) && guarantorDetails.get('fatherName').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('fatherName').errors.required">
                                                Guarantors Father's name is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Guarantor's Grandfather Name</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('grandFatherName').errors }"
                                               class="form-control form-control-sm-error rounded"
                                               formControlName="grandFatherName"
                                               id="grandFatherName"
                                               name="grandFatherName"
                                               placeholder="Grandfather's Name"
                                               type="text"/>
                                        <div *ngIf="(submitted) && guarantorDetails.get('grandFatherName').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('grandFatherName').errors.required">
                                                Guarantors Grandfathers name is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label><strong>Relationship</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && guarantorDetails.get('relationship').errors }"
                                               class="form-control form-control-sm-error rounded"
                                               formControlName="relationship"
                                               id="relationship"
                                               name="relationship"
                                               placeholder="relationship"
                                               type="text"/>
                                        <div *ngIf="(submitted) && guarantorDetails.get('relationship').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf="guarantorDetails.get('relationship').errors.required">
                                                Relationship is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>

                <div class="text-right">
                    <button (click)="addEmptyGroup()" class="btn btn-sm btn-flat btn-primary">
                        Add Guarantor
                    </button>
                </div>
            </form>
        </div>
    </nb-card-body>
    <nb-card-footer>
        <div *ngIf="fromProfile" class="py-4 d-flex justify-content-end">
            <button (click)="onSubmit()" nbButton type="button">save</button>
        </div>
    </nb-card-footer>
</nb-card>
