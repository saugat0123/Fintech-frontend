<nb-card class="col-md-6"ngDraggable [ngResizable]="true">
    <nb-card-header>
        <strong>{{popUpTitle}}</strong>
        <button (click)="nbDialogRef.close()" aria-label="Close"
                class="close cursor d-inline-flex justify-content-end" nbButton
                size="tiny"
                status="primary">
            <span aria-hidden="true">Ã—</span></button>
    </nb-card-header>
    <nb-card-body  [nbSpinner]="spinner" nbSpinnerSize="tiny" nbSpinnerMessage="Documents are being sent..." >
        <form [formGroup]="formAction" role="form">

            <p *ngIf="additionalDetails?.hasDeferredDocs" class="text-danger">
                This loan contains deferred documents that are not uploaded.
            </p>

            <div *ngIf="popUpTitle === 'Send Forward'" class="row">

                <div class="col-md-12 form-group">
                    <label class="toRole">TO</label>
                    <select (change)="getUserList(this.formAction.get('toRole').value)"
                            class="form-control form-control-sm"
                            formControlName="toRole"
                            id="toRole"
                            name="toRole"
                    >
                        <option [value]="null" hidden>Select To</option>
                        <option *ngFor="let forwardBackward of sendForwardBackwardList"
                                [ngValue]="forwardBackward.role">
                            {{forwardBackward.role?.roleName}}
                        </option>
                    </select>
                    <div class="sb-small text-danger" *ngIf="isEmptyUser">No User Present in this Role For this
                        branch
                    </div>
                </div>
            </div>

            <div *ngIf="userList?.length > 1 && showUserList" class="row">
                <div class="col-md-12 form-group">
                    <label class="toUser" for="toUser">To User</label>
                    <select class="form-control form-control-sm" formControlName="toUser" id="toUser"
                            name="toUser">
                        <option *ngFor="let user of userList"
                                [ngValue]="user">
                            {{user.username}}
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <label for="comment">Comment:</label>
                    <ckeditor [ngClass]="{ 'is-invalid': submitted && formAction.controls['comment'].errors }"
                              formControlName="comment" id="comment" [config]="ckeConfig"></ckeditor>
                    <div *ngIf="submitted && formAction.controls['comment'].hasError('required')"
                         class="error-message" style="color: red;">comment is required
                    </div>
                    <div *ngIf="submitted && formAction.controls['comment'].hasError('required')"
                         class="error-message"
                         style="color: red;">comment is required
                    </div>
                </div>
            </div>

            <div *ngIf="isMaker">
                <div class="col-md-12">
                    <nb-checkbox class="cursor" (checkedChange)="isSolChecked($event)"
                                 [checked]="customerLoanHolder.isSol">is SOL?
                    </nb-checkbox>
                </div>
                <div *ngIf="isNoUserSelectedSol" class="sb-small text-danger">{{solNoUserSelectedMessage}}</div>
                <div class="col-md-12 row" *ngIf="showHideSolUser">
                    <div class="col-md-6">
                        <label class="toRole" for="toRole">Approval Role</label>
                        <select style="width: 100%"
                                (change)="getSOlUSerList(this.formAction.get('selectedRoleForSol').value)"
                                class="form-control form-control-sm"
                                formControlName="selectedRoleForSol"
                                name="toRole">
                            <option [value]="null" hidden>Select To</option>
                            <option *ngFor="let forwardBackward of sendForwardBackwardList"
                                    [ngValue]="forwardBackward.role"
                                    [selected]="forwardBackward.role.id === customerLoanHolder?.solUser?.role.id">
                                {{forwardBackward.role?.roleName}}
                            </option>
                        </select>
                        <div *ngIf="isNoUserSol" class="sb-small text-danger">{{solNoUserMessage}}</div>
                    </div>

                    <div class="col-md-6" *ngIf="solUserList?.length > 1">
                        <div style="width:100%">
                            <label class="solUser" for="solUser">Approval User</label>
                            <select class="form-control form-control-sm" formControlName="solUser" id="solUser"
                                    name="solUser">
                                <option *ngFor="let user of solUserList"
                                        [ngValue]="user"
                                        [selected]="user.id === customerLoanHolder?.solUser?.id">
                                    {{user.username}}</option>
                            </select>
                        </div>
                    </div>
                </div>


            </div>
        </form>
    </nb-card-body>
    <nb-card-footer>
        <button (click)="openLogin(verify)" [disabled]="formAction.invalid" nbButton type="button">
            <em class="fa fa-save"></em>
        </button>
    </nb-card-footer>
</nb-card>
<ng-template #verify>
    <div>
        <div class="modal-content">
            <div class="modal-header" style="display:block">
                <div class="login-box-body">
                    <p class="login-box-msg">Please Enter Your Credential for Confirmation</p>
                    <p *ngIf="falseCredential" class="text-danger">Please enter
                        again. {{falseCredentialMessage}}</p>

                    <form #lform="ngForm" (ngSubmit)="lform.valid && onLogin(lform)" class="login-form"
                          name="login-form">
                        <div class="form-group has-feedback">
                            <input #pass="ngModel" [ngClass]="{'is-invalid': lform.submitted && pass.invalid}"
                                   class="form-control"
                                   id="password"
                                   name="password"
                                   ngModel placeholder="Password" required
                                   type="password">
                            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                            <div *ngIf="pass.invalid && lform.submitted" class="invalid-feedback">
                                Password is required
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            <button class="btn btn-primary  btn-flat" type="submit">verify</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</ng-template>

