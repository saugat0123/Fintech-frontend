<nb-card>
    <nb-card-header>
        <div class="col-md-12">
            <div class="col-md-6">
                <button
                        nbButton shape="rectangle" status="primary"
                        (click)="isFilterCollapsed = !isFilterCollapsed"
                        [attr.aria-expanded]="!isFilterCollapsed"
                        aria-controls="searchModel">
                    <i class="fa fa-filter"> Filter</i>
                </button>
            </div>

        </div>
        <div class="col-md-12 d-flex justify-content-end">

            <button nbButton outline status="info"
                    (click)="getCsv()">
                <i class="fa fa-download" aria-hidden="true"></i></button>

        </div>
        <div id="searchModel" class="col-md-12" [ngbCollapse]="isFilterCollapsed">
            <form (ngSubmit)="onSearch()" [formGroup]="filterForm">
                <div class="row py-3">
                    <div class="col-md-3" *ngIf="accessSpecific || accessAll">
                        <select class="custom-select" formControlName="branch">
                            <option [value]="null" selected hidden>Select Branch</option>
                            <option [value]="null">All Branches</option>
                            <option *ngFor="let branch of branchList" [value]="branch.id">{{branch.name}}
                            </option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="custom-select" formControlName="loanType">
                            <option [value]="null" selected hidden>Select Loan Type</option>
                            <option [value]="null">All Loan Types</option>
                            <option *ngFor="let loanType of loanTypeList"
                                    [value]="loanType.id">{{loanType.name}}
                            </option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <input id="startDate" [nbDatepicker]="startDate" class="form-control rounded"
                               (change)="checkIfDateFiltration()" formControlName="startDate"
                               placeholder="Enter Start Date" [ngClass]="{ 'is-invalid': !validStartDate }">
                        <nb-datepicker #startDate></nb-datepicker>
                        <div *ngIf="!validStartDate" class="invalid-feedback">Invalid start date</div>
                    </div>
                    <div class="col-md-3">
                        <input id="endDate" [nbDatepicker]="endDate" class="form-control rounded"
                               (change)="checkIfDateFiltration()" formControlName="endDate"
                               placeholder="Enter End Date" [ngClass]="{ 'is-invalid': !validEndDate }">
                        <nb-datepicker #endDate></nb-datepicker>
                        <div *ngIf="!validEndDate" class="invalid-feedback">Invalid end date</div>
                    </div>


                    <div class="col-md-3">
                        <select class="custom-select" formControlName="loanNewRenew">
                            <option [value]="null" selected hidden>Select Type</option>
                            <option [value]="null">All Types</option>
                            <option *ngFor="let status of loanType.values()"
                                    [value]="status">{{loanType[status]}}
                            </option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <input id="customerName" class="form-control rounded" formControlName="customerName"
                               placeholder="Enter customer name">
                    </div>
                </div>

                <div class="col-md-12 p-0">
                    <button nbButton status="info" shape="rectangle" class="mr-2"
                            [disabled]="!filterForm.valid"
                            type="submit">Search
                    </button>
                    <button (click)="clearSearch()" shape="rectangle" nbButton status="danger">Clear</button>
                </div>
            </form>
        </div>

    </nb-card-header>
    <nb-card-body>
        <br>
        <table id="add-branch-table" class="table table-bordered table-hover ">
            <thead>
            <tr>
                <th>Branch</th>
                <th>Customer Name</th>
                <th>Loan Facility</th>
                <th>Proposed Amount</th>
                <th>Type</th>
                <th>Status</th>
                <!--                <th>Possession Under/Days</th>-->
                <!--                <th>Loan lifespan</th>-->
                <th>Offer Letter Status</th>
                <th>Action</th>


            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let model of loanDataHolderList;let i=index"

                class="cursor">
                <td (click)="onClick(model.loan.id,model.id)">{{model?.branch?.name}}</td>
                <td (click)="onClick(model.loan.id,model.id)">{{model?.customerInfo?.customerName}}</td>
                <td (click)="onClick(model.loan.id,model.id)">{{model?.loan?.name}}</td>
                <td (click)="onClick(model.loan.id,model.id)">
                    <span
                            class="d-flex justify-content-end">{{model.proposal?.proposedLimit | number}}</span>
                </td>
                <td (click)="onClick(model.loan.id,model.id)">{{loanType[model?.loanType]}}</td>
                <td (click)="onClick(model.loan.id,model.id)">{{model?.documentStatus}}</td>
                <!--                <td (click)="onClick(model.loan.id,model.id)">-->
                <!--                    <div *ngIf='model?.documentStatus.toString()==="PENDING"'>-->
                <!--                        {{model?.currentStage?.toUser?.name}}-->
                <!--                        / {{getDifferenceInDays(model?.currentStage?.lastModifiedAt)}}-->
                <!--                    </div>-->
                <!--                    <div *ngIf='(model?.documentStatus.toString()==="CLOSED" ||-->
                <!--                        model?.documentStatus.toString()==="REJECTED" ||-->
                <!--                        model?.documentStatus.toString()==="APPROVED")'>-->
                <!--                        {{model?.currentStage?.toUser?.name}}-->
                <!--                        /{{getDaysDifference(model?.currentStage.lastModifiedAt, model?.previousList[model?.previousList.length - 1].lastModifiedAt)}}-->
                <!--                    </div>-->
                <!--                </td>-->
                <!--                <td (click)="onClick(model.loan.id,model.id)">-->
                <!--                    <div *ngIf='model?.documentStatus.toString()==="PENDING"'>{{getDifferenceInDays(model?.currentStage?.createdAt)}}</div>-->
                <!--                    <div *ngIf='(model?.documentStatus.toString()==="CLOSED" ||-->
                <!--                        model?.documentStatus.toString()==="REJECTED" ||-->
                <!--                        model?.documentStatus.toString()==="APPROVED")'>-->
                <!--                        {{getDaysDifference(model?.currentStage?.lastModifiedAt, model?.currentStage?.createdAt)}}-->
                <!--                    </div>-->
                <!--                </td>-->

                <td>
                    {{model?.customerOfferLetter?.docStatus || 'NA'}}
                </td>

                <td>

                    <div class="col-md-12">


                        <nb-select placeholder="Select Offer Letter Action">
                            <nb-option *ngFor="let offerLetter of model.loan.offerLetters;">
                                <span (click)="generateOfferLetter(offerLetter, model)">
                                    {{offerLetter.name}}
                                </span>
                            </nb-option>


                            <nb-option *ngIf="model?.customerOfferLetter !== null">
                                <a (click)=" uploadOfferLetterTemplate(model)"><i
                                    class="fa fa-upload"></i><span class="px-3 cursor">Upload</span></a>
                            </nb-option>
                            <!--<nb-option *ngIf="model?.customerOfferLetter?.path !==null">
                                <i class="fa fa-download"></i>
                                <span class="px-3 cursor"
                                      (click)="previewClick(model?.customerOfferLetter?.path)">Preview/Download</span>
                            </nb-option>-->
                        </nb-select>

                    </div>

                </td>


            </tr>
            </tbody>
        </table>
        <!-- ===================table-pagination==================== -->
        <app-paging *ngIf="!spinner" [pageable]="pageable" (changePage)="changePage($event)"></app-paging>
        <!-- ===================table-pagination==================== -->
    </nb-card-body>


</nb-card>
