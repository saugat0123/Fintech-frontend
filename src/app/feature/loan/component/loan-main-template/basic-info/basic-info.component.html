<nb-card>
    <nb-card-body>
        <div class="form-group">
            <form (ngSubmit)="onSubmit()" [formGroup]="basicInfo" class="form-horizontal">
                <!-- START ROW -->
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="customerID"><strong>Customer ID</strong></label>
                            <div class="input-group mb-3">
                                <input (change)="searchByCustomerId()"
                                       [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.customerId.errors }"
                                       class="form-control" formControlName="customerId"
                                       id="customerID" name="customerId"
                                       placeholder="8 alpha numeric customer ID" type="text">
                                <button (click)="searchByCustomerId()" nbButton outline size="small"
                                        status="primary">Search
                                </button>
                                <div *ngIf="(submitted) && basicInfoControls.customerId.invalid"
                                     class="invalid-feedback">
                                    <div *ngIf="basicInfoControls.customerId.errors.required">Customer ID is required
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="customerDetailField.showFormField" class="col-md-4">
                        <div class="form-group">
                            <label for="customerName"><strong>Customer Name</strong></label>
                            <input [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.customerName.errors }"
                                   class="form-control form-control-sm-error rounded" formControlName="customerName" id="customerName"
                                   name="customerName"
                                   placeholder="Applicant's Full Name"
                                   type="text">
                            <div *ngIf="(submitted) && basicInfoControls.customerName.invalid" class="invalid-feedback">
                                <div *ngIf="basicInfoControls.customerName.errors.required">Customer name is required
                                </div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="customerDetailField.showFormField" class="col-md-4">
                        <label for="email"><strong>Email</strong></label>
                        <input [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.email.errors }"
                               class="form-control" formControlName="email" id="email" name="email"
                               placeholder="eg. xyz@abc.com"
                               type="email">
                        <div *ngIf="(submitted) && basicInfoControls.email.invalid" class="invalid-feedback">
                            <div *ngIf="basicInfoControls.email.errors.required">Email is required</div>
                            <div *ngIf="basicInfoControls.email.errors.email">Valid email address has form xyz@abc.com
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END ROW -->
                <!-- Start Row-->

                <div *ngIf="customerDetailField.showFormField" class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="dob"><strong>Date of birth</strong></label>
                            <input [nbDatepicker]="dob"
                                   [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.dob.errors }" class="form-control" formControlName="dob"
                                   id="dob"
                                   name="dob"
                                   placeholder="Customer Date of birth">
                            <nb-datepicker #dob></nb-datepicker>
                            <div *ngIf="submitted && basicInfoControls.dob.errors"
                                 class="invalid-feedback">
                                <div *ngIf="basicInfoControls.dob.errors.required || basicInfoControls.dob.errors.beforeToday">
                                    Invalid date of birth
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--End Row-->
                <!-- START ROW -->
                <div *ngIf="customerDetailField.showFormField" class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="province"><strong>Province</strong></label>
                            <select (change)="getDistricts(this.basicInfo.get('province').value)"
                                    [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.province.errors }" class="custom-select"
                                    formControlName="province"
                                    id="province"
                                    name="province">
                                <option [ngValue]="null" selected hidden>Select Province</option>
                                <option *ngFor="let provinceVal of provinceList" [ngValue]="provinceVal"
                                [selected]="provinceVal.id === province?.id">
                                    {{provinceVal.name}}
                                </option>
                            </select>
                            <div *ngIf="(submitted) && basicInfoControls.province.invalid" class="invalid-feedback">
                                <span *ngIf="basicInfoControls.province.errors.required">Province is required</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="district"><strong>District</strong></label>
                            <select (change)="getMunicipalities(this.basicInfo.get('district').value)"
                                    [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.district.errors }" class="custom-select"
                                    formControlName="district"
                                    id="district"
                                    name="district">
                                <option [ngValue]="null" selected hidden>Select District</option>
                                <option *ngFor="let districtVal of districtList" [ngValue]="districtVal"
                                [selected]="districtVal.id === district?.id">
                                    {{districtVal.name}}
                                </option>
                            </select>
                            <div *ngIf="(submitted) &&  basicInfoControls.district.invalid" class="invalid-feedback">
                                <span *ngIf="basicInfoControls.district.errors.required">District is required</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="municipality"><strong>Municipalities or VDC</strong></label>
                            <select [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.municipalities.errors }" class="custom-select" formControlName="municipalities"
                                    id="municipality"
                                    name="municipality">
                                <option [ngValue]="null" hidden>Select Municipality</option>
                                <option *ngFor="let municipalityVal of municipalitiesList" [ngValue]="municipalityVal"
                                [selected]="municipalityVal.id === municipality?.id">
                                    {{municipalityVal.name}}
                                </option>
                            </select>
                            <div *ngIf="(submitted) && basicInfoControls.municipalities.invalid"
                                 class="invalid-feedback">
                                <span *ngIf="basicInfoControls.municipalities.errors.required">Municipalities is required</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END ROW -->
                <!-- START ROW -->
                <div *ngIf="customerDetailField.showFormField" class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="street"><strong>Street</strong></label>
                            <input [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.street.errors }"
                                   class="form-control" formControlName="street" id="street"
                                   name="street" placeholder="Street Name"
                                   type="text">
                            <div *ngIf="(submitted) && basicInfoControls.street.invalid" class="invalid-feedback">
                                <div *ngIf="basicInfoControls.street.errors.required">Street is required</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="wardNumber"><strong>Ward Number</strong></label>
                            <input [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.wardNumber.errors }"
                                   class="form-control" formControlName="wardNumber" id="wardNumber"
                                   name="wardNumber" placeholder="Ward Number"
                                   type="text">
                            <div *ngIf="(submitted) && basicInfoControls.wardNumber.invalid" class="invalid-feedback">
                                <div *ngIf="basicInfoControls.wardNumber.errors.required">
                                    Ward Number is required
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END ROW -->
                <!-- START ROW -->
                <div *ngIf="customerDetailField.showFormField" class="row">
                    <!--<div class="col-md-4">
                        <div class="form-group">
                            <label for="mobile"><b>Mobile</b></label>
                            <input -- class="form-control" formControlName="mobile" id="mobile" name="mobile"
                                   type="text">
                            placeholder="Mobile number"
                            [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.mobile.errors }">
                            <div *ngIf="(submitted) && basicInfoControls.mobile.invalid" class="invalid-feedback">
                                <div *ngIf="basicInfoControls.mobile.errors.required">Mobile number is required</div>
                                <div *ngIf="basicInfoControls.mobile.errors.pattern">Mobile number is invalid.</div>
                            </div>
                        </div>
                    </div> -->
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="contactNumber"><strong>Contact Number</strong></label>
                            <input [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.contactNumber.errors }"
                                   class="form-control" formControlName="contactNumber" id="contactNumber"
                                   name="contactNumber"
                                   placeholder="Contact number"
                                   type="text">
                            <div *ngIf="(submitted) && basicInfoControls.contactNumber.invalid"
                                 class="invalid-feedback">
                                <div *ngIf="basicInfoControls.contactNumber.errors.required">
                                    Contact Number number is required
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="citizenshipNumber"><strong>Citizenship Number</strong></label>
                            <input [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.citizenshipNumber.errors }"
                                   class="form-control" formControlName="citizenshipNumber"
                                   id="citizenshipNumber" name="citizenshipNumber" placeholder="Citizenship Number"
                                   type="text">
                            <div *ngIf="(submitted) && basicInfoControls.citizenshipNumber.invalid"
                                 class="invalid-feedback">
                                <div *ngIf="basicInfoControls.citizenshipNumber.errors.required">Citizenship number is
                                    required
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- END ROW -->
                <!-- START ROW -->
                <div *ngIf="customerDetailField.showFormField" class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="citizenshipIssuedPlace"><strong>Issued Place</strong></label>
                            <input [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.citizenshipIssuedPlace.errors }"
                                   class="form-control"
                                   formControlName="citizenshipIssuedPlace" id="citizenshipIssuedPlace"
                                   name="citizenshipIssuedPlace"
                                   placeholder="Citizenship Issued Place"
                                   type="text">
                            <div *ngIf="(submitted) && basicInfoControls.citizenshipIssuedPlace.invalid"
                                 class="invalid-feedback">
                                <div *ngIf="basicInfoControls.citizenshipIssuedPlace.errors.required">Issued Place is
                                    required
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="customerCitizenshipIssuedDate"><strong>Issued Date</strong></label>
                            <input [nbDatepicker]="customerCitizenshipIssuedDate"
                                   [ngClass]="{ 'is-invalid': (submitted) && basicInfoControls.citizenshipIssuedDate.errors }"
                                   class="form-control" formControlName="citizenshipIssuedDate"
                                   id="customerCitizenshipIssuedDate"
                                   name="customerCitizenshipIssuedDate"
                                   placeholder="Citizenship Issued Date">
                            <nb-datepicker #customerCitizenshipIssuedDate></nb-datepicker>
                            <div *ngIf="submitted && basicInfoControls.citizenshipIssuedDate.errors"
                                 class="invalid-feedback">
                                <div *ngIf="basicInfoControls.citizenshipIssuedDate.errors.required || basicInfoControls.citizenshipIssuedDate.errors.beforeToday">
                                    Invalid Registration Date
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="occupation"><strong>Occupation</strong></label>
                            <ng-select [items]="occupations"
                                       [multiple]="false"
                                       [ngClass]="{'is-invalid':submitted &&  basicInfoControls.occupation.errors}"
                                       bindLabel="value"
                                       bindValue="key"
                                       formControlName="occupation"
                                       id="occupation"
                                       placeholder="Select Occupation">
                            </ng-select>
                            <div *ngIf="submitted && basicInfoControls.occupation.errors"
                                 class="invalid-feedback">
                                <div *ngIf="basicInfoControls.occupation.errors.required">Occupation is required</div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END ROW -->
                <!-- START ROW -->
                <div *ngIf="customerDetailField.showFormField" class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="incomeSource"><strong>Income Source</strong></label>
                            <ng-select [items]="incomeSources"
                                       [multiple]="false"
                                       [ngClass]="{'is-invalid':submitted &&  basicInfoControls.incomeSource.errors}"
                                       bindLabel="value"
                                       bindValue="key"
                                       formControlName="incomeSource"
                                       id="incomeSource"
                                       placeholder="Select Income Source">
                            </ng-select>
                            <div *ngIf="submitted && basicInfoControls.incomeSource.errors"
                                 class="invalid-feedback">
                                <div *ngIf="basicInfoControls.incomeSource.errors.required">Income Source is required
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="customerDetailField.showFormField">
                    <div *ngFor="let relatives of basicInfo.get('customerRelatives')['controls']; let r = index"
                         formArrayName="customerRelatives">
                        <div [formGroupName]="r">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="customerRelation"><strong>Relation</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && relatives.get('customerRelation').errors }"
                                               class="form-control"
                                               formControlName="customerRelation"
                                               id="customerRelation"
                                               placeholder="Relation" type="text">
                                        <div *ngIf="submitted && relatives.get('customerRelation').errors"
                                             class="invalid-feedback">
                                            <div *ngIf="relatives.get('customerRelation').errors.required">Relation is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="relationName"><strong>Name</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && relatives.get('customerRelativeName').errors }"
                                               class="form-control"
                                               formControlName="customerRelativeName"
                                               id="relationName"
                                               placeholder="Name" type="text">
                                        <div *ngIf="submitted && relatives.get('customerRelativeName').errors"
                                             class="invalid-feedback">
                                            <div *ngIf="relatives.get('customerRelativeName').errors.required">Name is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="citizenship"><strong>CitizenshipNumber</strong></label>
                                        <input [ngClass]="{ 'is-invalid': (submitted) && relatives.get('citizenshipNumber').errors }"
                                               class="form-control"
                                               formControlName="citizenshipNumber"
                                               id="citizenship"
                                               placeholder="Citizenship Number" type="text">
                                        <div *ngIf="submitted && relatives.get('citizenshipNumber').errors"
                                             class="invalid-feedback">
                                            <div *ngIf="relatives.get('citizenshipNumber').errors.required">Number is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="provinces"><strong>Province</strong></label>
                                            <select (change)="Districts(relatives.get('province').value, r)"
                                                    [ngClass]="{ 'is-invalid': (submitted) && relatives.get('province').errors }"
                                                    class="custom-select"
                                                    formControlName="province"
                                                    id="provinces"
                                                    name="province">
                                                <option [ngValue]="null" hidden>Select Province</option>
                                                <option *ngFor="let provinceVal of provinceList"
                                                        [ngValue]="provinceVal.id">
                                                    {{provinceVal.name}}
                                                </option>
                                            </select>
                                        <div *ngIf="(submitted) && relatives.get('province').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf=" relatives.get('province').errors.required">
                                                Province is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="Districts"><strong>District</strong></label>
                                        <select (change)="Municipalities(relatives.get('district').value, r)"
                                                [ngClass]="{ 'is-invalid': (submitted) && relatives.get('district').errors }"
                                                class="custom-select"
                                                formControlName="district"
                                                id="Districts"
                                                name="district">
                                            <option [ngValue]="null" hidden>Select District</option>
                                            <option *ngFor="let districtVal of addressList[r].districtList"
                                                    [ngValue]="districtVal.id">
                                                {{districtVal.name}}
                                            </option>
                                        </select>
                                        <div *ngIf="(submitted) &&  relatives.get('district').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf=" relatives.get('district').errors.required" >
                                                District is required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="municipalities"><strong>Municipalities or VDC</strong></label>
                                        <select [ngClass]="{ 'is-invalid': (submitted) && relatives.get('municipalities').errors }"
                                                class="custom-select" formControlName="municipalities"
                                                id="municipalities"
                                                name="municipality">
                                            <option [ngValue]="null" hidden>Select Municipality</option>
                                            <option *ngFor="let municipalityVal of addressList[r].municipalityVdcList"
                                                    [ngValue]="municipalityVal.id">
                                                {{municipalityVal.name}}
                                            </option>
                                        </select>
                                        <div *ngIf="(submitted) && relatives.get('municipalities').invalid"
                                             class="invalid-feedback">
                                            <div *ngIf=" relatives.get('municipalities').errors.required" >
                                                <div *ngIf=" relatives.get('municipalities').errors.required">
                                                Municipality is required
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="issuedDate"><strong>Issued Date</strong></label>
                                        <input [nbDatepicker]="relationCitizenIssueDate"
                                               [ngClass]="{ 'is-invalid': (submitted) && relatives.get('citizenshipIssuedDate').errors }"
                                               class="form-control"
                                               formControlName="citizenshipIssuedDate"
                                               id="issuedDate"
                                               nbInput placeholder="Issued Date">
                                        <nb-datepicker #relationCitizenIssueDate></nb-datepicker>
                                        <div *ngIf="submitted && relatives.get('citizenshipIssuedDate').errors"
                                             class="invalid-feedback">
                                            Invalid Issued Date!
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="r>0" class="ml-3">
                                    <button (click)="removeRelatives(r)"
                                            class="float-right" nbButton
                                            size="small" status="danger">remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <input (click)="addRelatives()" class="btn btn-sm btn-flat btn-primary"
                               type="button" value="Add More"/>
                    </div>
                </div>
                <!-- END ROW -->
            </form>
        </div>
    </nb-card-body>
</nb-card>
