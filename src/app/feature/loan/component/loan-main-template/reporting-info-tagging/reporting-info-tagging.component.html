<nb-card>
  <nb-card-header>
    <h3><strong>Reporting Info</strong></h3>
    <hr />
    <div class="row">
      <div class="col-md-12">
        <button
            (click)="isFilterCollapsed = !isFilterCollapsed"
            [attr.aria-expanded]="!isFilterCollapsed" aria-controls="searchModel"
            nbButton
            shape="rectangle"
            status="primary"
            type="button">
          <i class="fa fa-filter"> Filter</i>
        </button>
        <div class="row">
          <div [ngbCollapse]="isFilterCollapsed" class="col-md-12" id="searchModel">
            <div class="d-flex py-3 justify-content-start">
              <form (ngSubmit)="onSearch()" [formGroup]="filterForm">
                <input class="mr-1" fieldSize="medium" formControlName="name" id="name" nbInput
                       placeholder="Enter name" type="text">
                <div class="pt-3">
                  <button class="mr-2" nbButton shape="rectangle" size="small"
                          status="info" type="submit">Search
                  </button>
                  <button (click)="clear()" nbButton shape="rectangle" size="small" status="danger">
                    Clear
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body>
    <p>Tag the reporting information.</p>
    <hr/>

    <nb-accordion>
      <nb-accordion-item #itemReport (collapsedChange)="expandAllLevels = false"
                         *ngFor="let report of reportingInfoList">
        <nb-accordion-item-header>
          <span>{{report.name}}</span>
        </nb-accordion-item-header>
        <nb-accordion-item-body>
          <ng-container *ngIf="itemReport.expanded">
            <ng-container *ngIf="report?.reportingInfoLevels?.length < 1">
              <p>No reporting tags available!!!</p>
            </ng-container>
            <ng-container *ngIf="report?.reportingInfoLevels?.length > 0">
              <button (click)="expandAllLevels = !expandAllLevels" nbButton size="small"
                      status="{{expandAllLevels ? 'danger' : 'success'}}">
                {{expandAllLevels ? 'Collapse' : 'Expand'}} All
              </button>
              <hr/>
              <ng-template #recursiveTemplate let-levels>
                <ng-container *ngFor="let level of levels">
                  <div class="mt-1">
                    <div class="row">
                      <div class="col-md-12">
                        <nb-checkbox #checkbox (checkedChange)="updateTagging($event, level?.id)"
                                     [checked]="reportingInfoLevelTags.has(level?.id)"
                                     status="primary">{{level?.code}} {{level?.description}}</nb-checkbox>
                      </div>
                    </div>
                    <div
                        *ngIf="level?.reportingInfoLevels?.length && (checkbox.checked || expandAllLevels)"
                        class="custom-left-border">
                      <ng-container
                          *ngTemplateOutlet="recursiveTemplate; context:{$implicit: level?.reportingInfoLevels}"></ng-container>
                    </div>
                  </div>
                </ng-container>
              </ng-template>
              <ng-container
                  *ngTemplateOutlet="recursiveTemplate; context:{$implicit: report?.reportingInfoLevels}"></ng-container>
              <hr/>
            </ng-container>
          </ng-container>
        </nb-accordion-item-body>
      </nb-accordion-item>
    </nb-accordion>
  </nb-card-body>
</nb-card>
