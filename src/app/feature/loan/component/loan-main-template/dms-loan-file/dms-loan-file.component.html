<section>
    <nb-card>
        <nb-card-body>
            <div class="box box-primary">
                <form role="form" (ngSubmit)="onSubmit()" [formGroup]="loanForm">
                    <div class="box-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="name"><b>Customer Name</b></label>
                                    <input type="text" formControlName="customerName"
                                           [ngClass]="{ 'is-invalid':submitted && form.customerName.errors}"
                                           class="form-control rounded" id="name"
                                           placeholder="Enter name"/>
                                    <div *ngIf="submitted && form.customerName.errors" class="invalid-feedback">
                                        <div *ngIf="form.customerName.errors.required">Name is required</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group rounded">
                                    <label for="citizenshipNumber"><b>Citizenship Number</b></label>

                                    <div class="input-group mb-3">
                                        <input type="text" formControlName="citizenshipNumber" class="form-control rounded"
                                               [ngClass]="{ 'is-invalid':submitted && form.citizenshipNumber.errors}"
                                               id="citizenshipNumber" placeholder="Enter citizenship number"/>
                                        <div class="input-group-append">
                                            <button nbButton outline status="primary" size="small" (click)="searchByCitizenship()">Search</button>
                                        </div>
                                        <div *ngIf="submitted && form.citizenshipNumber.errors" class="invalid-feedback">
                                            <div *ngIf="form.citizenshipNumber.errors.required">Citizenship number is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="contact"><b>Contact Number</b></label>
                                    <input type="text" formControlName="contactNumber" class="form-control rounded"
                                           id="contact"
                                           [ngClass]="{ 'is-invalid':submitted && form.contactNumber.errors}"
                                           placeholder="Enter Contact Number"/>
                                    <div *ngIf="submitted && form.contactNumber.errors" class="invalid-feedback">
                                        <div *ngIf="form.contactNumber.errors.required">Contact number is required</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="interest"><b>Interest Rate</b></label>
                                    <input type="text" formControlName="interestRate" class="form-control rounded"
                                           id="interest"
                                           [ngClass]="{ 'is-invalid':submitted && form.interestRate.errors}"
                                           placeholder="Enter interest rate"/>
                                    <div *ngIf="submitted && form.interestRate.errors" class="invalid-feedback">
                                        <div *ngIf="form.interestRate.errors.required">Interest is required</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="amount"><b>Proposed Amount</b></label>
                                    <input type="text" formControlName="proposedAmount" class="form-control rounded"
                                           id="amount"
                                           [ngClass]="{ 'is-invalid':submitted && form.proposedAmount.errors}"
                                           placeholder="Enter proposed amount"/>
                                    <div *ngIf="submitted && form.proposedAmount.errors" class="invalid-feedback">
                                        <div *ngIf="form.proposedAmount.errors.required">Amount is required</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label><b>Security</b></label>
                                    <ng-select [items]="dropdownList"
                                               bindLabel="name"
                                               bindValue="id"
                                               [multiple]="true"
                                               placeholder="Select Security"
                                               formControlName="security"
                                               [ngClass]="{ 'is-invalid':submitted && form.security.errors}"
                                    >
                                    </ng-select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="tenure"><b>Tenure</b></label>
                                    <input id="tenure" [nbDatepicker]="date" class="form-control rounded"
                                           formControlName="tenure"
                                           [ngClass]="{ 'is-invalid':submitted && form.tenure.errors}"
                                           placeholder="Enter the tenure">
                                    <nb-datepicker #date></nb-datepicker>
                                    <div *ngIf="submitted && form.tenure.errors" class="invalid-feedback">
                                        <div *ngIf="form.tenure.errors.required || form.tenure.errors.afterToday">
                                            Invalid
                                            Tenure Date
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-md-6">
                                <label><b>Priority</b></label>
                                <ng-select
                                        [items]="dropdownPriorities"
                                        bindLabel="name"
                                        bindValue="id"
                                        [multiple]="false"
                                        placeholder="Select the priority level"
                                        formControlName="priority"
                                >
                                </ng-select>
                            </div>
                        </div>
                        <div class="row" [hidden]="proceed">
                            <div class="col-md-3 pull-right">
                                <button class="btn btn-sm btn-flat btn-primary" type="submit">Proceed</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <hr>

            <form role="form" (ngSubmit)="onProceed()" [formGroup]="documentForm">
                <div class="box-body">
                    <div [hidden]="!proceed">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="box-header with-border">
                                    <h3 class="box-title"><b>Document for initial phase</b></h3>
                                    <em><span
                                            style="color:red;">(select the image in .png or .jpg format and smaller than 2Mb)</span></em>
                                </div>
                                <div *ngIf="errorMessage">
                                    <span class="color" style="color:red"> Maximum Size Exceeds!!!</span>
                                </div>
                                <div class="box-body">
                                    <table class="table table-striped table-bordered table-hover ">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Document Type</th>
                                            <th>Upload</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr *ngFor="let document of initialDocuments; let i=index">
                                            <td>
                                                {{i + 1}}
                                            </td>
                                            <td>{{document.name}}</td>
                                            <td><input type="file" class="form-control-file" id="initial"
                                                       formControlName="file"
                                                       [ngClass]="{'is-invalid':proceeded && docForm.file.errors}"
                                                       accept=".png, .jpg" multiple=""
                                                       (change)="documentUploader($event,document.name)">
                                                <div *ngIf="proceeded && docForm.file.errors"
                                                     class="invalid-feedback">
                                                    <div *ngIf="docForm.file.errors.required">Please upload the
                                                        required
                                                        documents
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <div *ngFor="let path of imageUrl">
                                        <img width="100%" id="image" [src]="path"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="recommendation"><b>Recommendation/Conclusion</b></label>
                                    <textarea class="form-control rounded" formControlName="recommendation"
                                              id="recommendation"
                                              rows="3"
                                              [ngClass]="{ 'is-invalid':proceeded && docForm.recommendation.errors}">
                            </textarea>
                                    <div *ngIf="proceeded && docForm.recommendation.errors" class="invalid-feedback">
                                        <div *ngIf="docForm.recommendation.errors.required">Recommendation is required
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="waiver"><b>Waiver</b></label>
                                    <textarea class="form-control rounded" formControlName="waiver" id="waiver"
                                              rows="3" [ngClass]="{ 'is-invalid':proceeded && docForm.waiver.errors}">
                                </textarea>
                                    <div *ngIf="proceeded && docForm.waiver.errors" class="invalid-feedback">
                                        <div *ngIf="docForm.waiver.errors.required">Waiver is required</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </form>
            <div *ngIf="hasPreviousLoan">
                <p><b>Previous Loans</b></p>
                <table class="table table-condensed table-bordered">
                    <thead>
                    <tr>
                        <th>S.N</th>
                        <th>Loan</th>
                        <th>Branch</th>
                        <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let loan of previousLoans; let i = index"
                        (click)="openLoan(loan.loan.id,loan.id)"
                        class="cursor">
                        <td>{{i + 1}}</td>
                        <td>{{loan?.loan?.name}}</td>
                        <td>{{loan?.branch?.name}}</td>
                        <td>{{loan?.documentStatus}}</td>
                    </tr>
                    </tbody>
                </table>
                <hr />
            </div>
        </nb-card-body>
    </nb-card>
</section>

