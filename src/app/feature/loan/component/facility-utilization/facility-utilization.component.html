<div class="container">
    <div class="row">
            <form class="col-md-12" [formGroup]="facilityUtilizatoinForm">
                <table class="table table-condensed table-bordered table-responsive-md text-center table-sm sb-small" width="100%">
                    <tr class="sb-bg-dark text-white">
                        <th>Facility</th>
                        <th>Limit</th>
                        <th>Average Utilization</th>
                        <th>Utilization (%)</th>
                        <th>Maximum</th>
                        <th>Minimum</th>
                        <th *ngIf="fromProfile">Action</th>
                    </tr>
                    <tbody>
                    <ng-container formArrayName="data" *ngFor="let controls of facilityUtilizatoinForm?.get('data')['controls']; let i = index">
                        <tr *ngIf="fromProfile; else view" formGroupName="{{i}}">
                            <td><input type="text" nbInput formControlName="facility"></td>
                            <td><input type="text" nbInput formControlName="limit" (change)="calculateTotalAverage('limit')" appDecimalNumber></td>
                            <td><input type="text" nbInput formControlName="averageUtilization" (change)="calculateTotalAverage('averageUtilization')" appDecimalNumber></td>
                            <td><input type="text" nbInput formControlName="utilization" (change)="calculateTotalAverage('utilization')"  appDecimalNumber></td>
                            <td><input type="text" nbInput formControlName="maximum" (change)="calculateTotalAverage('maximum')"  appDecimalNumber></td>
                            <td><input type="text" nbInput formControlName="minimum" (change)="calculateTotalAverage('minimum')"  appDecimalNumber></td>
                            <td><button (click)="removeUtilization(i)" nbButton><i class="fa fa-trash"></i></button></td>
                        </tr>
                        <ng-template #view>
                            <tr  formGroupName="{{i}}">
                                <td><span>{{controls?.get('facility')?.value}}</span></td>
                                <td><span>{{controls?.get('limit')?.value}}</span></td>
                                <td><span>{{controls?.get('averageUtilization')?.value}}</span></td>
                                <td><span>{{controls?.get('utilization')?.value}}</span></td>
                                <td><span>{{controls?.get('maximum')?.value}}</span></td>
                                <td><span>{{controls?.get('minimum')?.value}}</span></td>
                            </tr>
                        </ng-template>
                    </ng-container>
                    <tr>
                        <td>Facility wise Average Utilization </td>
                        <td *ngFor="let key  of totalKeys">{{totals[key]}}</td>
                        <td *ngIf="fromProfile"></td>
                    </tr>
                    <tr>
                        <td>Total Average Utilization </td>
                        <td *ngFor="let key  of totalKeys">{{(totals[key] / facilityUtilizatoinForm?.get('data')?.value?.length)}}</td>
                        <td *ngIf="fromProfile"></td>
                    </tr>
                    </tbody>
                </table>
                <button (click)="addUtilization()" class="float-right" nbButton *ngIf="fromProfile">Add <i clas="fa fa-plus"></i></button>
                <hr>
                <div [ngClass]="fromProfile ? 'row' : 'container'">
                    <div [ngClass]="fromProfile ? 'col-md-4' : 'row'">
                        <label for ="lcIssued"><strong>List of LC’s issued/ BG’s issued</strong></label><br>
                        <input *ngIf="fromProfile" id = "lcIssued"type ="text" nbInput  formControlName="lcIssued">
                            <p class="header" *ngIf="!fromProfile">{{facilityUtilizatoinForm?.get('lcIssued')?.value}}</p>
                    </div>
                    <div [ngClass]="fromProfile ? 'col-md-4' : 'row'">
                        <label  for ="oneLimit"><strong>List of One off Limits</strong></label><br>
                        <input *ngIf="fromProfile" type ="text" nbInput id="oneLimit" formControlName="oneLimit">
                            <p class="header" *ngIf="!fromProfile">{{facilityUtilizatoinForm?.get('oneLimit')?.value}}</p>
                    </div>
                    <div [ngClass]="fromProfile ? 'col-md-4' : 'row'">
                        <label for ="remarks"><strong>Remarks on Utilization</strong></label><br>
                        <input *ngIf="fromProfile" type ="text" nbInput id="remarks" formControlName="remarks">
                            <p class="header" *ngIf="!fromProfile">{{facilityUtilizatoinForm?.get('remarks')?.value}}</p>
                    </div>
                </div>
                <button (click)="saveFacilityUtilization()" *ngIf="fromProfile" class="float-right"  nbButton>Save</button>

            </form>
    </div>
</div>
