<div class="row mt-1">
    <div class="col-md-12 sb-small">
        <p  class="header"><strong   class="header">Facility Schedule</strong> <em class="text-danger sb-small"> &nbsp;Bold row indicates
            current loan proposal</em></p>
        <ul>
            <li class="sb-medium"><i class="fas fa-check-circle"></i> = Approved
                <i class="fas fa-times-circle"></i> = Not Approved
            </li>
            <li class="sb-medium"><span><sup>*</sup>  IR : Interest Rate ,<sup>*</sup> BR : Base Rate ,<sup>*</sup> PR : Premium Rate
                <span *ngIf="!consumerFinance">,<sup>*</sup> COM : Commission ,<sup>*</sup> CM : Cash margin</span></span>
            </li>
            <li class="sb-medium"><span><sup>*</sup>  LAF : Loan Administration Fee ,<sup>*</sup> CF : Commitment Fee ,
                <sup>*</sup> PF : Prepayment Fee,<sup>*</sup> SF : Swap Fee</span>
            </li>
        </ul>
    </div>
</div>
<div class="col-md-12">
    <div class="row">

    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <table
                class="table table-bordered table-responsive-md table-sm sb-small text-center">
            <thead>
            <tr class="sb-bg-gray">
                <th>Loan Facility</th>
                <th>Existing Limit</th>
                <th *ngIf="!isRemit">Outstanding</th>
                <th *ngIf="!isRemit">Enhance</th>
                <th *ngIf="!isRemit">Settlement</th>
                <th>Proposed Limit</th>
                            <!--        for non funded commision and cash margin combination to be view-->
                <th *ngIf="!isRemit">{{consumerFinance?'Existing INT':'Existing INT/COM/CM'}}</th>
                <th>{{consumerFinance?'Proposed INT':'Proposed INT/COM/CM'}}</th>


                <th>Limit Expiry/Tenure</th>
                <th>Repayment Mode</th>
                <th>Fee/Commission</th>
<!--                <th>Purpose of Loan</th>-->
                   </thead>
            <tbody>
            <tr *ngFor="let loan of customerAllLoanList; let i = index"
                [class.font-weight-bold]="loan?.documentStatus !== 'APPROVED'">
                <td  class="text-left pl-lg-2">
                    <ng-container
                            *ngTemplateOutlet="tickCross; context: { $implicit: loan?.documentStatus}"></ng-container>
<!--                            *ngTemplateOutlet="loanTypeLetter; context: { $implicit: loan?.loanType }"></ng-container>-->
<!--                    &nbsp;|&nbsp;-->
                    {{ loan?.loan?.name }}
                </td>
                <td class="text-right pr-1" >
                    <span *ngIf="(loan?.proposal?.data | jsonParse)?.existingLimit">
                        Rs. {{(loan?.proposal?.data | jsonParse)?.existingLimit | currencyFormatter}}
                    </span>
                    <span *ngIf="!(loan?.proposal?.data | jsonParse)?.existingLimit">-</span></td>
                <td class="text-right pr-1" *ngIf="!isRemit" >
                    <span *ngIf="(loan?.proposal?.data | jsonParse)?.outStandingLimit">
                        Rs. {{(loan?.proposal?.data | jsonParse)?.outStandingLimit | currencyFormatter}}
                    </span>
                    <span *ngIf="!(loan?.proposal?.data | jsonParse)?.outStandingLimit">-</span>
                </td>
                <td class="text-right pr-1"  *ngIf="!isRemit">
                    <span *ngIf="(loan?.proposal?.data | jsonParse)?.enhanceLimitAmount">
                        Rs. {{(loan?.proposal?.data | jsonParse)?.enhanceLimitAmount | currencyFormatter}}
                    </span>
                    <span *ngIf="!(loan?.proposal?.data | jsonParse)?.enhanceLimitAmount">-</span>
                </td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span *ngIf="(loan?.proposal?.data | jsonParse)?.settlementAmount">
                        Rs. {{(loan?.proposal?.data | jsonParse)?.settlementAmount | currencyFormatter}}
                    </span>
                    <span *ngIf="!(loan?.proposal?.data | jsonParse)?.settlementAmount">-</span>
                </td>

                <td class="text-right pr-1"> Rs. {{loan?.withIn ? '(' + ((loan?.proposal?.data | jsonParse)?.proposedLimit | currencyFormatter) +')' :((loan?.proposal?.data | jsonParse)?.proposedLimit | currencyFormatter)}}</td>
                <td *ngIf="!isRemit">
                    <span *ngIf="loan?.loan?.isFundable">
                        IR: {{(loan?.proposal?.data | jsonParse)    ?.existInterestRate}}%
                    </span>
                    <span *ngIf="!loan?.loan?.isFundable">
                        <span
                                *ngIf="(loan?.proposal?.data | jsonParse)?.existCashMarginMethod == 'FLAT'">
                            CM: Rs. {{ ((loan?.proposal?.data | jsonParse)?.existCashMargin || 0)|currencyFormatter}} ,</span>
                        <span *ngIf="(loan?.proposal?.data | jsonParse)?.existCashMarginMethod == 'PERCENT'">
                            CM: {{ ((loan?.proposal?.data | jsonParse)?.existCashMargin || 0)}}%,</span>
                        COM:{{(loan?.proposal?.data | jsonParse)?.existCommissionPercentage || '0'}} %
                    </span>
                </td>

                <td>
                    <span *ngIf="loan?.loan?.isFundable">
                        BR : {{ (loan?.proposal?.data | jsonParse)?.baseRate}} %,
                        PR : {{ (loan?.proposal?.data | jsonParse)?.premiumRateOnBaseRate}} %,
                        IR : {{(loan?.proposal?.data | jsonParse)?.interestRate}} %
                    </span>
                    <span *ngIf="!loan?.loan?.isFundable">
                        <span *ngIf="(loan?.proposal?.data | jsonParse)?.cashMarginMethod == 'FLAT'">
                            CM: Rs.  {{ ((loan?.proposal?.data | jsonParse)?.cashMargin || 0) | currencyFormatter}} ,</span>
                        <span *ngIf="(loan?.proposal?.data | jsonParse)?.cashMarginMethod == 'PERCENT'">
                            CM: {{ ((loan?.proposal?.data | jsonParse)?.cashMargin)}} %,</span>
                        COM:{{(loan?.proposal?.data | jsonParse)?.commissionPercentage}} %</span>
                </td>

                        <td>{{(loan?.proposal?.data | jsonParse)?.tenureDurationInMonths || 'N/A '}} month

                        </td>
                <td>
                    <ng-container *ngIf="loan?.loan?.loanNature === 'Terminating'; else tenure;">
                        <table>
                            <tr class="sb-bg-gray">
                                <th *ngIf="(loanDatas[i]?.loanNatureSelected && loanDatas[i]?.fundableNonFundableSelcted &&   loanDatas[i]?.isFundable &&   loanDatas[i]?.isTerminating) ||  loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral">Repayment Mode</th>
                                <th *ngIf=" loanDatas[i]?.showInstallmentAmount  && ((loanDatas[i]?.loanNatureSelected && loanDatas[i]?.fundableNonFundableSelcted &&  loanDatas[i]?.isFundable &&  loanDatas[i]?.isTerminating) || loanDatas[i]?.isVehicle || loanDatas[i]?.isShare || loanDatas[i]?.isGeneral)">EMI Amount</th>
                                <th *ngIf="! loanDatas[i]?.showInstallmentAmount &&  ((loanDatas[i]?.loanNatureSelected && loanDatas[i]?.isFundable && loanDatas[i]?.fundableNonFundableSelcted && loanDatas[i]?.isTerminating) || (loanDatas[i]?.isVehicle || loanDatas[i]?.isShare || loanDatas[i]?.isGeneral))">Interest Amount</th>
                                <th *ngIf=" loanDatas[i]?.showRepaymentMode && ((loanDatas[i]?.loanNatureSelected && loanDatas[i]?.isFundable && loanDatas[i]?.fundableNonFundableSelcted && loanDatas[i]?.isTerminating) || (loanDatas[i]?.isVehicle || loanDatas[i]?.isShare || loanDatas[i]?.isGeneral))">Interest Payment</th>
                                <th *ngIf=" loanDatas[i]?.showRepaymentMode && ((loanDatas[i]?.loanNatureSelected && loanDatas[i]?.isFundable && loanDatas[i]?.fundableNonFundableSelcted && loanDatas[i]?.isTerminating) || (loanDatas[i]?.isVehicle || loanDatas[i]?.isShare || loanDatas[i]?.isGeneral))">Principal Payment</th>
                                <th *ngIf=" loanDatas[i]?.showRepaymentMode && ((loanDatas[i]?.loanNatureSelected && loanDatas[i]?.isFundable && loanDatas[i]?.fundableNonFundableSelcted && loanDatas[i]?.isTerminating) || (loanDatas[i]?.isVehicle || loanDatas[i]?.isShare || loanDatas[i]?.isGeneral))">Principal Amount</th>
                                <th *ngIf=" loanDatas[i]?.showPrincipalAmount && ((loanDatas[i]?.loanNatureSelected && loanDatas[i]?.isFundable && loanDatas[i]?.fundableNonFundableSelcted && loanDatas[i]?.isTerminating) || (loanDatas[i]?.isVehicle || loanDatas[i]?.isShare || loanDatas[i]?.isGeneral))">Principal Amount</th>
                            </tr>
                            <tr>
                                <td *ngIf="(loanDatas[i]?.loanNatureSelected &&  loanDatas[i]?.fundableNonFundableSelcted &&   loanDatas[i]?.isFundable &&   loanDatas[i]?.isTerminating) ||  loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral" class="pl-1">{{(loan?.proposal?.data | jsonParse)?.repaymentMode}}</td>
                                <td *ngIf=" loanDatas[i]?.showInstallmentAmount  && ((loanDatas[i]?.loanNatureSelected &&  loanDatas[i]?.fundableNonFundableSelcted &&  loanDatas[i]?.isTerminating  &&  loanDatas[i]?.isFundable) || (  loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral))" class=" pr-1">Rs. {{(loan?.proposal?.data | jsonParse)?.installmentAmount | currencyFormatter}}</td>
                                <td *ngIf="! loanDatas[i]?.showInstallmentAmount &&  ((loanDatas[i]?.loanNatureSelected &&  loanDatas[i]?.isFundable &&  loanDatas[i]?.fundableNonFundableSelcted &&  loanDatas[i]?.isTerminating) || ( loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral))" class=" pr-1">Rs. {{(loan?.proposal?.data | jsonParse)?.interestAmount | currencyFormatter}}</td>
                                <td *ngIf=" loanDatas[i]?.showRepaymentMode && ((loanDatas[i]?.loanNatureSelected &&  loanDatas[i]?.isFundable &&  loanDatas[i]?.fundableNonFundableSelcted &&  loanDatas[i]?.isTerminating) || ( loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral))" class=" pl-1">{{(loan?.proposal?.data | jsonParse)?.repaymentModeInterest}}</td>
                                <td *ngIf=" loanDatas[i]?.showRepaymentMode && ((loanDatas[i]?.loanNatureSelected &&  loanDatas[i]?.isFundable &&  loanDatas[i]?.fundableNonFundableSelcted &&  loanDatas[i]?.isTerminating) || ( loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral))" class=" pl-1">{{(loan?.proposal?.data | jsonParse)?.repaymentModePrincipal}}</td>
                                <td *ngIf=" loanDatas[i]?.showRepaymentMode && ((loanDatas[i]?.loanNatureSelected &&  loanDatas[i]?.isFundable &&  loanDatas[i]?.fundableNonFundableSelcted &&  loanDatas[i]?.isTerminating) || ( loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral))" class=" pr-1">Rs.{{(loan?.proposal?.data | jsonParse)?.principalAmount}}</td>
                                <td *ngIf=" loanDatas[i]?.showPrincipalAmount && ((loanDatas[i]?.loanNatureSelected &&  loanDatas[i]?.isFundable &&  loanDatas[i]?.fundableNonFundableSelcted &&  loanDatas[i]?.isTerminating) || ( loanDatas[i]?.isVehicle ||  loanDatas[i]?.isShare ||  loanDatas[i]?.isGeneral))" class=" pr-1">Rs.{{(loan?.proposal?.data | jsonParse)?.principalAmount}}</td>
                            </tr>
                        </table>
                    </ng-container>
                    <ng-template #tenure>
                        <p [class.font-weight-bold]="loan?.documentStatus !== 'APPROVED'">{{(loan?.proposal?.data | jsonParse)?.tenorOfEachDeal || 'N/A '}}</p>

                    </ng-template>
                </td>
                <td>
                <ng-container *ngIf="(loan?.proposal?.data | jsonParse)?.serviceCharge" class="pr-1">
                    <span>LAF: </span>
                    <div *ngIf="(loan.proposal?.data | jsonParse)?.serviceChargeMethod === 'FLAT'; else percentage">
                        Rs. {{(loan?.proposal?.data | jsonParse)?.serviceCharge | currencyFormatter}}, </div>
                    <ng-template #percentage>{{(loan?.proposal?.data | jsonParse)?.serviceCharge}} %, </ng-template>
                </ng-container>
            <ng-container *ngIf="(loan?.proposal?.data | jsonParse)?.commitmentFee">
                <span>CF :</span>
                <span>{{(loan?.proposal?.data | jsonParse)?.commitmentFee || 'N/A'}}, </span>
            </ng-container>
            <ng-container *ngIf="loan?.proposal?.prepaymentCharge">
                <span>PF: </span>
                <span>{{loan?.proposal?.prepaymentCharge || 'N/A'}}, </span>
            </ng-container>
            <ng-container *ngIf="(loan?.proposal?.data | jsonParse)?.swapCharge">
                <span>SF: </span>
                <span>{{(loan?.proposal?.data | jsonParse)?.swapCharge || 'N/A'}}</span>
            </ng-container>
                </td>
            </tr>
            <tr class="sb-bg-gray">
                <td class="text-left pl-1"><strong>Funded</strong></td>
                <td class="text-right pr-1">Rs. {{ (getTotalFundable('existingLimit', true, customerAllLoanList)) | currencyFormatter }}</td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>
                        Rs. {{ getTotalFundable('outStandingLimit', true, customerAllLoanList) | currencyFormatter }}
                    </span>
                </td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>
                        Rs. {{ getTotalFundable('enhanceLimitAmount', true, customerAllLoanList) | currencyFormatter }}
                    </span>
                </td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>
                        Rs. {{ getTotalFundable('settlementAmount', true, customerAllLoanList) | currencyFormatter }}
                    </span>
                </td>
                <td class="text-right pr-1">Rs. {{ getTotalFundable('proposedLimit', true, customerAllLoanList) | currencyFormatter }}</td>
                        <td>-</td>
                        <td>-</td>
                        <td *ngIf="!isRemit">-</td>
                        <td>-</td>
                        <td>-</td>



                <!--        <td>Rs. {{ getTotal('installmentAmount') | currencyFormatter }}</td>-->
                <!--        <td>Rs. {{ getTotal('interestAmount') | currencyFormatter }}</td>-->
                <!--        <td>N/A</td>-->
                <!--        <td>Rs. {{ getTotal('prepaymentCharge') | currencyFormatter }}</td>-->
            </tr>
            <tr class="sb-bg-gray">
                <td class="text-left pl-1"><strong>Non-Funded</strong></td>
                <td class="text-right pr-1">Rs. {{ (getTotalFundable('existingLimit', false, customerAllLoanList) | currencyFormatter)}}</td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>
                        Rs. {{ getTotalFundable('outStandingLimit', false, customerAllLoanList) | currencyFormatter }}
                    </span>
                </td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>Rs. {{ getTotalFundable('enhanceLimitAmount', false, customerAllLoanList) | currencyFormatter }}</span>
                </td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>
                        Rs. {{ getTotalFundable('settlementAmount', false, customerAllLoanList) | currencyFormatter }}
                    </span>
                </td>
                <td class="text-right pr-1">Rs. {{ getTotalFundable('proposedLimit', false, customerAllLoanList) | currencyFormatter }}</td>
                    <td >-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td *ngIf="!isRemit">-</td>

                <!--        <td>Rs. {{ getTotal('installmentAmount') | currencyFormatter }}</td>-->
                <!--        <td>Rs. {{ getTotal('interestAmount') | currencyFormatter }}</td>-->
                <!--        <td>N/A</td>-->
                <!--        <td>Rs. {{ getTotal('prepaymentCharge') | currencyFormatter }}</td>-->
            </tr>
            <tr class="sb-bg-gray">
                <td class="text-left pl-1"><strong>Total</strong></td>

                <td class="text-right pr-1">Rs. {{ getTotal('existingLimit') | currencyFormatter }}</td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>Rs. {{ getTotal('outStandingLimit') | currencyFormatter }}</span>
                </td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>Rs. {{ getTotal('enhanceLimitAmount') | currencyFormatter }}</span>
                </td>
                <td class="text-right pr-1" *ngIf="!isRemit">
                    <span>Rs. {{ getTotal('settlementAmount') | currencyFormatter }}</span>
                </td>
                <td class="text-right pr-1">Rs. {{ getTotal('proposedLimit') | currencyFormatter }}</td>
                    <td >-</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td *ngIf="!isRemit">-</td>
                <!--        <td>Rs. {{ getTotal('installmentAmount') | currencyFormatter }}</td>-->
                <!--        <td>Rs. {{ getTotal('interestAmount') | currencyFormatter }}</td>-->
                <!--        <td>N/A</td>-->
                <!--        <td>Rs. {{ getTotal('prepaymentCharge') | currencyFormatter }}</td>-->
            </tr>
            </tbody>
        </table>
    </div>
</div>

<ng-template #tickCross let-status>
    <i *ngIf="status === DocStatus[DocStatus.APPROVED]" class="fas fa-check-circle"></i>
    <i *ngIf="status !== DocStatus[DocStatus.APPROVED]" class="fas fa-times-circle"></i>
</ng-template>
<ng-template #loanTypeLetter let-loanType>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.NEW_LOAN)" class="text-round">N</i>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.RENEWED_LOAN)"
       class="text-round">R</i>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.ENHANCED_LOAN)"
       class="text-round">E</i>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.CLOSURE_LOAN)"
       class="text-round">C</i>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.PARTIAL_SETTLEMENT_LOAN)"
       class="text-round">P</i>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.FULL_SETTLEMENT_LOAN)"
       class="text-round">F</i>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.RENEW_WITH_ENHANCEMENT)"
       class="text-round">R/E</i>
    <i *ngIf="loanType === EnumUtils.getEnum(LoanType, LoanType.OTHERS)"
       class="text-round">O</i>
</ng-template>

<div class="row">
    <div class="col-md-12 sb-medium">
        <strong>Total Proposed Limit (in words):</strong>
        {{ getTotal('proposedLimit') | currencyFormatter}}
        (Rs. {{ getTotal('proposedLimit') | inWords | titlecase }}
        Only /-)
    </div>
</div>


<div class="row">
    <div class="col-md-12">
        <table *ngIf="productUtils?.CBS_ENABLE"
               class="table table-condensed table-bordered table-responsive-md text-center table-sm sb-small">
                <tr class="sb-bg-gray">
                    <th>Disbursement Criteria</th>
                </tr>
                <tr>
                    <td class="text-left pl-1" [innerHTML]="proposalAllData?.disbursementCriteria | safeHtml"></td>
                </tr>
                <tr class="sb-bg-gray">
                    <th>Repayment</th>
                </tr>
                <tr>
                    <td class="text-left pl-1" [innerHTML]="proposalAllData?.repayment || 'N/A' | safeHtml"></td>
                </tr>
        </table>
    </div>

    <div class="col-md-12">
        <table class="table table-condensed table-bordered table-responsive-md text-center table-sm sb-small ">
            <ng-container *ngIf="checkedData?.solChecked">
                <tr class="sb-bg-gray">
                    <th>Single Obligor Limit</th>
                </tr>
                <tr>
                    <td class="text-left pl-1"><span [innerHTML]="proposalAllData?.solConclusionRecommendation || 'N/A' | safeHtml"></span></td>
                </tr>
            </ng-container>
            <ng-container *ngIf="checkedData?.riskChecked">
                <tr class="sb-bg-gray">
                    <th>Risk & Mitigation</th>
                </tr>
                <tr>
                    <td class="text-left pl-1"><span [innerHTML]="proposalAllData?.riskConclusionRecommendation || 'N/A' | safeHtml"></span></td>
                </tr>
            </ng-container>
        </table>

        <table class="table table-sm table-condensed table-bordered table-responsive-md text-center table-sm sb-small ">
            <tr *ngIf="(loanDataHolder?.loanHolder?.cicl?.cibCharge | currencyFormatter) || loanDataHolder?.loanHolder?.cicl?.cibRemark">
                <td class="sb-bg-gray">CIB Charge</td>
                <td>{{loanDataHolder?.loanHolder?.cicl?.cibCharge ?  loanDataHolder?.loanHolder?.cicl?.cibCharge  :  loanDataHolder?.loanHolder?.cicl?.cibRemark ? (loanDataHolder?.loanHolder?.cicl?.cibRemark | jsonParse)?.value:'N/A'}}</td>
            </tr>
        </table>

    </div>
</div>

