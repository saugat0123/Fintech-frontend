<div class="row mt-1 col-md-12 sb-small" [nbSpinner]="spinner"
     nbSpinnerSize="giant"
     nbSpinnerMessage="Data Loading...."
     nbSpinnerStatus="primary">
    <div *ngIf="approveSheet === 'approveSheet'; else notApproveSheet">
        <p><strong>{{loanCategory === 'INDIVIDUAL' ? '10. ' : '9. '}} Security Exposure Details</strong></p>
    </div>
    <ng-template #notApproveSheet>
        <p><strong>Security Exposure Details</strong></p>
    </ng-template>
</div>
<div class="row mb-2">
    <div class="col-md-12">
        <table
                class="table table-bordered table-responsive-md table-sm sb-small text-center">
            <thead>
            <tr class="sb-bg-dark text-white">
                <th>S.N</th>
                <th>Loan Facility</th>
                <th>Proposed Limit</th>
                <th>Existing Limit</th>
                <th>Outstanding Limit</th>
                <th>Type</th>
                <th>Created On(AD/BS)</th>
                <th>Collateral Req%</th>
                <th>Required Collateral</th>
            </tr>
            </thead>
            <tbody>
            <tr  class="sb-bg-secondary text-white">
                <td></td>
                <td>Funded</td>
                <td class="text-right pr-1">Rs. {{fundedProposedTotal}}</td>
                <td></td>
                <td></td>
                <td colspan="3">
                <td class="text-right pr-1">Rs. {{fundedCollateralTotal | currencyFormatter}}</td>
            </tr>
            <ng-container *ngFor="let model of fundedList;  let i=index">
                <tr class="cursor">
                    <td>{{i + 1}}</td>
                    <td class="text-left pl-1">{{model?.loan?.name}}</td>
                    <td class="text-right pr-1">Rs. {{(model?.proposal?.proposedLimit | currencyFormatter)
                    || 0}}</td>
<!--                    <td class="text-right pr-1" >-->
<!--                    <span *ngIf="(model?.proposal?.data | jsonParse)?.proposedLimit">-->
<!--                        Rs. {{(model?.proposal?.data | jsonParse)?.proposedLimit | currencyFormatter}}-->
<!--                    </span>-->
<!--                        <span *ngIf="!(model?.proposal?.data | jsonParse)?.proposedLimit">-</span></td>-->
                    <td></td>
                    <td></td>
<!--                    <td class="text-right pr-1">-->
<!--                        <span>{{model?.proposal?.outStandingLimit |currency:'Rs '}}</span>-->
<!--                    </td>-->
                    <td class="text-left pl-1">{{loanType[model?.loanType] || model?.loanType}}</td>
                    <td class="text-left pl-1">{{model?.createdAt | date}} ({{model?.createdAt | engNepDate: false}})</td>
                    <td class="text-right pr-1">{{model?.proposal?.collateralRequirement}}</td>
                    <td class="text-right pr-1">Rs. {{(model?.proposal?.collateralRequirement * model?.proposal?.proposedLimit) / 100 |currencyFormatter}}
                    </td>
                </tr>
            </ng-container>
                <ng-container *ngFor="let data of fundedApprovedLoans; let i = index;">
                <tr class="cursor">
                    <td>{{fundedList.length+i + 1}}</td>
                    <td class="text-left pl-1">{{data?.loan?.name}}<b *ngIf="data.loan.loanNature==='Terminating'">(T)</b><b *ngIf="data.loan.loanNature === 'Revolving'">(R)</b></td>
                  <td></td>
                    <td class="text-right pr-1" >
                    <span *ngIf="(data?.proposal?.data | jsonParse)?.proposedLimit">
                        Rs. {{(data?.proposal?.data | jsonParse)?.proposedLimit | currencyFormatter}}
                    </span>
                        <span *ngIf="!(data?.proposal?.data | jsonParse)?.proposedLimit">-</span></td>
                    <td class="text-right pr-1">
                        <span>Rs {{data?.proposal?.outStandingLimit |currencyFormatter}}</span>
                    </td>
                    <td class="text-left pl-1">{{loanType[data?.loanType] || data?.loanType}}</td>
                    <td class="text-left pl-1">{{data?.createdAt | date}} ({{data?.createdAt | engNepDate: false}})</td>
                    <td class="text-right pr-1">{{data?.proposal?.collateralRequirement}}</td>
                    <td class="text-right pr-1">Rs. {{(data?.proposal?.collateralRequirement * data?.proposal?.proposedLimit) / 100 |currencyFormatter}}
                    </td>
                </tr>
            </ng-container>
            <ng-container>
            <tr class="sb-bg-secondary text-white">
                <td></td>
                <td>Non Funded</td>
                <td class="text-right pr-1">Rs. {{NonFundedProposedTotal}}</td>
                <td></td>
                <td></td>
                <td colspan="3"></td>
                <td class="text-right pr-1">Rs. {{nonFundedCollateralTotalView | currencyFormatter}}</td>

            </tr>
            </ng-container>
            <ng-container *ngFor="let model of nonFundedList; let i=index">
                <tr class="cursor">
                    <td>{{i + 1}}</td>
                    <td class="text-left pl-1">{{model?.loan?.name}}<b *ngIf="model.proposal.cashMarginOrFac==='FAC'"> =>F</b><b *ngIf="model.proposal.cashMarginOrFac === 'CASHMARGIN'">=>CM</b></td>
                    <td class="text-right pr-1">Rs. {{(model?.proposal?.proposedLimit | currencyFormatter) || 0}}</td>
                    <td></td>
                    <td></td>
                    <td class="text-left pl-1">{{loanType[model?.loanType] || model?.loanType}}</td>
                    <td class="text-left pl-1">{{model?.createdAt | date}} ({{model?.createdAt | engNepDate: false}})</td>
                    <td class="text-right pr-1">{{model?.proposal?.collateralRequirement}}</td>
                    <td class="text-right pr-1">Rs.
                        {{(model?.proposal?.collateralRequirement * model?.proposal?.proposedLimit) / 100 |currencyFormatter}}
                    </td>
                </tr>

            </ng-container>
            <ng-container *ngFor="let data of nonFundedApprovedLoans; let i = index;" >
            <tr class="cursor" >
                <td>{{nonFundedList.length+i + 1}}</td>
                <td class="text-left pl-1">{{data?.loan?.name}}<b *ngIf="data.loan.loanNature==='Terminating'">(T)</b><b *ngIf="data.loan.loanNature === 'Revolving'">(R)</b>
                    <b *ngIf="data.proposal.cashMarginOrFac==='FAC'">=>F</b><b *ngIf="data.proposal.cashMarginOrFac === 'CASHMARGIN'">=>CM</b></td>
                <td></td>
                <td class="text-right pr-1" >
                    <span *ngIf="(data?.proposal?.data | jsonParse)?.proposedLimit">
                        Rs. {{(data?.proposal?.data | jsonParse)?.proposedLimit | currencyFormatter}}
                    </span>
                    <span *ngIf="!(data?.proposal?.data | jsonParse)?.proposedLimit">-</span></td>
                <td class="text-right pr-1">
                    <span>Rs {{data?.proposal?.outStandingLimit |currencyFormatter}}</span>
                </td>
                <td class="text-left pl-1">{{loanType[data?.loanType] || data?.loanType}}</td>
                <td class="text-left pl-1">{{data?.createdAt | date}} ({{data?.createdAt | engNepDate: false}})</td>
                <td class="text-right pr-1">{{data?.proposal?.collateralRequirement}}</td>
                <td class="text-right pr-1">Rs. {{(data?.proposal?.collateralRequirement * data?.proposal?.proposedLimit) / 100 |currencyFormatter}}
                </td>
            </tr>
            </ng-container>
            <tr class="sb-bg-secondary text-white">
                <td></td>
                <td>Total</td>
                <td class="text-right pr-1">Rs. {{totalProposedAmount | currencyFormatter}} </td>
                <td> Rs {{existingLimitTotal | currencyFormatter}}</td>
                <td> Rs {{outstandingLimitTotal | currencyFormatter}}</td>
                <td colspan="3"></td>
                <td class="text-right pr-1">Rs. {{totalCollateralView| currencyFormatter}}</td>
            </tr>
            </tbody>
        </table>
    </div>
    <ng-container *ngIf="securityExposure">
        <div class="col-md-2 sb-small">
            <mark class="alert-warning text">Total Required Collateral:</mark>
            <strong>Rs.{{totalCollateral | currencyFormatter}}</strong>
        </div>
        <div class="col-md-2 sb-small">
            <mark class="alert-warning">Total FMV/Considered Value:</mark>
            <strong>Rs.{{security?.totalSecurityAmount |currencyFormatter}}</strong>
        </div>
        <div class="col-md-2 sb-small">
            <mark class="alert-warning">Total Distress Value:</mark>
            <strong>Rs.{{security?.totalDistressAmount |currencyFormatter}}</strong>
        </div>
        <div class="col-md-2 sb-small">
            <mark class="alert-warning">Surplus/(Deficit):</mark>
            <strong> Rs. {{security?.totalSecurityAmount - totalCollateral |currencyFormatter}}</strong>
        </div>
        <div  class="col-md-2 sb-small">
            <mark class="alert-warning">Coverage%:</mark>
            <strong>{{coverage |number : '1.0-2'}}%</strong>
        </div>
        <div  class="col-md-2 sb-small" *ngIf="loanTag">
            <mark class="alert-warning">Loan Exposure FMV:</mark>
            <strong>{{loanExposureFmv| number : '1.0-2'}}%</strong>
        </div>
        <div  class="col-md-2 sb-small" *ngIf="loanTag ">
            <mark class="alert-warning">Loan Exposure Dv:</mark>
            <strong>{{loanExposureDv| number : '1.0-2'}}%</strong>
        </div>
    </ng-container>
</div>
