<section class="enable-print" id="print-block">
    <nb-card *ngIf="!spinner">
        <nb-card-body >
            <div class="row disable-print">
                <div class="col-md-12">
                    <div *ngIf="loanDataHolder?.documentStatus?.toString() === 'PENDING'||
                    loanDataHolder?.documentStatus?.toString() === 'DISCUSSION' ||
                    loanDataHolder?.documentStatus?.toString() === 'UNDER_REVIEW'">
                        <nb-accordion>
                            <nb-accordion-item>
                                <nb-accordion-item-header>File Under Possession</nb-accordion-item-header>
                                <nb-accordion-item-body>
                                    <app-role-heirarchy-chain [refId]="id" [loanDataHolder]="loanDataHolder"
                                                              [branchId]="loanDataHolder?.branch?.id"
                                                              [combinedLoanId]="loanDataHolder?.combinedLoan?.id"
                                                              [loanFlags]="loanDataHolder?.loanHolder?.loanFlags"></app-role-heirarchy-chain>
                                </nb-accordion-item-body>
                            </nb-accordion-item>
                        </nb-accordion>
                    </div>
                    <div class="mt-2"
                         *ngIf="(loanDataHolder?.documentStatus?.toString() === 'DISCUSSION' ||
                    loanDataHolder?.documentStatus?.toString() === 'UNDER_REVIEW'||
                    loanDataHolder?.documentStatus?.toString() === 'INITIAL' ||
                    loanDataHolder?.documentStatus?.toString() === 'PENDING') && roleType === 'MAKER' && productUtils.LOAN_APPROVAL_HIERARCHY_LEVEL.toString() === 'LOAN'">
                        <button class="btn btn-primary sb-medium text-uppercase" nbButton size="small" status="primary"
                                nbTooltip="Configure Approval Role Hierarchy"
                                (click)="SetRoleHierarchy(loanDataHolder?.id)">
                            Set Role Hierarchy
                        </button>
                    </div>
                    <br>
                    <button nbButton shape="rectangle" status="primary" size="tiny" (click)="goToCustomer()"><em
                            class="fas fa-backward"></em> <span class="px-2">Customer Profile</span></button>
                </div>
            </div>
            <div *ngIf="loanDataHolder?.parentId || loanDataHolder?.childId"
                 class="row text-success cursor disable-print">
                <div class="col-md-6 text-left">
                    <a (click)="renewedOrCloseFrom(loanDataHolder?.parentId,loanDataHolder?.loan?.id)"
                       *ngIf="loanDataHolder?.parentId !== null"
                       class="text-left">{{loanType[loanDataHolder?.loanType]}} From <i class="p-1 fa fa-eye"></i></a>
                </div>
                <div class="col-md-6 text-right">
                    <a (click)="renewedOrCloseFrom(loanDataHolder?.childId,loanDataHolder?.loan?.id)"
                       *ngIf="loanDataHolder?.childId !== null"
                       class="text-right">{{loanType[loanDataHolder?.loanType]}} to <i class="p-1 fa fa-eye"></i></a>
                </div>
                <div class="col-md-12">
                    <hr/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mt-2 noprint">
                                <strong>Loan Status:</strong>
                                <span class="badge badge-info ml-1" style="font-size: 13px;line-height: 1.9em">
                                    {{loanDataHolder?.documentStatus?.toString() | titlecase}}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="report-header text-center">
                                <div class="report-header-heading mb-2">
                                    {{client}}
                                </div>
                                <ng-container>
                                    <div>
                                        <span class="report-header-sub-heading"> Executive Summary</span>
                                        <br/>
                                        <span class="report-header-sub-heading"> for </span>
                                    </div>
                                    <div *ngIf="!isJointInfo">
                                        <span class="report-header-sub-heading">
                                            <strong>
                                                {{loanCategory === 'INSTITUTION' ?
                                                loanDataHolder?.companyInfo?.companyName
                                                : loanDataHolder?.customerInfo?.customerName}} ({{loanCategory}})
                                            </strong>
                                        </span>
                                    </div>
                                    <div class="report-header-sub-heading" *ngIf="isJointInfo">
                                        <div *ngFor="let jointCustomer of jointInfo">
                                            <ng-container *ngFor="let info of jointCustomer">
                                                <span class="sb-medium">{{loanCategory === 'INSTITUTION' ?
                                                    loanDataHolder?.companyInfo?.companyName :
                                                    info?.customerName}} ({{loanCategory}})</span><br/>
                                            </ng-container>
                                        </div>
                                    </div>
                                </ng-container>
                                <div class="report-header-sub-heading mt-1 ml-1 mb-1">{{loanDataHolder?.branch?.name}}
                                    Branch
                                    ,
                                    {{loanDataHolder?.branch?.province?.name}}</div>
                                <!-- <div class="badge badge-warning m-1 p-2" style="font-size: 1rem;">Summary</div> -->
                            </div>
                        </div>
                        <div class="col-md-3 text-right">
                            <img class="report-log img-thumbnail border-0" alt="logo"
                                 src="../../../../../assets/img/logo.png">
                        </div>
                    </div>
                </div>
            </div>

            <!-- <div class="row">
                <div class="col-md-12">
                    <app-credit-facility-report [loanDataHolder]="loanDataHolder"
                        [customerLoanList]="customerAllLoanList"></app-credit-facility-report>
                </div>
            </div> -->
            <hr class="print-line">
            <div class="row ">
                <div class="col-md-12 sb-small">
                    <div class="clearfix">
                        <div class="float-left">
                            <span><strong>Ref. No: </strong>{{loanDataHolder?.refNo}}</span> <br>
                            <span> <b>Application Received On:</b> {{loanDataHolder?.createdAt | date}}
                                ({{loanDataHolder?.createdAt | engNepDate: false}})</span> <br>
                            <span *ngIf="loanDataHolder?.loanHolder?.customerCategory !== 'DSL_WHOLE_SALE' && loanDataHolder?.loanHolder?.customerCategory !== 'AGRICULTURE_UPTO_TWO_MILLION'">
                                <b>Purpose: {{loanDataHolder?.loan?.name}}</b></span>
                        </div>

                        <div class="float-right" *ngIf="loanDataHolder?.loanHolder?.customerCategory !== 'DSL_WHOLE_SALE' && loanDataHolder.loanHolder.customerCategory !== 'AGRICULTURE_UPTO_TWO_MILLION'">
                            <span><strong>Customer Category: </strong>{{loanDataHolder?.companyInfo?.customerCategory | replace: '_': ' '}}</span><br>
                            <span><b>Loan Under</b>- {{loanDataHolder?.currentStage?.toUser?.name}}
                                ({{loanDataHolder?.currentStage?.toRole?.roleName}})</span><br>
                            <span *ngIf="currentDocAction === 'FORWARD'">Forwarded</span>
                            <span *ngIf="currentDocAction === 'BACKWARD'">Backwarded</span> <b>by:</b> {{loanDataHolder?.currentStage?.fromUser?.name}}
                            ({{loanDataHolder?.currentStage?.fromRole?.roleName}})
                            <b> on:</b> {{loanDataHolder?.lastModifiedAt | date}} ({{loanDataHolder?.lastModifiedAt | engNepDate: false}})
                            <br>
                            <span *ngIf="loanDataHolder?.isSol"><strong>Final Approver: </strong>{{loanDataHolder?.solUser?.name
                                ? loanDataHolder?.solUser?.name : 'NA'}}</span>
                        </div>
                        <br>
                    </div>
                </div>
            </div>
          <!--  <div class="col mt-3 disable-print" style="margin-left: -2.3rem;">
                <div class="col-md-6">
                    <button class="btn btn-primary btn-semi-round btn-sm font-weight-bold"
                            (click)="detailViewCheck()">{{!isDetailedView ? "DETAILED VIEW" : "EXECUTIVE SUMMARY"}}</button>
                </div>
            </div>-->

            <hr class="print-line">
            <ng-container *ngIf="loanDataHolder?.loanHolder?.crgCcbl">
                <div class="row">
                    <div  class="col-md-12">
                        <nb-card class="sb-medium" *ngIf="loanDataHolder?.loanHolder?.customerCategory !== 'DSL_WHOLE_SALE' && loanDataHolder?.loanHolder?.customerCategory !== 'AGRICULTURE_UPTO_TWO_MILLION'">
                            <nb-card-header class="text-center">
                                <p><strong>Counter Party Risk Rating</strong></p>
                            </nb-card-header>
                            <nb-card-body>
                                <div class="row">
                                    <div class="col-md-6 text-right" >
                                        <app-gauge-chart [chartHeight]="180" [chartWidth]="275" [maxValue]="100"
                                                         [obtainedValue]="ccblData?.data" gaugeIdentifier="crg-gamma">
                                        </app-gauge-chart>
                                    </div>
                                    <div class="col-md-6 gauge-label-padding">
                                        <div class="vertical-line">
                                            <div class="text-left pl-2">
                                                Risk Scoring:
                                                <span><strong>{{ccblData?.data}}</strong></span>
                                            </div>
                                            <div class="text-left pl-2">
                                                CCBL Rating:
                                                <span><strong> {{ccblData?.thresholdPoint }}</strong></span>
                                            </div>
                                            <div class="text-left pl-2">
                                                Outcome:
                                                <span><strong> {{ccblData?.thresholdOutcome }} {{ccblData?.waiverValue === 'Yes' ? '(Waiver has been proposed)' : ''}}</strong></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </nb-card-body>
                        </nb-card>
                    </div>
                </div>
            </ng-container>
            <ng-container class="col-md-12" *ngIf="isUptoTwoMillion else showExecutiveSummary">
                <app-credit-facility-report
                        [loanDataHolder]="loanDataHolder"
                        [customerLoanList]="customerAllLoanList"></app-credit-facility-report>
            </ng-container>
            <ng-template #showExecutiveSummary>
                <app-executive-summary-sme *ngIf="loaded" [loanDataHolder]="loanDataHolder"
                                           [customerAllLoanList]="customerAllLoanList"
                                           [isDetailedView]="isDetailedView"
                                           [isExecutive]="true"
                                           [totalProposed]="totalProposedLimit">

                </app-executive-summary-sme>
            </ng-template>
        </nb-card-body>
    </nb-card>

    <div class="row page-break">
        <div class="col-md-12" >
            <app-summary-header [loanCategory]="loanDataHolder?.loanHolder?.customerType"
                                [loanDataHolder]="loanDataHolder"
                                [crgCCbl]="(loanDataHolder?.loanHolder?.crgCcbl | jsonParse)"
                                [isJointInfo]="loanDataHolder?.loanHolder?.isJointCustomer"
                                [currentDocAction]="loanDataHolder?.currentStage?.docAction?.toString()">
            </app-summary-header>
        </div>
        <div class="col-md-12">
            <ng-container *ngIf="isSaneView">
                <app-sana-byabasayi-saral-karja [loanDataHolder]="loanDataHolder"
                                                [fiscalYear]="fiscalYearArray"
                                                [isDetailedView]="isDetailedView"
                                                [totalProposed]="totalProposedLimit"
                                                [fixedAssetsData]="fixedAssetsData"
                                                [isExecutive]="false"
                                                [customerAllLoanList]="customerAllLoanList"></app-sana-byabasayi-saral-karja>
            </ng-container>
        </div>
        <div class="col-md-12">
            <ng-container>
                <app-upto-ten-million *ngIf="isUpToTenMillion"
                                      [loanDataHolder]="loanDataHolder"
                                      [fiscalYear]="fiscalYearArray"
                                      [isDetailedView]="isDetailedView"
                                      [totalProposed]="totalProposedLimit"
                                      [fixedAssetsData]="fixedAssetsData"
                                      [isExecutive]="false"
                                      [customerAllLoanList]="customerAllLoanList"></app-upto-ten-million>
            </ng-container>
            <ng-container>
                <app-above-ten-million *ngIf="isAboveTenMillion"
                                       [loanDataHolder]="loanDataHolder"
                                       [customerAllLoanList]="customerAllLoanList"
                                       [isDetailedView]="isDetailedView"
                                       [fixedAssetsData]="fixedAssetsData"
                                       [fiscalYear]="fiscalYearArray"
                                       [isExecutive]="false"
                                       [totalProposedLimit]="totalProposedLimit"></app-above-ten-million>
            </ng-container>
            <ng-container>
                <app-agriculture-view *ngIf="isUptoTwoMillion"
                                      [loanDataHolder]="loanDataHolder"
                                      [customerAllLoanList]="customerAllLoanList"
                                      [loanHolder]="loanDataHolder?.loanHolder"
                                      [proposalData]="proposalView"
                                      [fixedAssetsData]="fixedAssetsData"
                                      [lastDateOfInspection]="lastDateOfInspection"></app-agriculture-view>
            </ng-container>
            <ng-container *ngIf="isDslWholesale">
                <app-dsl-wholesale [loanDataHolder]="loanDataHolder"
                                   [customerAllLoanList]="customerAllLoanList"
                                   [isDetailedView]="isDetailedView"
                                   [fixedAssetsData]="fixedAssetsData"
                                   [fiscalYear]="fiscalYearArray"
                                   [isExecutive]="false"
                                   [totalProposedLimit]="totalProposedLimit"></app-dsl-wholesale>
            </ng-container>
            <ng-container class="page-break" *ngIf="loanDataHolder?.security && fixedAssetsData?.length > 0">
                <app-annexure-one [loanDataHolder]="loanDataHolder"
                                  [fixedAssetsData]="fixedAssetsData"></app-annexure-one>
            </ng-container>

        </div>
    </div>


</section>
