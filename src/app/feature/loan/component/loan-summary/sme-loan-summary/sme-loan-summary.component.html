<section class="enable-print">
    <nb-card *ngIf="!spinner">
        <nb-card-body id="print-block">
            <div class="row disable-print">
                <div class="col-md-12">
                    <div *ngIf="loanDataHolder?.documentStatus?.toString() === 'PENDING'||
                    loanDataHolder?.documentStatus?.toString() === 'DISCUSSION' ||
                    loanDataHolder?.documentStatus?.toString() === 'UNDER_REVIEW'">
                        <nb-accordion>
                            <nb-accordion-item>
                                <nb-accordion-item-header>File Under Possession</nb-accordion-item-header>
                                <nb-accordion-item-body>
                                    <app-role-heirarchy-chain [refId]="id" [loanDataHolder]="loanDataHolder"
                                                              [branchId]="loanDataHolder?.branch?.id"
                                                              [combinedLoanId]="loanDataHolder?.combinedLoan?.id"
                                                              [loanFlags]="loanDataHolder?.loanHolder?.loanFlags"></app-role-heirarchy-chain>
                                </nb-accordion-item-body>
                            </nb-accordion-item>
                        </nb-accordion>
                    </div>
                    <div class="mt-2"
                         *ngIf="(loanDataHolder?.documentStatus?.toString() === 'DISCUSSION' ||
                    loanDataHolder?.documentStatus?.toString() === 'UNDER_REVIEW'||
                    loanDataHolder?.documentStatus?.toString() === 'INITIAL' ||
                    loanDataHolder?.documentStatus?.toString() === 'PENDING') && roleType === 'MAKER' && productUtils.LOAN_APPROVAL_HIERARCHY_LEVEL.toString() === 'LOAN'">
                        <button class="btn btn-primary sb-medium text-uppercase" nbButton size="small" status="primary"
                                nbTooltip="Configure Approval Role Hierarchy"
                                (click)="SetRoleHierarchy(loanDataHolder?.id)">
                            Set Role Hierarchy
                        </button>
                    </div>
                    <br>
                    <button nbButton shape="rectangle" status="primary" size="tiny" (click)="goToCustomer()"><em
                            class="fas fa-backward"></em> <span class="px-2">Customer Profile</span></button>
                </div>
            </div>
            <div *ngIf="loanDataHolder?.parentId || loanDataHolder?.childId"
                 class="row text-success cursor disable-print">
                <div class="col-md-6 text-left">
                    <a (click)="renewedOrCloseFrom(loanDataHolder?.parentId,loanDataHolder?.loan?.id)"
                       *ngIf="loanDataHolder?.parentId !== null"
                       class="text-left">{{loanType[loanDataHolder?.loanType]}} From <i class="p-1 fa fa-eye"></i></a>
                </div>
                <div class="col-md-6 text-right">
                    <a (click)="renewedOrCloseFrom(loanDataHolder?.childId,loanDataHolder?.loan?.id)"
                       *ngIf="loanDataHolder?.childId !== null"
                       class="text-right">{{loanType[loanDataHolder?.loanType]}} to <i class="p-1 fa fa-eye"></i></a>
                </div>
                <div class="col-md-12">
                    <hr/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mt-2">
                                <strong>Loan Status:</strong>
                                <span class="badge badge-info ml-1" style="font-size: 13px;line-height: 1.9em">
                                    {{loanDataHolder?.documentStatus?.toString() | titlecase}}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="report-header text-center">
                                <div class="report-header-heading mb-2">
                                    {{client}}
                                </div>
                                <ng-template #executiveSummary>
                                    <h2 class="report-header-sub-heading">
                                        Executive Summary
                                    </h2>
                                </ng-template>
                                <ng-container *ngIf="isDetailedView; else executiveSummary">
                                    <div>
                                        <span class="report-header-sub-heading"> Credit Appraisal </span>
                                        <br/>
                                        <span class="report-header-sub-heading"> for </span>
                                    </div>
                                    <div *ngIf="!isJointInfo">
                                        <span class="report-header-sub-heading">
                                            <strong>
                                                {{loanCategory === 'INSTITUTION' ?
                                                loanDataHolder?.companyInfo?.companyName
                                                : loanDataHolder?.customerInfo?.customerName}}
                                            </strong>
                                        </span>
                                    </div>
                                    <div class="report-header-sub-heading" *ngIf="isJointInfo">
                                        <div *ngFor="let jointCustomer of jointInfo">
                                            <ng-container *ngFor="let info of jointCustomer">
                                                <span class="sb-medium">{{loanCategory === 'INSTITUTION' ?
                                                    loanDataHolder?.companyInfo?.companyName :
                                                    info?.customerName}}</span><br/>
                                            </ng-container>
                                        </div>
                                    </div>
                                </ng-container>
                                <div class="report-header-sub-heading mt-1 ml-1 mb-1">{{loanDataHolder?.branch?.name}}
                                    Branch
                                    ,
                                    {{loanDataHolder?.branch?.province?.name}}</div>
                                <!-- <div class="badge badge-warning m-1 p-2" style="font-size: 1rem;">Summary</div> -->
                            </div>
                        </div>
                        <div class="col-md-3 text-right">
                            <img class="report-log img-thumbnail border-0" alt="logo"
                                 src="../../../../../assets/img/logo.png">
                        </div>
                    </div>
                </div>
            </div>
            <hr class="print-line">
            <!-- <div class="row">
                <div class="col-md-12">
                    <app-credit-facility-report [loanDataHolder]="loanDataHolder"
                        [customerLoanList]="customerAllLoanList"></app-credit-facility-report>
                </div>
            </div> -->
            <div class="row ">
                <div class="col-md-12 sb-small">
                    <div class="clearfix">
                        <div class="float-left">
                            <span><strong>Ref. No: </strong>{{loanDataHolder?.refNo}}</span> <br>
                            <span> <b>Application Received On:</b> {{loanDataHolder?.createdAt | date}}
                                ({{loanDataHolder?.createdAt | engNepDate: false}})</span> <br>
                            <span><b>Purpose: {{loanDataHolder?.loan?.name}}</b></span>
                        </div>
                        <div class="float-right">
                            <span><strong>Customer Category: </strong>{{loanDataHolder?.companyInfo?.customerCategory | replace: '_': ' '}}</span><br>
                            <span><b>Loan Under</b>- {{loanDataHolder?.currentStage?.toUser?.name}}
                                ({{loanDataHolder?.currentStage?.toRole?.roleName}})</span><br>
                            <span *ngIf="currentDocAction === 'FORWARD'">Forwarded</span>
                            <span *ngIf="currentDocAction === 'BACKWARD'">Backwarded</span> <b>by:</b> {{loanDataHolder?.currentStage?.fromUser?.name}}
                            ({{loanDataHolder?.currentStage?.fromRole?.roleName}})
                            <b> on:</b> {{loanDataHolder?.lastModifiedAt | date}} ({{loanDataHolder?.lastModifiedAt | engNepDate: false}})
                            <br>
                            <span *ngIf="loanDataHolder?.isSol"><strong>Final Approver: </strong>{{loanDataHolder?.solUser?.name
                                ? loanDataHolder?.solUser?.name : 'NA'}}</span>
                        </div>
                        <br>
                    </div>
                </div>
            </div>
          <!--  <div class="col mt-3 disable-print" style="margin-left: -2.3rem;">
                <div class="col-md-6">
                    <button class="btn btn-primary btn-semi-round btn-sm font-weight-bold"
                            (click)="detailViewCheck()">{{!isDetailedView ? "DETAILED VIEW" : "EXECUTIVE SUMMARY"}}</button>
                </div>
            </div>-->

            <hr class="print-line disable-print">
            <ng-container *ngIf="loanDataHolder?.loanHolder?.crgCcbl">
                <div class="row">
                    <div  class="col-md-12">
                        <nb-card class="sb-medium">
                            <nb-card-header class="text-center">
                                <p><strong>Counter Party Risk Rating</strong></p>
                            </nb-card-header>
                            <nb-card-body>
                                <div class="row">
                                    <div class="col-md-6 text-right">
                                        <app-gauge-chart [chartHeight]="180" [chartWidth]="275" [maxValue]="100"
                                                         [obtainedValue]="ccblData?.data" gaugeIdentifier="crg-gamma">
                                        </app-gauge-chart>
                                    </div>
                                    <div class="col-md-6 gauge-label-padding">
                                        <div class="vertical-line">
                                            <div class="text-left pl-2">
                                                Risk Scoring:
                                                <span><strong>{{ccblData?.data}}</strong></span>
                                            </div>
                                            <div class="text-left pl-2">
                                                CCBL Rating:
                                                <span><strong> {{ccblData?.thresholdPoint }}</strong></span>
                                            </div>
                                            <div class="text-left pl-2">
                                                Outcome:
                                                <span><strong> {{ccblData?.thresholdOutcome }}</strong></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </nb-card-body>
                        </nb-card>
                    </div>
                </div>
            </ng-container>
            <ng-container>
                <app-executive-summary-sme *ngIf="loaded" [loanDataHolder]="loanDataHolder"
                                           [customerAllLoanList]="customerAllLoanList"
                                           [isDetailedView]="isDetailedView"
                                           [totalProposed]="totalProposedLimit"></app-executive-summary-sme>
            </ng-container>
            <ng-container *ngIf="isSaneView">
                <div class="row">
                    <div class="col-md-12">
                        <ol>
                            <li>
                                <p><strong>PROPOSAL:</strong> To seek approval for providing
                                    <b>{{loanDataHolder?.companyInfo?.customerCategory | replace: '_' : ' '}}</b>
                                    of NRP <b>{{totalProposedLimit}}</b> to M/s
                                    <b>{{loanDataHolder?.loanHolder?.name}}</b> with details of under:</p>
                            </li>
                            <li>
                                <p><strong>APPROVING AUTHORITY:</strong>  {{this.approveAuth}}</p>
                            </li>
                            <li>
                                <p><strong>PURPOSE OF CREDIT FACILITIES:</strong> To finance …………..</p>
                                <app-proposal-justification-summary [customerAllLoanList]="customerAllLoanList"
                                                                    [isDetailedView]="isDetailedView"
                                                                    [proposalData]="proposalData"></app-proposal-justification-summary>

                            </li>
                            <li>
                                <!-- details of the customer -->
                                <p>
                                    <strong>DETAILS OF THE CUSTOMER:</strong><br>
                                    <app-upto-details-of-the-customer [companyInfo]="loanDataHolder?.companyInfo"
                                                                      [loanDataHolder]="loanDataHolder"></app-upto-details-of-the-customer>
                                </p>
                            </li>
                            <li>
                                <!-- background information -->
                                <p>
                                    <strong>BACKGROUND INFORMATION:</strong><br>
                                    <strong>5.1 BUSINESS:</strong>
                                </p>
                                <div class="p-2 background-info col-md-12">
                                    <span [innerHTML]="tempData?.business | safeHtml"></span>
                                </div>
                                <p class="mt-2">
                                    <strong>5.2 PROMOTERS/KEY PERSON(S) AND THEIR NETWORTH:</strong>
                                </p>
                                <div class="p-2 background-info col-md-12">
                                    <span [innerHTML]="tempData?.promoterNetWorth | safeHtml"></span></div>
                            </li>
                            <li class="mt-3">
                                <strong>CURRENT STATUS AND PRESENT PROPOSAL</strong>
                                <app-proposal-view [proposalData]="loanDataHolder?.proposal"
                                                   [loanDataHolder]="loanDataHolder"
                                                   [customerAllLoanList]="customerAllLoanList"></app-proposal-view>
                                <!--                                <app-sana-current-status-and-present-proposal [loanDataHolder]="loanDataHolder"></app-sana-current-status-and-present-proposal>-->
                            </li>
                            <li *ngIf="loanDataHolder?.loanHolder?.security">
<!--                                <app-security-tagged-view [loanDataHolder]="loanDataHolder"></app-security-tagged-view>-->
                                <app-retail-security [security]="loanDataHolder?.loanHolder?.security"
                                                     [loanDataHolder]="loanDataHolder"></app-retail-security>
                            </li>
                            <!--                            Insurance Deatils-->
                            <li *ngIf="loanDataHolder?.insurance">
                                <app-insurance-summary [insurance]="loanDataHolder?.insurance"></app-insurance-summary>
                            </li>
                            <!-- Security Details -->
                            <li *ngIf="loanDataHolder?.security">
                                <app-security-view [security]="loanDataHolder?.security">
                                </app-security-view>
                            </li>
                            <!-- Site-visit -->
                            <li *ngIf="loanDataHolder?.loanHolder?.siteVisit || fixedAssetsData?.length > 0">
                                <app-site-visit-view [siteVisit]="loanDataHolder?.loanHolder?.siteVisit"
                                                     [fixedAssetsData]="fixedAssetsData"></app-site-visit-view>
                            </li>
                            <li *ngIf="loanDataHolder?.loanHolder?.financial">
                                <strong>KEY FINANCIAL FIGURES</strong> (audited for last 1 year, estimated for current
                                year, and projected up to loan tenure)
                                <app-financial-view [formData]="loanDataHolder?.loanHolder?.financial"
                                                    [customerType]="loanDataHolder?.loanHolder?.customerType"></app-financial-view>
                            </li>

                            <li *ngIf="loanDataHolder?.loanHolder?.mgroupInfo">
                                <!-- group position -->
                                <strong>GROUP POSITION <em>(including the present proposal)</em></strong>
                                as of <b>{{loanDataHolder?.loanHolder?.mgroupInfo?.groupExposureDate
                                ? (loanDataHolder?.loanHolder?.mgroupInfo?.groupExposureDate | date) : 'NA'}}</b>
                                <app-m-group-summary
                                       [customerCategory]="customerCategoryType" [mGroup]="loanDataHolder?.loanHolder.mgroupInfo"></app-m-group-summary>
                            </li>
                            <li *ngIf="netTradingAssetsSummary && fiscalYearArray?.length > 0">
                                <p><strong>ASSESSTMENT FOR REQUIREMENT OF FUND:</strong></p>
                                <app-nta-summary [fiscalYears]="fiscalYearArray"
                                                 [netTradingAssetsData]="netTradingAssetsData"></app-nta-summary>
                                <!--                                <app-sana-assessment-for-requirement-of-fund [loanDataHolder]="loanDataHolder"></app-sana-assessment-for-requirement-of-fund>-->
                            </li>
                            <li>
                                <!-- banking relationship -->
                                <p><strong>BANKING RELATIONSHIP:</strong></p>
                                <app-above-banking-arrangement-of-the-customer
                                        *ngIf="loanDataHolder?.loanHolder?.multiBanking"
                                        [multiBanking]="loanDataHolder?.loanHolder?.multiBanking"
                                        [proposal]="loanDataHolder?.proposal"
                                        [cicl]="loanDataHolder?.loanHolder?.cicl"
                                        [isRetailCustomer]="false"
                                        [customerCategory]="loanDataHolder?.loanHolder?.customerCategory"></app-above-banking-arrangement-of-the-customer>
                                <!--                                <app-upto-banking-relationship></app-upto-banking-relationship>-->
                            </li>
                            <li>
                                <!-- other charges -->
                                <p><strong>OTHER CHARGES:</strong></p>
                                <app-sana-other-charges></app-sana-other-charges>
                            </li>
                            <li>
                                <p><strong>COVENANTS:</strong></p>
                                <app-upto-convenants></app-upto-convenants>
                            </li>
                            <li>
                                <p><strong>DISBURSEMENT MODALITY:</strong></p>
                                <span [innerHTML]="proposalView?.disbursementCriteria || 'NA' | safeHtml"></span>
                            </li>
                            <li>
                                <p><strong>REPAYMENT MODALITY:</strong></p>
                                <span [innerHTML]="proposalView?.repayment || 'NA' | safeHtml"></span>
                            </li>
                            <li>
                                <p><strong>WAIVERS, DEVIATIONS AND DEFERRAL, IF ANY:</strong></p>
                                <span [innerHTML]="proposalView?.waiverConclusionRecommendation || 'NA' | safeHtml"></span>
                            </li>
                            <li>
                                <p><strong>NRB/STATUTORY AUDITORS/INTERNAL AUDITORS REMARKS AND THEIR STATUS:</strong></p>
                                <app-nrb-statutory-remarks-status [loanDataHolder]="loanDataHolder"></app-nrb-statutory-remarks-status>
                            </li>
                            <li *ngIf="loanDataHolder?.loanHolder?.reportingInfoLevels">
                                <p><strong>MIS/NRB REPORTING</strong></p>
                                <app-report-summary [approved]="false"
                                                    [reportingInfoLevels]="loanDataHolder?.loanHolder?.reportingInfoLevels"></app-report-summary>
                                <!--                                <app-sana-mis-nrb-reporting [loanDataHolder]="loanDataHolder"></app-sana-mis-nrb-reporting>-->
                            </li>
                            <li *ngIf="(loanDataHolder?.loanHolder?.data | jsonParse)?.reviewDate">
                                <p><strong>REVIEW OF CREDIT FACILITIES</strong></p>
                                <app-above-review-of-credit-facilities [loanDataHolder]="loanDataHolder"></app-above-review-of-credit-facilities>
                            </li>
                            <li>
                                <p><strong>CONCLUSION, REVIEW AND RECOMMENDATION:</strong></p>
                                <!--                                <app-conlusion-review-table></app-conlusion-review-table>-->
                                <app-signature-section [loanDataHolder]="loanDataHolder"></app-signature-section>
                            </li>
                        </ol>
                        <!--                        <h5>Annexure - 1</h5>-->
                        <!--                        <app-credit-card-requirement></app-credit-card-requirement>-->
                    </div>
                </div>
            </ng-container>
            <ng-container *ngIf="isUpToTenMillion">
                <app-upto-ten-million [loanDataHolder]="loanDataHolder"
                                      [fiscalYear]="fiscalYearArray"
                                      [isDetailedView]="isDetailedView"
                                      [totalProposed]="totalProposedLimit"
                                      [fixedAssetsData]="fixedAssetsData"
                                      [customerAllLoanList]="customerAllLoanList"></app-upto-ten-million>
            </ng-container>
            <ng-container *ngIf="isAboveTenMillion">
                <app-above-ten-million [loanDataHolder]="loanDataHolder"
                                       [customerAllLoanList]="customerAllLoanList"
                                       [isDetailedView]="isDetailedView"
                                       [fixedAssetsData]="fixedAssetsData"
                                       [fiscalYear]="fiscalYearArray"
                                       [totalProposedLimit]="totalProposedLimit"></app-above-ten-million>
            </ng-container>
            <div style="page-break-after: always !important;"></div>
            <ng-container *ngIf="loanDataHolder?.security && fixedAssetsData?.length > 0">
                <app-annexure-one [loanDataHolder]="loanDataHolder"
                                  [fixedAssetsData]="fixedAssetsData"></app-annexure-one>
            </ng-container>
        </nb-card-body>
    </nb-card>
</section>
