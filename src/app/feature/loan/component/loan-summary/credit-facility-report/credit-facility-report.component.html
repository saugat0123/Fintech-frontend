<section class="enable-print">
    <nb-card>
        <nb-card-body>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-responsive-md table-bordered table-responsive-sm table-condensed table-sm text-center sb-small">
                        <tr class="sb-bg-dark text-white">
                            <td>Originating Branch</td>
                            <td>Date</td>
                            <td>Next Review</td>
                            <td>CFR/CA Ref.:</td>
                        </tr>
                        <tr>
                            <td class="text-left pl-1">test1</td>
                            <td class="text-left pl-1">test2</td>
                            <td class="text-left pl-1">test3</td>
                            <td class="text-left pl-1">{{loanDataHolder?.refNo}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-responsive-md table-bordered table-condensed table-sm text-left sb-small">
                        <tr>
                            <td>Customer & Address:</td>
                            <td>Obligor Group & Location</td>
                            <td>Risk Grade:</td>
                        </tr>
                        <tr>
                            <td>Name: Mr. {{loanDataHolder?.loanHolder.name}}</td>
                            <td rowspan="7">Name: to be Created</td>
                            <td>Basel Risk</td>
                        </tr>
                        <tr>
                            <td>Permanent Address:
                                {{loanDataHolder?.customerInfo?.province?.name}}
                                , {{loanDataHolder?.customerInfo?.district?.name}},
                                {{loanDataHolder?.customerInfo?.municipalities?.name}}
                                , {{loanDataHolder?.customerInfo?.wardNumber}}</td>
                            <td>NRB Sector Code:</td>
                        </tr>
                        <tr>
                            <td>Current Address:
                                {{loanDataHolder?.customerInfo?.temporaryProvince?.name}}
                                , {{loanDataHolder?.customerInfo?.temporaryDistrict?.name}},
                                {{loanDataHolder?.customerInfo?.temporaryMunicipalities?.name}}
                                , {{loanDataHolder?.customerInfo?.temporaryWardNumber}}</td>
                            <td>NRB Security Code:</td>
                        </tr>
                        <tr>
                            <td>Contact No.: {{loanDataHolder?.customerInfo?.contactNumber}}</td>
                            <td>NRB Product Code</td>
                        </tr>
                        <tr>
                            <td rowspan="3">Contact Person:</td>
                            <td>Risk Type</td>
                        </tr>
                        <tr>
                            <td> SIS Sector/Sub-Sector Code:</td>
                        </tr>
                        <tr>
                            <td>SIS Collateral Code:</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-responsive-md table-bordered table-condensed table-sm text-center sb-small">
                        <tr class="sb-bg-dark text-white">
                            <td rowspan="2" colspan="1">Facilities</td>
                            <td colspan="2">Existing</td>
                            <td colspan="2">Proposed Limit</td>
                            <td colspan="1" rowspan="2">Pricing</td>
                            <td colspan="1" rowspan="2">Tenure</td>
                            <td colspan="1" rowspan="2">Security</td>
                        </tr>
                        <tr class="sb-bg-dark text-white">
                            <td colspan="1">Funded</td>
                            <td colspan="1">Non-Funded</td>
                            <td colspan="1">Funded</td>
                            <td colspan="1">Non-Funded</td>
                        </tr>
                        <tr *ngFor="let data of customerAllLoanList; let i=index">
                            <td colspan="1" class="text-left pl-1">{{data?.loan?.name}}</td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="data?.loan?.isFundable">
                                    <span *ngIf="(data?.proposal?.data | jsonParse)?.existingLimit">
                                        {{(data?.proposal?.data | jsonParse)?.existingLimit | currencyFormatter}}
                                    </span>
                                </span>
                                <span *ngIf="(!data?.loan?.isFundable) || !(data?.proposal?.data | jsonParse)?.existingLimit">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="!data?.loan?.isFundable">
                                    <span *ngIf="(data?.proposal?.data | jsonParse)?.existingLimit">
                                        {{(data?.proposal?.data | jsonParse)?.existingLimit | currencyFormatter}}
                                    </span>
                                </span>
                                <span *ngIf="(data?.loan?.isFundable) || !(data?.proposal?.data | jsonParse)?.existingLimit">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="data?.loan?.isFundable">
                                    {{data?.proposal?.proposedLimit | currencyFormatter}}
                                </span>
                                <span *ngIf="(!data?.loan?.isFundable) || (data?.proposal?.proposedLimit < 0)">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="!data?.loan?.isFundable">
                                    {{data?.proposal?.proposedLimit | currencyFormatter}}
                                </span>
                                <span *ngIf="(data?.loan?.isFundable) || (data?.proposal?.proposedLimit < 0)">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="(array[i]?.isFundable && (array[i]?.loanNature === 'Terminating' || array[i]?.loanNature === 'Revolving'))
                                || array[i]?.isFixedDeposit || array[i]?.isVehicle || array[i]?.isShare || array[i]?.isGeneral">
                                    IR : {{(data?.proposal?.data | jsonParse)?.interestRate}} %,
                                </span>
                                <span *ngIf="(array[i]?.isFundable && (array[i]?.loanNature === 'Terminating' || array[i]?.loanNature === 'Revolving')
                                    && array[i]?.loanNatureSelected && array[i]?.fundableNonFundableSelcted) || array[i]?.isVehicle || array[i]?.isShare || array[i]?.isGeneral">
                                    BR : {{ (data?.proposal?.data | jsonParse)?.baseRate}} %,
                                    PR : {{ (data?.proposal?.data | jsonParse)?.premiumRateOnBaseRate}} %,
                                </span>
                                <span *ngIf="!array[i]?.isFundable && array[i]?.fundableNonFundableSelcted">
                                    <span *ngIf="(data?.proposal?.data | jsonParse)?.cashMarginMethod == 'FLAT'">
                                        CM: Rs.  {{ ((data?.proposal?.data | jsonParse)?.cashMargin || 0) | currencyFormatter}},</span>
                                    <span *ngIf="(data?.proposal?.data | jsonParse)?.cashMarginMethod == 'PERCENT'">
                                        CM: {{ ((data?.proposal?.data | jsonParse)?.cashMargin)}} %,</span>
                                    COM:{{(data?.proposal?.data | jsonParse)?.commissionPercentage}} %
                                </span>
                            </td>
                            <td colspan="1" class="text-left pl-1">
                                <span>... years from the date of disbursement</span>
                            </td>
                            <td colspan="1" class="text-left pl-1">
                                <span>
                                    Registered mortgage over
                                    Owner:
                                    Location:       Ward No.:
                                    Plot No.: ......., Area: ...... sq.m

                                    Valuation Date and Valuator: ........;.......Pvt.Ltd.
                                </span>
                                <table>
                                    <tr>
                                        <td>Particulars</td>
                                        <td>MV</td>
                                        <td>FMV</td>
                                        <td>DV</td>
                                    </tr>
                                    <tr>
                                        <td>Land</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Buinding</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Total</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr *ngFor="let dto of customerLoanDtoList; let ii = index">
                            <td colspan="1" class="text-left pl-1">{{dto?.name}}</td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="dto?.loanConfig?.isFundable">
                                    <span *ngIf="(dto?.proposal?.data | jsonParse)?.existingLimit">
                                        {{(dto?.proposal?.data | jsonParse)?.existingLimit | currencyFormatter}}
                                    </span>
                                </span>
                                <span *ngIf="(!dto?.loanConfig?.isFundable) || (!(dto?.proposal?.data | jsonParse)?.existingLimit)">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="!dto?.loanConfig?.isFundable">
                                    <span *ngIf="(dto?.proposal?.data | jsonParse)?.existingLimit">
                                        {{(dto?.proposal?.data | jsonParse)?.existingLimit | currencyFormatter}}
                                    </span>
                                </span>
                                <span *ngIf="(dto?.loanConfig?.isFundable) || (!(dto?.proposal?.data | jsonParse)?.existingLimit)">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="dto?.loanConfig?.isFundable">
                                    {{dto?.proposal?.proposedLimit | currencyFormatter}}
                                </span>
                                <span *ngIf="(!dto?.loanConfig?.isFundable) || (dto?.proposal?.proposedLimit < 0)">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="!dto?.loanConfig?.isFundable">
                                    {{dto?.proposal?.proposedLimit | currencyFormatter}}
                                </span>
                                <span *ngIf="(dto?.loanConfig?.isFundable) || (dto?.proposal?.proposedLimit < 0)">-</span>
                            </td>
                            <td colspan="1" class="text-right pr-1">
                                <span *ngIf="(dtoArray[ii]?.isFundable && (dtoArray[ii]?.loanNature === 'Terminating' || dtoArray[ii]?.loanNature === 'Revolving'))
                                || dtoArray[ii]?.isFixedDeposit || dtoArray[ii]?.isVehicle || dtoArray[ii]?.isShare || dtoArray[ii]?.isGeneral">
                                    IR : {{(dto?.proposal?.data | jsonParse)?.interestRate}} %,
                                </span>
                                <span *ngIf="(dtoArray[ii]?.isFundable && (dtoArray[ii]?.loanNature === 'Terminating' || dtoArray[ii]?.loanNature === 'Revolving')
                                    && dtoArray[ii]?.loanNatureSelected && dtoArray[ii]?.fundableNonFundableSelcted) || dtoArray[ii]?.isVehicle || dtoArray[ii]?.isShare || dtoArray[ii]?.isGeneral">
                                    BR : {{ (dto?.proposal?.data | jsonParse)?.baseRate}} %,
                                    PR : {{ (dto?.proposal?.data | jsonParse)?.premiumRateOnBaseRate}} %,
                                </span>
                                <span *ngIf="!dtoArray[ii]?.isFundable && dtoArray[ii]?.fundableNonFundableSelcted">
                                    <span *ngIf="(dto?.proposal?.data | jsonParse)?.cashMarginMethod == 'FLAT'">
                                        CM: Rs.  {{ ((dto?.proposal?.data | jsonParse)?.cashMargin || 0) | currencyFormatter}},</span>
                                    <span *ngIf="(dto?.proposal?.data | jsonParse)?.cashMarginMethod == 'PERCENT'">
                                        CM: {{ ((dto?.proposal?.data | jsonParse)?.cashMargin)}} %,</span>
                                    COM:{{(dto?.proposal?.data | jsonParse)?.commissionPercentage}} %
                                </span>
                            </td>
                            <td colspan="1" class="text-left pl-1">
                                <span>... years from the date of disbursement</span>
                            </td>
                            <td colspan="1" class="text-left pl-1">
                                <span>
                                    Registered mortgage over
                                    Owner:
                                    Location:       Ward No.:
                                    Plot No.: ......., Area: ...... sq.m

                                    Valuation Date and Valuator: ........;.......Pvt.Ltd.
                                </span>
                                <table>
                                    <tr>
                                        <td>Particulars</td>
                                        <td>MV</td>
                                        <td>FMV</td>
                                        <td>DV</td>
                                    </tr>
                                    <tr>
                                        <td>Land</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Buinding</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>Total</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <th>Total</th>
                            <th>{{getTotalFundable('existingLimit', true, customerAllLoanList) | currencyFormatter}}</th>
                            <th>{{getTotalFundable('existingLimit', false, customerAllLoanList) | currencyFormatter}}</th>
                            <th>{{getTotalFundable('proposedLimit', true, customerAllLoanList) | currencyFormatter}}</th>
                            <th>{{getTotalFundable('proposedLimit', false, customerAllLoanList) | currencyFormatter}}</th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-responsive-md table-bordered table-condensed table-sm text-center sb-small">
                        <tr>
                            <td class="col-md-8">
                                <div class="row justify-content-between px-3">
                                    <div *ngFor="let previous of signatureAllList; let i = index">
                                        <div class="signature-block" *ngIf="!previous.fromUser.name.toLowerCase().includes('default')">
                                            <div class="text-center p-2 bg-light mb-2 sb-small sb-bg-dark text-white">
                                                <span>{{loanHandler(i, signatureAllList.length, (previous.docAction.toString() === 'RE_INITIATE') ? previous?.toRole?.authorityLabel : previous?.fromRole?.authorityLabel)}}</span>
                                            </div>
                                            <hr class="border-dark m-0">
                                            <div class="row justify-content-center signature mx-auto">
                                                <div class="print-only signature-padding"></div>
                                                <img align="middle" alt="signature"
                                                     class="img-thumbnail border-0 signature-height signature-width"
                                                     src="{{(previous.docAction.toString() === 'RE_INITIATE') ? (previous.toUser?.signatureImage === null ? '' : RootUrl + '/' + previous.toUser?.signatureImage) : (previous.fromUser?.signatureImage === null ? '' : RootUrl + '/' + previous.fromUser?.signatureImage)}}"/>
                                            </div>
                                            <div class="text-center signature-detail sb-bg-secondary text-white">
                                                <p class="m-0 sb-small">{{(previous.docAction.toString() === 'RE_INITIATE') ? previous?.toUser?.name : previous?.fromUser?.name}}</p>
                                                <p class="m-0 sb-small">({{(previous.docAction.toString() === 'RE_INITIATE') ? previous?.toRole?.roleName : previous?.fromRole?.roleName}}
                                                    )</p>
                                                <p class="m-0 sb-small">{{previous?.lastModifiedAt | date}}
                                                    ({{previous?.lastModifiedAt | engNepDate: false}})</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td class="col-md-4">
                                Personal Guarantee of Mrs...... (Spouse of the borrower) of NPR ..... Mio. <br>
                                Consent of Ms. .... <br>
                                <b>Total</b> <br>
                                Tangible: NPR ..... Mio
                                Intangible: .... Mio
                                Security Coverage: Ratio for funded Facility of NPR .... Mio.

                                a. Land & Building :- .....% at FMV
                                b. Personal Guarantee :- 100%.
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </nb-card-body>
    </nb-card>
</section>
